{"version":3,"file":"@index.js.map","sources":["@index.js","$.js","main.js","taquin.rotate-touch.js","taquin.grid.js","taquin.cube.js"],"sourcesContent":["var require = function() {\n    var modules = {};\n    \n    return function(id, body) {\n        var mod;\n        body = window[\"#\" + id];\n        if (typeof body === 'undefined') {\n            var err = new Error(\"Required module is missing: \" + id);   \n            console.error(err.stack);\n            throw err;\n        }\n        mod = modules[id];\n        if (typeof mod === 'undefined') {\n            mod = {exports: {}};\n            var exports = mod.exports;\n            body(exports, mod);\n            modules[id] = mod.exports;\n            mod = mod.exports;\n            //console.log(\"Module initialized: \" + id);\n        }\n        return mod;\n    };\n}();\nfunction addListener(e,l) {\n    if (window.addEventListener) {\n        window.addEventListener(e,l,false);\n    } else {\n        window.attachEvent('on' + e, l);\n    }\n};\n\naddListener(\n    'DOMContentLoaded',\n    function() {\n        document.body.parentNode.$data = {};\n        // Attach controllers.\n        APP = require('main');\nsetTimeout(function (){if(typeof APP.start==='function')APP.start()});\n    }\n);\n","window['#$']=function(exports,module){  exports.config={\n    name:\"webgl-experiments\",\n    description:\"WebGL experiments\",\n    author:\"Tolokoban\",\n    version:\"0.0.151\",\n    major:0,\n    minor:0,\n    revision:151,\n    date:new Date(2016,0,13,17,8,6)\n};\nvar currentLang = null;\nexports.lang = function(lang) {\n    if (lang === undefined) {\n        lang = window.localStorage.getItem(\"Language\");\n        if (!lang) {\n            lang = window.navigator.language;\n            if (!lang) {\n                lang = window.navigator.browserLanguage;\n                if (!lang) {\n                    lang = \"fr\";\n                }\n            }\n        }\n        lang = lang.substr(0, 2).toLowerCase();\n    }\n    currentLang = lang;\n    window.localStorage.setItem(\"Language\", lang);\n    return lang;\n};\nexports.intl = function(words, params) {\n    var dic = words[exports.lang()],\n    k = params[0],\n    txt, newTxt, i, c, lastIdx, pos;\n    if (!dic) {\n        console.error(\"Missing internationalization for language : \\\"\" + exports.lang() + \"\\\"!\");\n        return k;\n    }\n    txt = dic[k];\n    if (!txt) {\n        console.error(\"Missing internationalization [\"\n                      + exports.lang()\n                      + \"]: \\\"\" + k + \"\\\"!\");\n        return k;\n    }\n    if (params.length > 1) {\n        newTxt = \"\";\n        lastIdx = 0;\n        for (i = 0 ; i < txt.length ; i++) {\n            c = txt.charAt(i);\n            if (c === '$') {\n                newTxt += txt.substring(lastIdx, i);\n                i++;\n                pos = txt.charCodeAt(i) - 48;\n                if (pos < 0 || pos >= params.length) {\n                    newTxt += \"$\" + txt.charAt(i);\n                } else {\n                    newTxt += params[pos];\n                }\n                lastIdx = i + 1;\n            } else if (c === '\\\\') {\n                newTxt += txt.substring(lastIdx, i);\n                i++;\n                newTxt += txt.charAt(i);\n                lastIdx = i + 1;\n            }\n        }\n        newTxt += txt.substr(lastIdx);\n        txt = newTxt;\n    }\n    return txt;\n};\n }\n","window['#main']=function(exports,module){ var _intl_={\"en\":{\"welcome\":\"Welcome in the world of\"},\"fr\":{\"welcome\":\"Bienvenue dans le monde de\"}},_$=require(\"$\").intl;function _(){return _$(_intl_, arguments);}\n var Cube = require(\"taquin.cube\");\nvar Grid = require(\"taquin.grid\");\nvar RotateTouch = require(\"taquin.rotate-touch\");\n\nvar W = Math.min( window.innerWidth, window.innerHeight );\nvar H = W;\nvar scene = new THREE.Scene();\nvar camera = new THREE.PerspectiveCamera( 75, W / H, 0.1, 1000 );\nvar renderer = new THREE.WebGLRenderer();\nrenderer.setSize( W, H );\ndocument.body.appendChild( renderer.domElement );\n\n\nvar selectedCube = null;\nvar nextSelectedCube = null;\nvar actions = [];\n\nvar mouse = { x: 0, y: 0 };\nrenderer.domElement.addEventListener('mousemove', function(event) {\n    mouse.x = ( event.clientX / W ) * 2 - 1;\n    mouse.y = - ( event.clientY / H ) * 2 + 1;\n});\nrenderer.domElement.addEventListener('mousedown', function(event) {\n    actions.push(\"MOUSEDOWN\");\n});\nrenderer.domElement.addEventListener('touchstart', function(event) {\n    mouse.x = ( event.clientX / W ) * 2 - 1;\n    mouse.y = - ( event.clientY / H ) * 2 + 1;\n    actions.push(\"MOUSEDOWN\");\n});\n\n\nvar material, material2 = new THREE.MeshPhongMaterial({\n    color: 0xff0000,\n    specular: 0x333333,\n    shininess: 15,\n    map: null,\n    specularMap: null,\n    normalMap: null\n});\n\nvar light1 = new THREE.DirectionalLight( 0xdddddd, 0.8 );\nvar light2 = new THREE.DirectionalLight( 0x9999ff, 0.5 );\nvar group = new THREE.Group();\n\nscene.add( group );\nscene.add( light1 );\nscene.add( light2 );\n\nvar grid = new Grid(3,3,3);\nvar x, y, z, cube;\nfor (x=0 ; x<3 ; x++) {\n    for (y=0 ; y<3 ; y++) {\n        for (z=0 ; z<3 ; z++) {\n            if (x != 1 || y != 1 || z != 1) {\n                cube = Cube(x, y, z);\n                grid.cube(x, y, z, cube);\n                group.add(cube);\n            }\n        }\n    }\n}\nmaterial = cube.material;\n\ncamera.position.z = 4.3;\nlight1.position.set(3,0,5);\nlight2.position.set(-1,2,4);\nvar time0 = Date.now();\ngroup.rotation.x = 0;\ngroup.rotation.y = 0;\ngroup.rotation.z = 0;\n\nvar touch = new RotateTouch(renderer.domElement);\n\nfunction render(time1) {\n    var deltaTime = time1 - time0;\n    touch.applyRotation(group, deltaTime);\n    time0 = time1;\n    touch.rotation.speedX *= .95;\n    touch.rotation.speedY *= .95;\n\n    if (!grid.anim(time1)) {\n        if (touch.tap()) {\n            var raycaster = new THREE.Raycaster();\n            var vector = new THREE.Vector3( touch.x, touch.y, 1 ).unproject( camera );\n            raycaster.set( camera.position, vector.sub( camera.position ).normalize() );\n            var intersects = raycaster.intersectObjects( group.children );\n            var cube = intersects.length > 0 ? intersects[0].object : null;\n            if (cube) {\n                grid.tap(cube, time1);\n            }\n        }\n    }\n\n    requestAnimationFrame( render );\n    renderer.render( scene, camera );\n}\nrequestAnimationFrame( render );\n }\n","window['#taquin.rotate-touch']=function(exports,module){  var MOUSEDOWN = 1;\nvar TOUCHSTART = 2;\n\nvar X_AXIS = new THREE.Vector3(1,0,0);\nvar Y_AXIS = new THREE.Vector3(0,1,0);\n\n/**\n * Deal with touch/mouse gestures to make an object rotate.\n *\n * @param canvas {canvas} - the canvas on with we will attach touch/mouse events.\n * @param mesh {THREE.Mesh} - the object to rotate according to gestures.\n */\nvar RotateTouch = function(canvas) {\n    var that = this;\n    this.x = 0;\n    this.y = 0;\n    this._tap = false;\n    this.rotation = { speedX: Math.random() * .01, speedY: Math.random() * .01 };\n    var status = 0;\n    var timeTouchStart = 0;\n    var time0 = 0;\n    canvas.addEventListener(\"touchstart\", function(evt) {\n        evt.preventDefault();\n        evt.stopPropagation();\n        status = TOUCHSTART;\n        timeTouchStart = time0 = Date.now();\n        var touches = evt.changedTouches;\n        if (touches.length > 0) {\n            that.x = ( touches[0].clientX / canvas.width ) * 2 - 1;\n            that.x0 = that.x;\n            that.y = -( touches[0].clientY / canvas.height ) * 2 + 1;\n            that.y0 = that.y;\n        }\n        // Stop rotation as soon as the user touches the screen.\n        that.rotation.speedX = that.rotation.speedY = 0;\n    });\n    canvas.addEventListener(\"touchend\", function(evt) {\n        if (status != TOUCHSTART) return;\n        evt.preventDefault();\n        evt.stopPropagation();\n        var deltaTime = Date.now() - timeTouchStart;\n        if (deltaTime > 400) return;\n        var x, y;\n        var touches = evt.changedTouches;\n        if (touches.length > 0) {\n            x = ( touches[0].clientX / canvas.width ) * 2 - 1;\n            y = -( touches[0].clientY / canvas.height ) * 2 + 1;\n        }\n        var dis = Math.max(Math.abs(that.x0 - x), Math.abs(that.y0 - y));\n        if (dis > 0.05) return;\n        that._tap = true;\n    });\n    canvas.addEventListener(\"touchmove\", function(evt) {\n        if (status != TOUCHSTART) return;\n        evt.preventDefault();\n        var touches = evt.changedTouches;\n        var x, y;\n        if (touches.length > 0) {\n            x = ( touches[0].clientX / canvas.width ) * 2 - 1;\n            y = -( touches[0].clientY / canvas.height ) * 2 + 1;\n            var time1 = Date.now();\n            var deltaTime = Math.max(0.001, time1 - time0);\n            that.rotation.speedY = (x - that.x) / deltaTime;\n            that.rotation.speedX = (y - that.y) / deltaTime;\n            that.x = x;\n            that.y = y;\n            time0 = time1;\n        }\n    });\n};\n\n\n/**\n * @return void\n */\nRotateTouch.prototype.applyRotation = function(mesh, deltaTime) {\n    var angX = this.rotation.speedX * deltaTime;\n    var angY = -this.rotation.speedY * deltaTime;\n    var Cx = Math.cos(angX);\n    var Sx = Math.sin(angX);\n    var Cy = Math.cos(angY);\n    var Sy = Math.sin(angY);\n    mesh.matrixAutoUpdate = false;\n    var rotation = new THREE.Matrix4();\n    var e = rotation.elements;\n    e[0]  = Cy;      e[1]  = 0;      e[2]  = Sy;      e[3]  = 0;\n    e[4]  = Sx*Sy;   e[5]  = Cx;     e[6]  = -Cy*Sx;  e[7]  = 0;\n    e[8]  = -Cx*Sy;  e[9]  = Sx;     e[10] = Cx*Cy;   e[11] = 0;\n    e[12] = 0;       e[13] = 0;      e[14] = 0;       e[15] = 1;\n\n    mesh.matrix = rotation.multiply( mesh.matrix );\n};\n\n\n/**\n * @return void\n */\nRotateTouch.prototype.tap = function() {\n    if (this._tap) {\n        this._tap = false;\n        return true;\n    }\n    return false;\n};\n\n\nmodule.exports = RotateTouch;\n }\n","window['#taquin.grid']=function(exports,module){  /***************************************\n\n ***************************************/\n\nvar ANIM_SCALE = 1;\nvar ANIM_MOVE = 2;\n\n\nvar Grid = function(dx, dy, dz) {\n    this._cubes = [];\n    for (var loop = 0 ; loop < dx*dy*dz ; loop++) {\n        this._cubes.push(null);\n    }\n    this._dx = dx;\n    this._dy = dy;\n    this._dz = dz;\n    this._anim = {\n        start: 0,\n        end: 0,\n        cube: null,\n        type: 0,\n        x0: 0, x1: 0,\n        y0: 0, y1: 0,\n        z0: 0, z1: 0\n    };\n};\n\n\n/**\n * @return void\n */\nGrid.prototype.anim = function(time) {\n    var anim = this._anim;\n    if (!anim.cube) return false;\n    var dur = anim.end - anim.start;\n    if (anim.type == ANIM_SCALE) {\n        if (time >= anim.end) {\n            // End of animation. Set the scale to 1.\n            anim.cube.scale.x = 1;\n            anim.cube.scale.y = 1;\n            anim.cube.scale.z = 1;\n            anim.cube = null;\n        } else {\n            var scale = 1 - .5 * Math.sin(Math.PI * (time - anim.start) / dur);\n            anim.cube.scale.x = anim.cube.scale.y = anim.cube.scale.z = scale;\n        }\n    } else {\n        if (time >= anim.end) {\n            // End of animation. Set the to target position.\n            anim.cube.position.x = anim.x1;\n            anim.cube.position.y = anim.y1;\n            anim.cube.position.z = anim.z1;\n            anim.cube = null;\n        } else {\n            anim.cube.position.x = anim.x0 + (anim.x1 - anim.x0) * (time - anim.start) / dur;\n            anim.cube.position.y = anim.y0 + (anim.y1 - anim.y0) * (time - anim.start) / dur;\n            anim.cube.position.z = anim.z0 + (anim.z1 - anim.z0) * (time - anim.start) / dur;\n        }\n    }\n    return true;\n};\n\n\n/**\n * @return void\n */\nGrid.prototype.tap = function(cube, time) {\n    var coords = this.find(cube);\n    if (!coords) return;\n    var cx = coords.x;\n    var cy = coords.y;\n    var cz = coords.z;\n    var x = cube.position.x;\n    var y = cube.position.y;\n    var z = cube.position.z;\n    var vect = null;\nconsole.log(cx, cy, cz);\n    if (this.cube(cx + 1, cy + 0, cz + 0) === null) {\n        vect = [1,0,0];\n    }\n    else if (this.cube(cx - 1, cy + 0, cz + 0) === null) {\n        vect = [-1,0,0];\n    }\n    else if (this.cube(cx + 0, cy + 1, cz + 0) === null) {\n        vect = [0,1,0];\n    }\n    else if (this.cube(cx + 0, cy - 1, cz + 0) === null) {\n        vect = [0,-1,0];\n    }\n    else if (this.cube(cx + 0, cy + 0, cz + 1) === null) {\n        vect = [0,0,1];\n    }\n    else if (this.cube(cx + 0, cy + 0, cz - 1) === null) {\n        vect = [0,0,-1];\n    }\nconsole.info(\"[taquin.grid] vect=...\", vect);\n    if (!vect) {\n        this._anim = {\n            cube: cube,\n            type: ANIM_SCALE,\n            start: time,\n            end: time + 300\n        };\n    } else {\n        this._anim = {\n            cube: cube,\n            type: ANIM_MOVE,\n            start: time,\n            end: time + 300,\n            x0: x, y0: y, z0: z,\n            x1: x + vect[0], y1: y + vect[1], z1: z + vect[2]\n        };\n        this.cube(cx + vect[0], cy + vect[1], cz + vect[2], cube);\n        this.cube(cx, cy, cz, null);\nconsole.info(\"[taquin.grid] this._anim=...\", this._anim);\n    }\n};\n\n\n/**\n * @return void\n */\nGrid.prototype.cube = function(x, y, z, cube) {\n    var index = Math.floor(x + y * this._dx + z * this._dx * this._dy);\n    if (index < 0 || index >= this._cubes.length) return undefined;\n    if (typeof cube === 'undefined') return this._cubes[index];\n    this._cubes[index] = cube;\n    return this;\n};\n\n\n/**\n * @return void\n */\nGrid.prototype.find = function(cube) {\n    var x, y, z;\n    for (z=0 ; z<this._dz; z++) {\n        for (y=0 ; y<this._dy; y++) {\n            for (x=0 ; x<this._dx; x++) {\n                if (cube === this.cube(x, y, z)) return { x: x, y: y, z: z };\n            }\n        }\n    }\n    return null;\n};\n\n\nmodule.exports = Grid;\n }\n","window['#taquin.cube']=function(exports,module){  \n\n\nmodule.exports = function(x, y, z) {\n    var color = \"#\" + (x > 0 ? '77' : 'ff') + (y > 0 ? '77' : 'ff') + (z > 0 ? '77' : 'ff');\n    var materials = [\n        // Left\n        createMaterial(\n            \"L\", //\"ABCDEFGHI\".charAt((x+y+z) % 9),\n            color),\n        // Right\n        createMaterial(\n            \"R\", //\"ABCDEFGHI\".charAt((x+y+z) % 9),\n            color),\n        // Up\n        createMaterial(\n            \"U\", //\"ABCDEFGHI\".charAt((x+y+z) % 9),\n            color),\n        // Down\n        createMaterial(\n            \"D\", //\"ABCDEFGHI\".charAt((x+y+z) % 9),\n            color),\n        // Back\n        createMaterial(\n            \"B\", //\"ABCDEFGHI\".charAt((x+y+z) % 9),\n            color),\n        // Front\n        createMaterial(\n            \"F\", //\"ABCDEFGHI\".charAt((x+y+z) % 9),\n            [\"#f80\", \"#777\", \"#840\"][z]),\n    ];\n    var mesh = new THREE.Mesh(\n        new THREE.BoxGeometry( 1, 1, 1, 1, 1, 1 ),\n        new THREE.MeshFaceMaterial( materials )\n    );\n\n    mesh.position.set(x - 1, y - 1, z - 1);\n    return mesh;\n};\n\n\n\n\nfunction createCanvas(text, color) {\n    var canvas = document.createElement(\"canvas\");\n    canvas.width = 128;\n    canvas.height = 128;\n    var ctx = canvas.getContext(\"2d\");\n\n    ctx.fillStyle = color;\n    ctx.fillRect(0, 0, 128, 128);\n    ctx.font = 'Bold 96px Arial';\n    ctx.textAlign = \"center\";\n    ctx.textBaseline = \"middle\";\n    ctx.fillStyle = \"#000\";\n    ctx.fillText(text, 64, 64);\n\n    return canvas;\n}\n\nfunction createTexture(text, color) {\n    var texture = new THREE.Texture(  createCanvas(text, color) );\n    texture.needsUpdate = true;\n    return texture;\n}\n\nfunction createBump(text) {\n    var canvas = document.createElement(\"canvas\");\n    canvas.width = 128;\n    canvas.height = 128;\n    var ctx = canvas.getContext(\"2d\");\n\n    ctx.fillStyle = \"#000\";\n    ctx.fillRect(0, 0, 128, 128);\n    ctx.fillStyle = \"#777\";\n    ctx.fillRect(1, 1, 126, 126);\n    ctx.font = 'Bold 96px Arial';\n    ctx.textAlign = \"center\";\n    ctx.textBaseline = \"middle\";\n    ctx.fillStyle = \"rgba(255, 255, 255, .3)\";\n    var x, y;\n    for (y = -2 ; y < 3 ; y++) {\n        for (x = -2 ; x < 3 ; x++) {\n            ctx.fillText(text, 64 + x, 64 + y);\n        }\n    }\n\n    var texture = new THREE.Texture(  canvas );\n    texture.needsUpdate = true;\n    return texture;\n}\n\nfunction createMaterial(text, color) {\n    return new THREE.MeshPhongMaterial({\n        specular: 0x333333,\n        shininess: 25,\n        map: createTexture(text, color),\n        specularMap: null,\n        bumpMap: createBump(text)\n    });\n}\n }\n"],"names":["addListener","e","l","window","addEventListener","attachEvent","require","modules","id","body","mod","err","Error","console","error","stack","exports","document","parentNode","$data","APP","setTimeout","start","window","exports","module","config","name","description","author","version","major","minor","revision","date","Date","currentLang","lang","undefined","localStorage","getItem","navigator","language","browserLanguage","substr","toLowerCase","setItem","intl","words","params","txt","newTxt","i","c","lastIdx","pos","dic","k","console","error","length","charAt","substring","charCodeAt","window","exports","module","render","time1","deltaTime","time0","touch","applyRotation","group","rotation","speedX","speedY","grid","anim","tap","raycaster","THREE","Raycaster","vector","Vector3","x","y","unproject","camera","set","position","sub","normalize","intersects","intersectObjects","children","cube","length","object","requestAnimationFrame","renderer","scene","Cube","require","intl","Grid","RotateTouch","W","Math","min","innerWidth","innerHeight","H","Scene","PerspectiveCamera","WebGLRenderer","setSize","document","body","appendChild","domElement","actions","mouse","addEventListener","event","clientX","clientY","push","material","light1","MeshPhongMaterial","color","specular","shininess","map","specularMap","normalMap","DirectionalLight","light2","Group","add","z","Date","now","window","exports","module","TOUCHSTART","RotateTouch","THREE","Vector3","canvas","that","this","x","y","_tap","rotation","speedX","Math","random","speedY","status","timeTouchStart","time0","addEventListener","evt","preventDefault","stopPropagation","Date","now","touches","changedTouches","length","clientX","width","x0","clientY","height","y0","deltaTime","dis","max","abs","time1","prototype","applyRotation","mesh","angX","angY","Cx","cos","Sx","sin","Cy","Sy","matrixAutoUpdate","Matrix4","e","elements","matrix","multiply","tap","window","exports","module","ANIM_SCALE","ANIM_MOVE","Grid","dx","dy","dz","this","_cubes","loop","push","_dx","_dy","_dz","_anim","start","end","cube","type","x0","x1","y0","y1","z0","z1","prototype","anim","time","dur","scale","x","y","z","Math","sin","PI","position","tap","coords","find","cx","cy","cz","vect","console","log","info","index","floor","length","window","exports","module","createCanvas","text","color","canvas","document","createElement","width","height","ctx","getContext","fillStyle","fillRect","font","textAlign","textBaseline","fillText","createTexture","texture","THREE","Texture","needsUpdate","createBump","x","y","createMaterial","MeshPhongMaterial","specular","shininess","map","specularMap","bumpMap","z","materials","mesh","Mesh","BoxGeometry","MeshFaceMaterial","position","set"],"mappings":"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"}
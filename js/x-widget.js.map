{"version":3,"sources":["x-widget.js"],"names":["require","module","exports","_","D","X","intl","arguments","all","$","DB","widgets","slots","Widget","id","modName","args","attribs","Widget1","call","Widget2","ex","console","error","Error","JSON","stringify","wdg","elem","element","Node","dst","document","getElementById","parentNode","replaceChild","setAttribute","addClass","class","register","tag","attr","att","Array","isArray","children","forEach","child","add","key","val","prop","Object","defineProperty","value","writable","configurable","enumerable","template","name","charAt","substr","mySlots","window","setTimeout","slot","getById","onWidgetCreation","push","bind","dstObj","dstAtt","srcObj","srcAtt","bindings","idx","B","binding","length","S","mod","APP","fct"],"mappings":"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","sourcesContent":["/** @module x-widget */require( 'x-widget', function(require, module, exports) { var _=function(){var D={\"en\":{}},X=require(\"$\").intl;function _(){return X(D,arguments);}_.all=D;return _}();\r\n   /**\r\n * @example\r\n * \r\n * var W = require(\"x-widget\");\r\n * W({\r\n *   elem: \"div\",\r\n *   attr: {\"class\": \"black\"},\r\n *   prop: {\"$key\": \"menu\"},\r\n *   children: [\r\n *     \"This is the \",\r\n *     W({\r\n *       elem: \"b\",\r\n *       children: [\"menu\"]\r\n *     }),\r\n *     \"...\"\r\n *   ]\r\n * });\r\n */\r\n\"use strict\";\r\n\r\nvar $ = require(\"dom\");\r\nvar DB = require(\"tfw.data-binding\");\r\n\r\nvar widgets = {};\r\n// Used for `onWidgetCreation()`.\r\nvar slots = {};\r\n\r\n\r\nvar Widget = function(id, modName, args, attribs) {\r\n  try {\r\n  if (typeof id === 'string') return Widget1.call( this, id, modName, args, attribs );\r\n    else return Widget2.call( this, id );\r\n  }\r\n  catch( ex ) {\r\n    console.error( ex );\r\n    throw Error(\"Exception in \" + modName + \"(\" + JSON.stringify(args) + \"):\\n\" + ex);\r\n  }\r\n};\r\n\r\nfunction Widget1(id, modName, args, attribs ) {\r\n  if( typeof attribs === 'undefined' ) attribs = {};\r\n\r\n  try {\r\n    var module = require( modName );\r\n    var wdg = new module( args );\r\n    var elem;\r\n    if( typeof wdg.element === 'function' ) elem = wdg.element();\r\n    else if( wdg.element instanceof Node ) elem = wdg.element;\r\n    else if( wdg.$ instanceof Node ) elem = wdg.$;\r\n    else {\r\n      throw Error(\"Sorry, but \\\"\" + modName + \"\\\" is not a widget nor a view!\", wdg);\r\n    }\r\n    var dst = document.getElementById( id );\r\n    if (dst) {\r\n      // This widget does exist in the current DOM.\r\n      // We have to replace it.\r\n      dst.parentNode.replaceChild( elem, dst );\r\n    }\r\n    elem.setAttribute( 'id', id );\r\n    // Add classes defined in the containing element (`dst`).\r\n    $.addClass( elem, attribs.class || \"\" );\r\n    register( id, wdg );\r\n    return wdg;\r\n  }\r\n  catch (ex) {\r\n    console.error(\"[x-widget] Unable to create widget `\" + modName + \"`!\");\r\n    console.error(\"[x-widget] id = \", id, \", args = \", args);\r\n    throw Error(ex);\r\n  }\r\n};\r\n\r\nfunction Widget2(args) {\r\n  var id;\r\n  var elem = $.tag( args.elem );\r\n  if (args.attr) {\r\n    // Adding DOM element attributes.\r\n    $.att( elem, args.attr );\r\n    id = args.attr.id;\r\n  }\r\n\r\n  if (Array.isArray( args.children )) {\r\n    // Adding DOM element children.\r\n    args.children.forEach(function (child) {\r\n      $.add( elem, child );\r\n    });\r\n  }\r\n  // Converting into a widget.\r\n  var key, val;\r\n  var wdg = {};\r\n\r\n  if (args.prop) {\r\n    // Adding READ-ONLY properties to the widget.\r\n    for( key in args.prop ) {\r\n      val = args.prop[key];\r\n      Object.defineProperty( wdg, key, {\r\n        value: val, writable: false, configurable: false, enumerable: true\r\n      });\r\n    }\r\n  }\r\n  // Assigning the element to the widget.\r\n  Object.defineProperty( wdg, 'element', {\r\n    value: elem, writable: false, configurable: false, enumerable: true\r\n  });\r\n\r\n  if( typeof id !== 'undefined' ) {\r\n    // Registering the widget only if it as got an id.\r\n    register( id, wdg );\r\n  }\r\n  return wdg;\r\n}\r\n\r\nWidget.template = function( attribs ) {\r\n  var key, val, id, name = '', args = {};\r\n  for( key in attribs ) {\r\n    val = attribs[key];\r\n    if( key == 'name' ) {\r\n      name = val;\r\n    }\r\n    else if( key == 'id' ) {\r\n      id = val;\r\n    }\r\n    else if( key.charAt(0)=='$' ) {\r\n      args[key.substr( 1 )] = val;\r\n    }\r\n  }\r\n  var module = require( name );\r\n  var wdg = new module( args );\r\n  if( id ) {\r\n    register( id, wdg );\r\n  }\r\n\r\n  return typeof wdg.element === 'function' ? wdg.element() : (wdg.element || wdg);\r\n};\r\n\r\nfunction register( id, wdg ) {\r\n  widgets[id] = wdg;\r\n  var mySlots = slots[id];\r\n  if( typeof mySlots !== 'undefined' ) {\r\n    window.setTimeout(function() {\r\n      mySlots.forEach(function (slot) {\r\n        slot( wdg );\r\n      });\r\n      delete slots[id];\r\n    });\r\n  }\r\n  return typeof wdg.element === 'function' ? wdg.element : (wdg.element || wdg);\r\n};\r\n\r\nWidget.getById = function( id ) {\r\n  if( !widgets[id] ) throw Error( \"[x-widget.getById()] ID not found: \" + id + \"!\" );\r\n  return widgets[id];\r\n};\r\n\r\nWidget.onWidgetCreation = function( id, slot ) {\r\n  if( typeof widgets[id] === 'undefined' ) {\r\n    if( typeof slots[id] === 'undefined' ) slots[id] = [slot];\r\n    else slots[id].push( slot );\r\n  } else {\r\n    // Asynchronous call to the slot\r\n    window.setTimeout(\r\n      function() {\r\n        slot( widgets[id] );\r\n      }\r\n    );\r\n  }\r\n};\r\n\r\n/**\r\n * @example\r\n * var W = require(\"x-widget\");\r\n * W.bind('wdg.layout-stack0',{\"value\":{\"B\":[[\"btnNewTask\",\"action\"],[\"btnCancel\",\"action\"]]}});\r\n */\r\nWidget.bind = function( id, attribs ) {\r\n  // Destination object: the one on the attributes of which we want to bind.\r\n  var dstObj = widgets[id];\r\n  // Destination attribute name.\r\n  var dstAtt;\r\n  // Temporary variables to hold source object and attributes.\r\n  var srcObj, srcAtt;\r\n  // @example\r\n  // [\"btnNewTask\",\"action\",\"btnCancel\",\"action\"]\r\n  var bindings;\r\n  var slots;\r\n  // Index used to parse multiple bindings.\r\n  var idx;\r\n  for( dstAtt in attribs ) {\r\n    bindings = attribs[dstAtt].B;\r\n    if (Array.isArray( bindings )) {\r\n      // `binding` is an array of arrays.\r\n      // Subarrays have 2 or 3 elements.\r\n      // * ID if the source object\r\n      // * attribute to bind on\r\n      // * [optional] value  to use as  a constant. This  is the\r\n      // * case where  we just want  to set a constant  value as\r\n      // * soon as the source's attribute has changed.\r\n      bindings.forEach(function (binding) {\r\n        srcObj = widgets[binding[0]];\r\n        if( typeof srcObj === 'undefined' ) {\r\n          console.error( \"[x-widget:bind(\" + id + \")] Trying to bind attribute \\\"\"\r\n                         + dstAtt\r\n                         + \"\\\" of widget \\\"\" + id + \"\\\" to the unexisting widget \\\"\"\r\n                         + binding[0] + \"\\\"!\");\r\n          return;\r\n        }\r\n        srcAtt = binding[1];\r\n        try {\r\n          if (binding.length == 2) {\r\n            DB.bind( srcObj, srcAtt, dstObj, dstAtt );\r\n          } else {\r\n            var value = binding[2];\r\n            DB.bind( srcObj, srcAtt, function() {\r\n              dstObj[dstAtt] = value;\r\n            });\r\n          }\r\n        } catch( ex ) {\r\n          console.error(\"Binding error for widget `\" + id + \"`!\", {\r\n            ex: ex,\r\n            binding: binding\r\n          });\r\n        }\r\n      });\r\n    }\r\n\r\n    slots = attribs[dstAtt].S;\r\n    if (Array.isArray( slots )) {\r\n      // Each item is the name of a function to call when the value of this attribute changes.\r\n      // If the item is a `string`, the function is from the global `APP` object.\r\n      // Otherwise, the item must be an array with two children:\r\n      // the first one  is the module's name and  the second one\r\n      // id the name of the function.\r\n      // The slots are called with two arguments:\r\n      //  * the value and\r\n      //  * the object the attribute belongs.\r\n      slots.forEach(function (slot) {\r\n        var mod = APP;\r\n        var fct = slot;\r\n        if (Array.isArray( slot )) {\r\n          try {\r\n            mod = require(slot[0]);\r\n          } catch( ex ) {\r\n            console.error(\"[x-widget:bind] Widget `\" + id + \"` can't require unexistent `\"\r\n                          + slot[0] + \"`: \", ex);\r\n            throw( ex );\r\n          }\r\n          fct = slot[1];\r\n        }\r\n        fct = mod[fct];\r\n        if (typeof fct !== 'function') {\r\n          if( Array.isArray(slot) ) {\r\n            throw Error(\"[x-widget:bind]  Widget `\" + id + \"` use unexisting slot `\"\r\n                        + slot[1] + \"` of module `\" + slot[0] + \"`!\");\r\n          } else {\r\n            throw Error(\"[x-widget:bind]  Widget `\" + id + \"` use unexisting slot `\"\r\n                        + slot + \"` of main module `APP`!\");\r\n          }\r\n        } else {\r\n          try {\r\n            DB.bind( dstObj, dstAtt, fct );\r\n          } catch( ex ) {\r\n            console.error(\"Binding error for widget `\" + id + \"`!\", {\r\n              ex: ex,\r\n              dstObj: dstObj,\r\n              dstAtt: dstAtt,\r\n              fct: fct,\r\n              slot: slot\r\n            });\r\n          }\r\n        }\r\n      });\r\n\r\n    }\r\n  }\r\n};\r\n\r\nmodule.exports = Widget;\r\n\r\n\r\n\r\nmodule.exports._ = _;\n})"]}
{"version":3,"sources":["tfw.binding.link.js"],"names":["require","module","link","args","id","emitterKey","receiverKey","that","onChanged","forEach","receiver","receiverIndex","open","PropertyManager","obj","emitter","emitterIndex","name","console","error","info","pmEmitter","slot","actionChanged","bind","on","push","pm","addDestroyFunction","onSrcChanged","onDstChanged","destroy","item","off","src","dst","value","propertyName","container","wave","Array","isArray","dbg","log","hasAlreadyBeenHere","pmSrc","pmDst","processValue","processSwitch","processConverter","filterFailed","processFormat","processMap","delay","debug","clearTimeout","_id","setTimeout","target","change","checkArgs","fail","A","B","k","length","checkPod","ex","pod","index","action","isLinkable","getAllAttributesNames","join","hollowObject","create","set","msg","source","indexOf","filter","switch","get","map","converter","format","intlFunc","intlId","result","more","context","list","header","itm","idx","footer","_","X","D","arguments","intl","all","ID","Link","call","onChangedA","onChangedB","exports"],"mappings":"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","sourcesContent":["/** @module tfw.binding.link */require( 'tfw.binding.link', function(require, module, exports) { var _=function(){var D={\"en\":{},\"fr\":{}},X=require(\"$\").intl;function _(){return X(D,arguments);}_.all=D;return _}();\r\n   \"use strict\";\r\n\r\nvar PropertyManager = require(\"tfw.binding.property-manager\");\r\n\r\nvar ID = 0;\r\n\r\n/**\r\n * @export\r\n * @class Link\r\n * Bind A with B. A is waiting for value change in B and vice versa.\r\n *\r\n * @param {object} args.A.obj - Object holding properties for input A.\r\n * @param {string} args.A.name  - Name of the property  of the holding\r\n * object for input A.\r\n * @param  {number=0} args.A.delay  - Number  of milliseconds  to wait\r\n * before using the data sent by B. If a new value is sent by B before\r\n * the delay, the previous value is forgotten.\r\n * @param {function=null}  args.A.action - Function to  execute when A\r\n * received a new value from B.\r\n * @param {string=undefined} args.A.value -  If specified, it is the\r\n * value we use whatsover B sent.\r\n * @param  {function=undefined}  args.A.value  -  If  `value`  is  a\r\n * function, it will be called  with the propertyName as sole argument\r\n * and the return will be used as value for A.\r\n * @param  {function=undefined}  args.A.converter  -  Converter  for\r\n * values entering the source.\r\n * @param  {function=undefined} args.A.filter  -  Filter for  values\r\n * entering the source. If the filter returns `false` the value is not\r\n * set to the source.\r\n * @param  {function=undefined} args.A.map  - Function  to execute  on\r\n * each element of the value. Only if this value is an array.\r\n * @param  {function=undefined} args.A.header  -  Function to  execute\r\n * before the array will be parsed. Only if this value is an array and\r\n * the property `map` is set.\r\n * @param  {function=undefined} args.A.footer  -  Function to  execute\r\n * after the array will be parsed. Only  if this value is an array and\r\n * the property `map` is set.\r\n * @param   {string|array}  args.A.switch   -  Sometimes,   you  are\r\n * listening at  a property  A to  change, but  want to  propagate the\r\n * value  of  B. It  is  usefull  with  buttons which  provide  action\r\n * properties.\r\n * So this attribute  tells the link what property to  read instead of\r\n * the one  we are  listening on.  Moreover, if you  give an  array of\r\n * property names, the  value will be an array with  the values of all\r\n * asked properties.\r\n * @param {boolean=true}  args.A.open -  If false,  no data  will be\r\n * accepted by `A`.\r\n */\r\nvar Link = function( args ) {\r\n  try {\r\n    var id = ID++;\r\n    checkArgs.call( this, args );\r\n\r\n    var onChangedA = link.call( this, args, id, \"A\", \"B\" );\r\n    var onChangedB = link.call( this, args, id, \"B\", \"A\" );\r\n    addDestroyFunction.call( this, onChangedA, onChangedB );\r\n  }\r\n  catch( ex ) {\r\n    console.error(\"new Link( \" + args + \" )\");\r\n    fail( ex, \"new Link( <args> ) \" + (this.name || \"\") );\r\n  }\r\n\r\n};\r\n\r\n\r\nmodule.exports = Link;\r\n\r\n\r\nfunction link( args, id, emitterKey, receiverKey ) {\r\n  var that = this;\r\n\r\n  var onChanged = [];\r\n  args[receiverKey].forEach(function (receiver, receiverIndex) {\r\n    if( !receiver.open ) return;\r\n    var pmReceiver = PropertyManager( receiver.obj );\r\n    args[emitterKey].forEach(function (emitter, emitterIndex) {\r\n      if( typeof emitter.name === 'string'\r\n          && typeof receiver.name === 'string'\r\n          && emitter.obj === receiver.obj\r\n          && emitter.name === receiver.name )\r\n      {\r\n        console.error(\r\n          \"It is forbidden to bind a property on itself! (\"\r\n            + emitterIndex + \" -> \" + receiverIndex + \")\"\r\n        );\r\n        console.info(\"[tfw.binding.link] args=\", args);\r\n        return;\r\n      }\r\n      var pmEmitter = PropertyManager( emitter.obj );\r\n      var slot = actionChanged.bind( that, emitter, receiver, id );\r\n      pmEmitter.on( emitter.name, slot );\r\n      onChanged.push({ pm: pmEmitter, name: emitter.name, slot: slot });\r\n    });\r\n  });\r\n  return onChanged;\r\n}\r\n\r\nfunction addDestroyFunction( onSrcChanged, onDstChanged ) {\r\n  this.destroy = function() {\r\n    onSrcChanged.forEach(function (item) {\r\n      item.pm.off( item.name, item.slot );\r\n    });\r\n    onDstChanged.forEach(function (item) {\r\n      item.pm.off( item.name, item.slot );\r\n    });\r\n  };\r\n}\r\n\r\nfunction actionChanged( src, dst, id, value, propertyName, container, wave ) {\r\n  if( !Array.isArray( wave ) ) wave = [];\r\n\r\n  if( this.dbg ) {\r\n    console.log( \"Link \" + this.dbg + \": \", {\r\n      src: src, dst: dst, id: id, value: value, propertyName: propertyName, container: container, wave: wave\r\n    } );\r\n  }\r\n  if( hasAlreadyBeenHere( id, wave ) ) {\r\n    if( this.dbg ) {\r\n      console.log( \"...has been BLOCKED by the wave! \", wave );\r\n    }\r\n    return;\r\n  }\r\n\r\n  var that = this;\r\n\r\n  var pmSrc = PropertyManager( src.obj );\r\n  var pmDst = PropertyManager( dst.obj );\r\n\r\n  value = processValue( value, src, dst );\r\n  value = processSwitch( value, dst, pmSrc );\r\n  value = processConverter( value, src, dst );\r\n  if( filterFailed( value, src, dst ) ) {\r\n    if( this.dbg ) console.log( \"...has been FILTERED!\" );\r\n    return;\r\n  }\r\n  value = processFormat( value, src, dst );\r\n  value = processMap( value, src, dst );\r\n\r\n  if( typeof dst.delay === 'number' ) {\r\n    if( this.debug ) console.log( \"...has been DELAYED for \" + dst.delay + \" ms!\" );\r\n    clearTimeout( dst._id );\r\n    dst._id = setTimeout(function() {\r\n      if( that.dbg ) {\r\n        console.log( \"Link \" + that.dbg + \" (after \" + dst.delay + \" ms): \", {\r\n          src: src, dst: dst, id: id, value: value, propertyName: propertyName, wave: wave\r\n        } );\r\n        console.log(\"...try to change a value. \", {\r\n          target: pmDst,\r\n          propertyName: dst.name,\r\n          value: value,\r\n          wave: wave\r\n        });\r\n      }\r\n      pmDst.change( dst.name, value, wave );\r\n    }, dst.delay);\r\n  } else {\r\n    if( this.debug )\r\n      console.log(\"...try to change a value. \", {\r\n        target: pmDst,\r\n        propertyName: dst.name,\r\n        value: value,\r\n        wave: wave\r\n      });\r\n    pmDst.change( dst.name, value, wave );\r\n  }\r\n}\r\n\r\n\r\nfunction checkArgs( args ) {\r\n  try {\r\n    if( typeof args.name === 'undefined' ) args.name = args.debug;\r\n    if( typeof args.name !== 'string' ) args.name = \"Link#\" + this.id;\r\n    if( typeof args === 'undefined' ) fail(\"Missing mandatory argument!\");\r\n    if( typeof args.A === 'undefined' ) fail(\"Missing `args.A`!\");\r\n    if( !Array.isArray( args.A ) ) args.A = [args.A];\r\n    if( typeof args.B === 'undefined' ) fail(\"Missing `args.B`!\");\r\n    if( !Array.isArray( args.B ) ) args.B = [args.B];\r\n\r\n    var k;\r\n    for( k = 0 ; k < args.A.length ; k++ ) {\r\n      checkPod( args.A[k], k );\r\n    }\r\n    for( k = 0 ; k < args.B.length ; k++ ) {\r\n      checkPod( args.B[k], k );\r\n    }\r\n\r\n    // For debugging.\r\n    this.name = args.name;\r\n    this.debug = args.debug;\r\n  }\r\n  catch( ex ) {\r\n    console.error(\"checkArgs( \" + args + \" )\");\r\n    fail( ex, \"checkArgs( <args> )\" );\r\n  }\r\n}\r\n\r\nfunction checkPod( pod, index ) {\r\n  try {\r\n    if( !pod.action ) {\r\n      if( typeof pod.obj === 'undefined' ) fail(\"Missing `[\" + index + \"].obj`!\");\r\n      if( typeof pod.name === 'undefined' ) pod.name = \"*\";\r\n      // Check if the attribute exists.\r\n      if( !PropertyManager.isLinkable( pod.obj, pod.name ) )\r\n        throw \"`\" + pod.name + \"` is not a linkable attribute.\\n\"\r\n        + \"Valid linkable attributes are: \"\r\n        + PropertyManager.getAllAttributesNames( pod.obj ).join(\", \") + \".\";\r\n    }\r\n    else if ( typeof pod.action !== 'function' ) {\r\n      throw \"Attribute `[\" + index + \"].action` must be a function!\";\r\n    }\r\n    else {\r\n      if( typeof pod.obj !== 'undefined' )\r\n        throw \"[\" + index + \"].action cannot be defined in the same time of [\"\r\n        + index + \"].obj! They are exclusive attributes.\";\r\n      if( typeof pod.name !== 'undefined' )\r\n        throw \"[\" + index + \"].action cannot be defined in the same time of [\"\r\n        + index + \"].name! They are exclusive attributes.\";\r\n\r\n      // An action is emulated by a hollow object.\r\n      var hollowObject = {};\r\n      PropertyManager( hollowObject ).create(\"<action>\", {\r\n        set: pod.action\r\n      });\r\n      pod.obj = hollowObject;\r\n      pod.name = \"<action>\";\r\n    }\r\n    if( typeof pod.open === 'undefined' ) pod.open = true;\r\n  }\r\n  catch( ex ) {\r\n    console.error(\"checkpod(\", pod, \", \", index, \")\");\r\n    fail( ex, \"checkpod( <pod>, \" + index + \")\" );\r\n  }\r\n}\r\n\r\n\r\nfunction fail( msg, source ) {\r\n  if( typeof source === 'undefined' ) {\r\n    source = \"\";\r\n  } else {\r\n    source = \"::\" + source;\r\n  }\r\n  throw msg + \"\\n\" + \"[tfw.binding.link\" + source + \"]\";\r\n}\r\n\r\n\r\nfunction hasAlreadyBeenHere( id, wave ) {\r\n  if( Array.isArray( wave ) ) {\r\n    if( wave.indexOf( id ) < 0 ) {\r\n      // Remember we took this path.\r\n      wave.push( id );\r\n    } else {\r\n      // We already took this link in this wave.\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\n\r\nfunction filterFailed(value, src, dst) {\r\n  if( typeof dst.filter === 'function' ) {\r\n    try {\r\n      if( !dst.filter( value ) ) return true;\r\n    }\r\n    catch( ex ) {\r\n      console.error( ex );\r\n      fail(\r\n        \"Error in filter of link \"\r\n          + PropertyManager(src.obj) + \".\" + src.name\r\n          + \" -> \"\r\n          + PropertyManager(dst.obj) + \".\" + dst.name + \"!\"\r\n      );\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\n\r\nfunction processSwitch( value, dst, pmSrc ) {\r\n  if( typeof dst.switch === 'string' ) {\r\n    return pmSrc.get( dst.switch );\r\n  }\r\n  else if( Array.isArray( dst.switch ) ) {\r\n    return dst.switch.map(function(name) {\r\n      return pmSrc.get( name );\r\n    });\r\n  }\r\n  return value;\r\n}\r\n\r\n\r\nfunction processConverter( value, src, dst ) {\r\n  if( typeof dst.converter === 'function' ) {\r\n    try {\r\n      return dst.converter( value );\r\n    }\r\n    catch( ex ) {\r\n      console.error( ex );\r\n      fail(\r\n        \"Error in converter of link \"\r\n          + PropertyManager(src.obj) + \".\" + src.name\r\n          + \" -> \"\r\n          + PropertyManager(dst.obj) + \".\" + dst.name + \"!\"\r\n      );\r\n    }\r\n  }\r\n  return value;\r\n}\r\n\r\n\r\n/**\r\n * `format` is used  with an intl function.  It must  be an array with\r\n * two elements: a function and a string.  The function will be called\r\n * with the  string as first argument  and the `value` as  second. The\r\n * result will be the transformed value.\r\n */\r\nfunction processFormat( value, src, dst ) {\r\n  if( !dst.format ) return value;\r\n  try {\r\n    if( !Array.isArray( dst.format ) )\r\n      throw \"Must be an array with two elements!\";\r\n    var intlFunc = dst.format[0];\r\n    if( typeof intlFunc !== 'function' )\r\n      throw \"First element of the array must be a function!\";\r\n    var intlId = dst.format[1];\r\n    if( typeof intlId !== 'string' )\r\n      throw \"Second element of the array must be a string!\";\r\n    return intlFunc( intlId, value );\r\n  }\r\n  catch( ex ) {\r\n    console.error( ex );\r\n    fail(\r\n      \"Error in format of link \"\r\n        + PropertyManager(src.obj) + \".\" + src.name\r\n        + \" -> \"\r\n        + PropertyManager(dst.obj) + \".\" + dst.name + \"!\\n\"\r\n        + ex\r\n    );\r\n  }\r\n}\r\n\r\n\r\nfunction processMap( value, src, dst ) {\r\n  if( value && typeof value.map === 'function' && typeof dst.map === 'function' ) {\r\n    try {\r\n      var result = [];\r\n      var more = {\r\n        context: {},\r\n        list: value,\r\n        index: 0\r\n      };\r\n      if( typeof dst.header === 'function' ) {\r\n        try {\r\n          result.push(dst.header( value, more.context ));\r\n        }\r\n        catch( ex ) {\r\n          console.error(\"[tfw.binding.link/processMap] Exception while calling a header function: \", ex);\r\n          console.error({\r\n            value: value,\r\n            src: src,\r\n            dst: dst,\r\n            more: more\r\n          });\r\n        }\r\n      }\r\n      value.forEach(function (itm, idx) {\r\n        more.index = idx;\r\n        try {\r\n          result.push( dst.map( itm, more ) );\r\n        }\r\n        catch( ex ) {\r\n          console.error(\"[tfw.binding.link/processMap] Exception while calling a map function: \", ex);\r\n          console.error({\r\n            item: itm,\r\n            index: idx,\r\n            value: value,\r\n            src: src,\r\n            dst: dst,\r\n            result: result,\r\n            more: more\r\n          });\r\n        }\r\n      });\r\n\r\n      if( typeof dst.footer === 'function' ) {\r\n        try {\r\n          result.push(dst.header( value, more.context ));\r\n        }\r\n        catch( ex ) {\r\n          console.error(\"[tfw.binding.link/processMap] Exception while calling a footer function: \", ex);\r\n          console.error({\r\n            value: value,\r\n            src: src,\r\n            dst: dst,\r\n            result: result,\r\n            more: more\r\n          });\r\n        }\r\n      }\r\n      \r\n      return result.filter(function( item ) {\r\n        return item != null;\r\n      });\r\n    }\r\n    catch( ex ) {\r\n      console.error( ex );\r\n      fail(\r\n        \"Error in map of link \"\r\n          + PropertyManager(src.obj) + \".\" + src.name\r\n          + \" -> \"\r\n          + PropertyManager(dst.obj) + \".\" + dst.name + \"!\"\r\n      );\r\n    }\r\n  }\r\n  return value;\r\n}\r\n\r\n\r\nfunction processValue( value, src, dst ) {\r\n  if( typeof dst.value === 'undefined' ) return value;\r\n  if( typeof dst.value === 'function' ) {\r\n    try {\r\n      return dst.value( src.name );\r\n    }\r\n    catch( ex ) {\r\n      console.error( ex );\r\n      fail(\r\n        \"Error in value(\" + src.name + \") of link \"\r\n          + PropertyManager(src.obj) + \".\" + src.name\r\n          + \" -> \"\r\n          + PropertyManager(dst.obj) + \".\" + dst.name + \"!\"\r\n      );\r\n    }\r\n  }\r\n  return dst.value;\r\n}\r\n\r\n\r\n\r\nmodule.exports._ = _;\n})"]}
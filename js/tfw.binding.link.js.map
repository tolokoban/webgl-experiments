{"version":3,"sources":["tfw.binding.link.js"],"names":["require","module","exports","_","D","X","intl","arguments","all","PropertyManager","ID","Link","args","id","checkArgs","call","onChangedA","link","onChangedB","addDestroyFunction","ex","console","error","fail","name","emitterKey","receiverKey","that","onChanged","forEach","receiver","receiverIndex","open","pmReceiver","obj","emitter","emitterIndex","info","pmEmitter","slot","actionChanged","bind","on","push","pm","onSrcChanged","onDstChanged","destroy","item","off","src","dst","value","propertyName","container","wave","Array","isArray","dbg","log","hasAlreadyBeenHere","pmSrc","pmDst","processValue","processSwitch","processConverter","filterFailed","processFormat","processMap","delay","debug","clearTimeout","_id","setTimeout","target","change","A","B","k","length","checkPod","pod","index","action","isLinkable","getAllAttributesNames","join","hollowObject","create","set","msg","source","indexOf","filter","switch","get","map","converter","format","intlFunc","intlId","result","more","context","list","header","itm","idx","footer"],"mappings":"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","sourcesContent":["/** @module tfw.binding.link */require( 'tfw.binding.link', function(require, module, exports) { var _=function(){var D={\"en\":{},\"fr\":{}},X=require(\"$\").intl;function _(){return X(D,arguments);}_.all=D;return _}();\r\n   \"use strict\";\r\n\r\nvar PropertyManager = require(\"tfw.binding.property-manager\");\r\n\r\nvar ID = 0;\r\n\r\n/**\r\n * @export\r\n * @class Link\r\n * Bind A with B. A is waiting for value change in B and vice versa.\r\n *\r\n * @param {object} args.A.obj - Object holding properties for input A.\r\n * @param {string} args.A.name  - Name of the property  of the holding\r\n * object for input A.\r\n * @param  {number=0} args.A.delay  - Number  of milliseconds  to wait\r\n * before using the data sent by B. If a new value is sent by B before\r\n * the delay, the previous value is forgotten.\r\n * @param {function=null}  args.A.action - Function to  execute when A\r\n * received a new value from B.\r\n * @param {string=undefined} args.A.value -  If specified, it is the\r\n * value we use whatsover B sent.\r\n * @param  {function=undefined}  args.A.value  -  If  `value`  is  a\r\n * function, it will be called  with the propertyName as sole argument\r\n * and the return will be used as value for A.\r\n * @param  {function=undefined}  args.A.converter  -  Converter  for\r\n * values entering the source.\r\n * @param  {function=undefined} args.A.filter  -  Filter for  values\r\n * entering the source. If the filter returns `false` the value is not\r\n * set to the source.\r\n * @param  {function=undefined} args.A.map  - Function  to execute  on\r\n * each element of the value. Only if this value is an array.\r\n * @param  {function=undefined} args.A.header  -  Function to  execute\r\n * before the array will be parsed. Only if this value is an array and\r\n * the property `map` is set.\r\n * @param  {function=undefined} args.A.footer  -  Function to  execute\r\n * after the array will be parsed. Only  if this value is an array and\r\n * the property `map` is set.\r\n * @param   {string|array}  args.A.switch   -  Sometimes,   you  are\r\n * listening at  a property  A to  change, but  want to  propagate the\r\n * value  of  B. It  is  usefull  with  buttons which  provide  action\r\n * properties.\r\n * So this attribute  tells the link what property to  read instead of\r\n * the one  we are  listening on.  Moreover, if you  give an  array of\r\n * property names, the  value will be an array with  the values of all\r\n * asked properties.\r\n * @param {boolean=true}  args.A.open -  If false,  no data  will be\r\n * accepted by `A`.\r\n */\r\nvar Link = function( args ) {\r\n  try {\r\n    var id = ID++;\r\n    checkArgs.call( this, args );\r\n\r\n    var onChangedA = link.call( this, args, id, \"A\", \"B\" );\r\n    var onChangedB = link.call( this, args, id, \"B\", \"A\" );\r\n    addDestroyFunction.call( this, onChangedA, onChangedB );\r\n  }\r\n  catch( ex ) {\r\n    console.error(\"new Link( \" + args + \" )\");\r\n    fail( ex, \"new Link( <args> ) \" + (this.name || \"\") );\r\n  }\r\n\r\n};\r\n\r\n\r\nmodule.exports = Link;\r\n\r\n\r\nfunction link( args, id, emitterKey, receiverKey ) {\r\n  var that = this;\r\n\r\n  var onChanged = [];\r\n  args[receiverKey].forEach(function (receiver, receiverIndex) {\r\n    if( !receiver.open ) return;\r\n    var pmReceiver = PropertyManager( receiver.obj );\r\n    args[emitterKey].forEach(function (emitter, emitterIndex) {\r\n      if( typeof emitter.name === 'string'\r\n          && typeof receiver.name === 'string'\r\n          && emitter.obj === receiver.obj\r\n          && emitter.name === receiver.name )\r\n      {\r\n        console.error(\r\n          \"It is forbidden to bind a property on itself! (\"\r\n            + emitterIndex + \" -> \" + receiverIndex + \")\"\r\n        );\r\n        console.info(\"[tfw.binding.link] args=\", args);\r\n        return;\r\n      }\r\n      var pmEmitter = PropertyManager( emitter.obj );\r\n      var slot = actionChanged.bind( that, emitter, receiver, id );\r\n      pmEmitter.on( emitter.name, slot );\r\n      onChanged.push({ pm: pmEmitter, name: emitter.name, slot: slot });\r\n    });\r\n  });\r\n  return onChanged;\r\n}\r\n\r\nfunction addDestroyFunction( onSrcChanged, onDstChanged ) {\r\n  this.destroy = function() {\r\n    onSrcChanged.forEach(function (item) {\r\n      item.pm.off( item.name, item.slot );\r\n    });\r\n    onDstChanged.forEach(function (item) {\r\n      item.pm.off( item.name, item.slot );\r\n    });\r\n  };\r\n}\r\n\r\nfunction actionChanged( src, dst, id, value, propertyName, container, wave ) {\r\n  if( !Array.isArray( wave ) ) wave = [];\r\n\r\n  if( this.dbg ) {\r\n    console.log( \"Link \" + this.dbg + \": \", {\r\n      src: src, dst: dst, id: id, value: value, propertyName: propertyName, container: container, wave: wave\r\n    } );\r\n  }\r\n  if( hasAlreadyBeenHere( id, wave ) ) {\r\n    if( this.dbg ) {\r\n      console.log( \"...has been BLOCKED by the wave! \", wave );\r\n    }\r\n    return;\r\n  }\r\n\r\n  var that = this;\r\n\r\n  var pmSrc = PropertyManager( src.obj );\r\n  var pmDst = PropertyManager( dst.obj );\r\n\r\n  value = processValue( value, src, dst );\r\n  value = processSwitch( value, dst, pmSrc );\r\n  value = processConverter( value, src, dst );\r\n  if( filterFailed( value, src, dst ) ) {\r\n    if( this.dbg ) console.log( \"...has been FILTERED!\" );\r\n    return;\r\n  }\r\n  value = processFormat( value, src, dst );\r\n  value = processMap( value, src, dst );\r\n\r\n  if( typeof dst.delay === 'number' ) {\r\n    if( this.debug ) console.log( \"...has been DELAYED for \" + dst.delay + \" ms!\" );\r\n    clearTimeout( dst._id );\r\n    dst._id = setTimeout(function() {\r\n      if( that.dbg ) {\r\n        console.log( \"Link \" + that.dbg + \" (after \" + dst.delay + \" ms): \", {\r\n          src: src, dst: dst, id: id, value: value, propertyName: propertyName, wave: wave\r\n        } );\r\n        console.log(\"...try to change a value. \", {\r\n          target: pmDst,\r\n          propertyName: dst.name,\r\n          value: value,\r\n          wave: wave\r\n        });\r\n      }\r\n      pmDst.change( dst.name, value, wave );\r\n    }, dst.delay);\r\n  } else {\r\n    if( this.debug )\r\n      console.log(\"...try to change a value. \", {\r\n        target: pmDst,\r\n        propertyName: dst.name,\r\n        value: value,\r\n        wave: wave\r\n      });\r\n    pmDst.change( dst.name, value, wave );\r\n  }\r\n}\r\n\r\n\r\nfunction checkArgs( args ) {\r\n  try {\r\n    if( typeof args.name === 'undefined' ) args.name = args.debug;\r\n    if( typeof args.name !== 'string' ) args.name = \"Link#\" + this.id;\r\n    if( typeof args === 'undefined' ) fail(\"Missing mandatory argument!\");\r\n    if( typeof args.A === 'undefined' ) fail(\"Missing `args.A`!\");\r\n    if( !Array.isArray( args.A ) ) args.A = [args.A];\r\n    if( typeof args.B === 'undefined' ) fail(\"Missing `args.B`!\");\r\n    if( !Array.isArray( args.B ) ) args.B = [args.B];\r\n\r\n    var k;\r\n    for( k = 0 ; k < args.A.length ; k++ ) {\r\n      checkPod( args.A[k], k );\r\n    }\r\n    for( k = 0 ; k < args.B.length ; k++ ) {\r\n      checkPod( args.B[k], k );\r\n    }\r\n\r\n    // For debugging.\r\n    this.name = args.name;\r\n    this.debug = args.debug;\r\n  }\r\n  catch( ex ) {\r\n    console.error(\"checkArgs( \" + args + \" )\");\r\n    fail( ex, \"checkArgs( <args> )\" );\r\n  }\r\n}\r\n\r\nfunction checkPod( pod, index ) {\r\n  try {\r\n    if( !pod.action ) {\r\n      if( typeof pod.obj === 'undefined' ) fail(\"Missing `[\" + index + \"].obj`!\");\r\n      if( typeof pod.name === 'undefined' ) pod.name = \"*\";\r\n      // Check if the attribute exists.\r\n      if( !PropertyManager.isLinkable( pod.obj, pod.name ) )\r\n        throw \"`\" + pod.name + \"` is not a linkable attribute.\\n\"\r\n        + \"Valid linkable attributes are: \"\r\n        + PropertyManager.getAllAttributesNames( pod.obj ).join(\", \") + \".\";\r\n    }\r\n    else if ( typeof pod.action !== 'function' ) {\r\n      throw \"Attribute `[\" + index + \"].action` must be a function!\";\r\n    }\r\n    else {\r\n      if( typeof pod.obj !== 'undefined' )\r\n        throw \"[\" + index + \"].action cannot be defined in the same time of [\"\r\n        + index + \"].obj! They are exclusive attributes.\";\r\n      if( typeof pod.name !== 'undefined' )\r\n        throw \"[\" + index + \"].action cannot be defined in the same time of [\"\r\n        + index + \"].name! They are exclusive attributes.\";\r\n\r\n      // An action is emulated by a hollow object.\r\n      var hollowObject = {};\r\n      PropertyManager( hollowObject ).create(\"<action>\", {\r\n        set: pod.action\r\n      });\r\n      pod.obj = hollowObject;\r\n      pod.name = \"<action>\";\r\n    }\r\n    if( typeof pod.open === 'undefined' ) pod.open = true;\r\n  }\r\n  catch( ex ) {\r\n    console.error(\"checkpod(\", pod, \", \", index, \")\");\r\n    fail( ex, \"checkpod( <pod>, \" + index + \")\" );\r\n  }\r\n}\r\n\r\n\r\nfunction fail( msg, source ) {\r\n  if( typeof source === 'undefined' ) {\r\n    source = \"\";\r\n  } else {\r\n    source = \"::\" + source;\r\n  }\r\n  throw msg + \"\\n\" + \"[tfw.binding.link\" + source + \"]\";\r\n}\r\n\r\n\r\nfunction hasAlreadyBeenHere( id, wave ) {\r\n  if( Array.isArray( wave ) ) {\r\n    if( wave.indexOf( id ) < 0 ) {\r\n      // Remember we took this path.\r\n      wave.push( id );\r\n    } else {\r\n      // We already took this link in this wave.\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\n\r\nfunction filterFailed(value, src, dst) {\r\n  if( typeof dst.filter === 'function' ) {\r\n    try {\r\n      if( !dst.filter( value ) ) return true;\r\n    }\r\n    catch( ex ) {\r\n      console.error( ex );\r\n      fail(\r\n        \"Error in filter of link \"\r\n          + PropertyManager(src.obj) + \".\" + src.name\r\n          + \" -> \"\r\n          + PropertyManager(dst.obj) + \".\" + dst.name + \"!\"\r\n      );\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\n\r\nfunction processSwitch( value, dst, pmSrc ) {\r\n  if( typeof dst.switch === 'string' ) {\r\n    return pmSrc.get( dst.switch );\r\n  }\r\n  else if( Array.isArray( dst.switch ) ) {\r\n    return dst.switch.map(function(name) {\r\n      return pmSrc.get( name );\r\n    });\r\n  }\r\n  return value;\r\n}\r\n\r\n\r\nfunction processConverter( value, src, dst ) {\r\n  if( typeof dst.converter === 'function' ) {\r\n    try {\r\n      return dst.converter( value );\r\n    }\r\n    catch( ex ) {\r\n      console.error( ex );\r\n      fail(\r\n        \"Error in converter of link \"\r\n          + PropertyManager(src.obj) + \".\" + src.name\r\n          + \" -> \"\r\n          + PropertyManager(dst.obj) + \".\" + dst.name + \"!\"\r\n      );\r\n    }\r\n  }\r\n  return value;\r\n}\r\n\r\n\r\n/**\r\n * `format` is used  with an intl function.  It must  be an array with\r\n * two elements: a function and a string.  The function will be called\r\n * with the  string as first argument  and the `value` as  second. The\r\n * result will be the transformed value.\r\n */\r\nfunction processFormat( value, src, dst ) {\r\n  if( !dst.format ) return value;\r\n  try {\r\n    if( !Array.isArray( dst.format ) )\r\n      throw \"Must be an array with two elements!\";\r\n    var intlFunc = dst.format[0];\r\n    if( typeof intlFunc !== 'function' )\r\n      throw \"First element of the array must be a function!\";\r\n    var intlId = dst.format[1];\r\n    if( typeof intlId !== 'string' )\r\n      throw \"Second element of the array must be a string!\";\r\n    return intlFunc( intlId, value );\r\n  }\r\n  catch( ex ) {\r\n    console.error( ex );\r\n    fail(\r\n      \"Error in format of link \"\r\n        + PropertyManager(src.obj) + \".\" + src.name\r\n        + \" -> \"\r\n        + PropertyManager(dst.obj) + \".\" + dst.name + \"!\\n\"\r\n        + ex\r\n    );\r\n  }\r\n}\r\n\r\n\r\nfunction processMap( value, src, dst ) {\r\n  if( value && typeof value.map === 'function' && typeof dst.map === 'function' ) {\r\n    try {\r\n      var result = [];\r\n      var more = {\r\n        context: {},\r\n        list: value,\r\n        index: 0\r\n      };\r\n      if( typeof dst.header === 'function' ) {\r\n        try {\r\n          result.push(dst.header( value, more.context ));\r\n        }\r\n        catch( ex ) {\r\n          console.error(\"[tfw.binding.link/processMap] Exception while calling a header function: \", ex);\r\n          console.error({\r\n            value: value,\r\n            src: src,\r\n            dst: dst,\r\n            more: more\r\n          });\r\n        }\r\n      }\r\n      value.forEach(function (itm, idx) {\r\n        more.index = idx;\r\n        try {\r\n          result.push( dst.map( itm, more ) );\r\n        }\r\n        catch( ex ) {\r\n          console.error(\"[tfw.binding.link/processMap] Exception while calling a map function: \", ex);\r\n          console.error({\r\n            item: itm,\r\n            index: idx,\r\n            value: value,\r\n            src: src,\r\n            dst: dst,\r\n            result: result,\r\n            more: more\r\n          });\r\n        }\r\n      });\r\n\r\n      if( typeof dst.footer === 'function' ) {\r\n        try {\r\n          result.push(dst.header( value, more.context ));\r\n        }\r\n        catch( ex ) {\r\n          console.error(\"[tfw.binding.link/processMap] Exception while calling a footer function: \", ex);\r\n          console.error({\r\n            value: value,\r\n            src: src,\r\n            dst: dst,\r\n            result: result,\r\n            more: more\r\n          });\r\n        }\r\n      }\r\n      \r\n      return result.filter(function( item ) {\r\n        return item != null;\r\n      });\r\n    }\r\n    catch( ex ) {\r\n      console.error( ex );\r\n      fail(\r\n        \"Error in map of link \"\r\n          + PropertyManager(src.obj) + \".\" + src.name\r\n          + \" -> \"\r\n          + PropertyManager(dst.obj) + \".\" + dst.name + \"!\"\r\n      );\r\n    }\r\n  }\r\n  return value;\r\n}\r\n\r\n\r\nfunction processValue( value, src, dst ) {\r\n  if( typeof dst.value === 'undefined' ) return value;\r\n  if( typeof dst.value === 'function' ) {\r\n    try {\r\n      return dst.value( src.name );\r\n    }\r\n    catch( ex ) {\r\n      console.error( ex );\r\n      fail(\r\n        \"Error in value(\" + src.name + \") of link \"\r\n          + PropertyManager(src.obj) + \".\" + src.name\r\n          + \" -> \"\r\n          + PropertyManager(dst.obj) + \".\" + dst.name + \"!\"\r\n      );\r\n    }\r\n  }\r\n  return dst.value;\r\n}\r\n\r\n\r\n\r\nmodule.exports._ = _;\n})"]}
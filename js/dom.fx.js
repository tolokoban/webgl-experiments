"use strict";require("dom.fx",function(require,module){function Fx(name){this._session={},Object.defineProperty(Fx.prototype,"name",{value:name,writable:!1,configurable:!0,enumerable:!0}),this._name=name,this._tasks=[],this._index=0,this._started=!1,this._startTime=0,this._onEnd=EMPTY_FUNC}function next(session){if(session===this._session){if(this._index>=this._tasks.length)return this._index=0,this._started=!1,delete this._session,void this._onEnd(this);var that=this,tsk=this._tasks[this._index++];this._debug&&console.info("[dom.fx] tsk[".concat(this._index-1,"]: "),tsk.label,"(".concat(Date.now()-this._startTime," ms)"),tsk.args,session),tsk(function(){delay(next.bind(that,session))},!0)}}function fullscreenOn(target,tools){tools.terminate&&tools.terminate();var rect=target.getBoundingClientRect();console.info("[dom.fx] rect=...",rect);var substitute=$.div();$.css(substitute,{display:"inline-block",width:rect.width+"px",height:rect.height+"px"}),tools.onBeforeReplace(target),$.replace(substitute,target),tools.onAfterReplace(target),tools.substitute=substitute,tools.styles=saveStyles(target),tools.overlay=$.div("dom-fx-fullscreen"),document.body.appendChild(tools.overlay),tools.overlay.appendChild(target),$.css(target,{left:rect.left+"px",top:rect.top+"px",width:rect.width+"px",height:rect.height+"px"}),$.addClass(target,"dom-fx-fullscreen-target"),delay(function(){var r2=tools.overlay.getBoundingClientRect();$.css(target,{left:"20px",top:"20px",width:r2.width-40+"px",height:r2.height-40+"px"})})}function fullscreenOff(target,tools){var rect=tools.substitute.getBoundingClientRect();$.css(target,{left:rect.left+"px",top:rect.top+"px",width:rect.width+"px",height:rect.height+"px"}),tools.terminate=function(){$.detach(tools.overlay),tools.onBeforeReplace(target),$.replace(target,tools.substitute),tools.onAfterReplace(target),loadStyles(target,tools.styles),delete tools.terminate},delay(tools.terminate,200)}function saveStyles(element){var key,val,styles={};for(key in element.style)val=element.style[key],styles[key]=val;return console.info("[dom.fx] styles=...",styles),styles}function loadStyles(element,styles){for(var key in styles)element.style[key]=styles[key]}var _=function(){function _(){return X(D,arguments)}var D={en:{}},X=require("$").intl;return _.all=D,_}();"use strict",require("polyfill.promise");var $=require("dom"),DB=require("tfw.data-binding"),EMPTY_FUNC=function(){},ID=1,delay=window.setTimeout;Fx.prototype.start=function(_onEnd){var onEnd="undefined"==typeof _onEnd?EMPTY_FUNC:_onEnd;this._started&&this.end(),this._onEnd=onEnd,this._started=!0,this._index=0,this._session={$id:ID++},this._startTime=Date.now(),next.call(this,this._session)},Fx.prototype.end=function(){if(!this._started)return this;var that=this;for(this._started=!1,delete this._session;this._index<this._tasks.length;){var tsk=this._tasks[this._index++];that._debug&&console.info("[dom.fx.end] tsk["+(this._index-1)+"]: ",tsk.label,tsk.args),tsk(EMPTY_FUNC,!1)}return this._onEnd(this),this},Fx.prototype.debug=function(value){return this.addTask(function(next){this._debug=!!value,next()}),this},Fx.prototype.addTask=function(task,label,args){return task.label=label,task.args=args,this._tasks.push(task),this},Fx.prototype.log=function(msg){return this.addTask(function(next){console.log("[dom.fx]",msg),next()},"log"),this},Fx.prototype.pause=function(){return this.addTask(EMPTY_FUNC,"pause"),this},Fx.prototype.exec=function(){var args=Array.prototype.slice.call(arguments);return this.addTask(function(next,session){args.forEach(function(arg){try{"function"==typeof arg?arg(session):console.log("[dom.fx]",arg)}catch(ex){console.error(ex)}}),next()},"exec",args),this},["css","addClass","removeClass","toggleClass","detach","saveStyle","restoreStyle","add","removeAtt","replace"].forEach(function(methodname){var slot=$[methodname];Fx.prototype[methodname]=function(){var args=Array.prototype.slice.call(arguments);return this.addTask(function(next){slot.apply($,args),next()},methodname,args),this}}),Fx.prototype.vanish=function(elem,ms){return ms=parseInt(ms),isNaN(ms)&&(ms=300),this.css(elem,{transition:"none"}).css(elem,{transition:"opacity "+ms+"ms",opacity:0}).wait(ms)},Fx.prototype.vanishAndDetach=function(elem,ms){return ms=parseInt(ms),isNaN(ms)&&(ms=300),this.vanish(elem,ms).detach(elem)},Fx.prototype.wait=function(msOrElem){var that=this,args=Array.prototype.slice.call(arguments);return"undefined"==typeof msOrElem&&(msOrElem=0),"number"==typeof msOrElem?this.addTask(function(next,async){async&&delay(next,msOrElem)},"wait",args):this.addTask(function(next,async){if(async){var e=$(msOrElem),slot=function(){["transitionend","oTransitionEnd","webkitTransitionEnd"].forEach(function(itm){e.removeEventListener(itm,slot)}),next()};["transitionend","oTransitionEnd","webkitTransitionEnd"].forEach(function(itm){e.addEventListener(itm,slot)})}},"wait",args),this},module.exports=function(name){return new Fx(name)},module.exports.Fullscreen=function(opts){if("undefined"==typeof opts)throw Error("[dom.fx:fullscreen] Missing argument!");if("undefined"==typeof opts.target)throw Error("[dom.fx:fullscreen] Missing `opts.target`!");"function"==typeof opts.target.element&&(opts.target=opts.target.element()),"undefined"!=typeof opts.target.element&&(opts.target=opts.target.element);var voidFunc=function(){},tools={onBeforeReplace:"function"==typeof opts.onBeforeReplace?opts.onBeforeReplace:voidFunc,onAfterReplace:"function"==typeof opts.onAfterReplace?opts.onAfterReplace:voidFunc};DB.propBoolean(this,"value")(function(isFullScreen){isFullScreen?fullscreenOn(opts.target,tools):fullscreenOff(opts.target,tools)})},module.exports._=_});
//# sourceMappingURL=dom.fx.js.map
"use strict";require("tfw.data-binding",function(require,module,exports){function propCast(caster,obj,att,val){var hasSpecialGetter="function"==typeof val;"undefined"==typeof obj["_tfw.data-binding_"]&&(obj["_tfw.data-binding_"]={}),obj["_tfw.data-binding_"][att]={value:val,event:new Listeners};var setter="function"==typeof caster?function(v){v=caster(v),(hasSpecialGetter||obj["_tfw.data-binding_"][att].value!==v)&&(obj["_tfw.data-binding_"][att].value=v,obj["_tfw.data-binding_"][att].event.fire(v,obj,att))}:function(v){(hasSpecialGetter||obj["_tfw.data-binding_"][att].value!==v)&&(obj["_tfw.data-binding_"][att].value=v,obj["_tfw.data-binding_"][att].event.fire(v,obj,att))};var getter=val;return hasSpecialGetter||(getter=function(){return obj["_tfw.data-binding_"][att].value}),Object.defineProperty(obj,att,{get:getter,set:setter,configurable:!1,enumerable:!0}),exports.bind.bind(exports,obj,att)}function toLowerCase(txt){return txt.toLowerCase()}function trim(txt){return txt.trim()}var _=function(){function _(){return X(D,arguments)}var D={en:{}},X=require("$").intl;return _.all=D,_}();"use strict",require("polyfill.string");var $=require("dom"),ParseUnit=require("tfw.css").parseUnit,Listeners=require("tfw.listeners"),ID="_tfw.data-binding_",converters={castFunction:function castFunction(v){return"function"==typeof v?v:null},castArray:function castArray(v){return Array.isArray(v)?v:null===v||void 0===v?[]:[v]},castBoolean:function castBoolean(v){return"boolean"==typeof v?v:"string"==typeof v?(v=v.trim().toLowerCase(),"0"!==v&&"false"!==v&&"no"!==v&&"null"!==v&&"undefined"!==v):"number"==typeof v?0!==v:null},castColor:function castColor(v){return""+v},castDate:function castDate(v){return"number"==typeof v||"string"==typeof v?new Date(v):v instanceof Date?v:new Date},castEnum:function castEnum(enumeration){var lowerCaseEnum=enumeration.map(toLowerCase);return function(v){if("number"==typeof v)return enumeration[Math.floor(v)%enumeration.length];if("string"!=typeof v)return enumeration[0];var idx=lowerCaseEnum.indexOf(v.trim().toLowerCase());return 0>idx&&(idx=0),enumeration[idx]}},castInteger:function castInteger(v){return"number"==typeof v?Math.floor(v):"boolean"==typeof v?v?1:0:"string"==typeof v?parseInt(v):Number.NaN},castFloat:function castFloat(v){return"number"==typeof v?v:"boolean"==typeof v?v?1:0:"string"==typeof v?parseFloat(v):Number.NaN},castRegexp:function castRegexp(v){if(v instanceof RegExp)return v;if("string"==typeof v&&0!=v.trim().length)try{return new RegExp(v)}catch(ex){console.error("[castRegexp] /"+v+"/ ",ex)}return null},castString:function castString(v){return"string"==typeof v?v:void 0===v||null===v?"":JSON.stringify(v)},castStringArray:function castStringArray(v){return Array.isArray(v)?v:null===v||void 0===v?[]:"string"==typeof v?v.split(",").map(trim):[JSON.stringify(v)]},castUnit:function castUnit(v){return v?"undefined"==typeof v.v?"number"==typeof v?{v:v,u:"px"}:"string"==typeof v?ParseUnit(""+v):{v:0,u:"px"}:(v.v=parseFloat(v.v),isNaN(v.v))?{v:0,u:"px"}:(v.u="string"==typeof v.u?v.u.trim().toLowerCase():"px",""===v.u&&(v.u="px"),{v:v.v,u:v.u}):{v:0,u:"px"}},castValidator:function castValidator(v){if("function"==typeof v)return v;if("boolean"==typeof v)return function(){return v};if("string"==typeof v&&0!=v.trim().length)try{var rx=new RegExp(v);return rx.test.bind(rx)}catch(ex){console.error("[castValidator] /"+v+"/ ",ex)}return function(){return null}}};exports.fire=function(obj,att,val){var currentValue=obj[att];"undefined"==typeof val&&(val=currentValue),obj[ID][att].value=val,obj[ID][att].event.fire(obj[att],obj,att)},exports.set=function(obj,att,val){"undefined"==typeof obj[ID]&&(obj[ID]={}),"undefined"==typeof obj[ID][att]&&(obj[ID][att]={}),obj[ID][att].value=val},exports.get=function(obj,att){return"undefined"==typeof obj[ID]||"undefined"==typeof obj[ID][att]?void 0:obj[ID][att].value},exports.readOnly=function(obj,name,value){"function"==typeof value?Object.defineProperty(obj,name,{get:value,set:function set(){},configurable:!1,enumerable:!0}):Object.defineProperty(obj,name,{value:value,writtable:!1,configurable:!1,enumerable:!0})},exports.prop=propCast.bind(null,null),exports.propWidget=function(obj,att,widget,widgetAttribute){return"undefined"==typeof widgetAttribute&&(widgetAttribute=att),"undefined"==typeof obj[ID]&&(obj[ID]={}),obj[ID][att]={event:new Listeners},exports.bind(widget,widgetAttribute,function(v){obj[ID][att].event.fire(v,obj,att)}),Object.defineProperty(obj,att,{get:function get(){return widget[widgetAttribute]},set:function set(v){widget[widgetAttribute]=v},configurable:!1,enumerable:!0}),exports.bind.bind(exports,obj,att)},exports.propToggleClass=function(target,attribute,values,prefix){"string"!=typeof prefix&&(prefix="");var convertedValues={};return"string"==typeof values?convertedValues[values]=values:Array.isArray(values)?values.forEach(function(itm){convertedValues[itm]=itm}):convertedValues=values,propCast(null,target,attribute)(function(v){var key,val;for(key in convertedValues)val=convertedValues[key],key==v?$.addClass(target.element,prefix+val):$.removeClass(target.element,prefix+val)})},exports.propAddClass=function(target,attribute,className){return"undefined"==typeof className&&(className=attribute),propCast(converters.castBoolean,target,attribute)(function(v){v?$.addClass(target.element,className):$.removeClass(target.element,className)})},exports.propRemoveClass=function(target,attribute,className){return"undefined"==typeof className&&(className=attribute),propCast(converters.castBoolean,target,attribute)(function(v){v?$.removeClass(target.element,className):$.addClass(target.element,className)})},exports.propArray=propCast.bind(null,converters.castArray),exports.propBoolean=propCast.bind(null,converters.castBoolean),exports.propColor=propCast.bind(null,converters.castColor),exports.propDate=propCast.bind(null,converters.castDate),exports.propEnum=function(enumeration){return propCast.bind(null,converters.castEnum(enumeration))},exports.propFunction=propCast.bind(null,converters.castFunction),exports.propInteger=propCast.bind(null,converters.castInteger),exports.propFloat=propCast.bind(null,converters.castFloat),exports.propRegexp=propCast.bind(null,converters.castRegexp),exports.propString=propCast.bind(null,converters.castString),exports.propStringArray=propCast.bind(null,converters.castStringArray),exports.propUnit=propCast.bind(null,converters.castUnit),exports.propValidator=propCast.bind(null,converters.castValidator),exports.bind=function(srcObj,srcAtt,dstObj,dstAtt,options){if("undefined"==typeof srcObj[ID]||"undefined"==typeof srcObj[ID][srcAtt])throw console.error(JSON.stringify(srcAtt)+" is not a bindable property!",{srcObj:srcObj,srcAtt:srcAtt,dstObj:dstObj,dstAtt:dstAtt,options:options}),Error(JSON.stringify(srcAtt)+" is not a bindable property!");"undefined"==typeof options&&(options={}),options.value&&(options.converter=function(){return options.value});var lambda="function"==typeof dstObj?dstObj:function(v){dstObj[dstAtt]="function"==typeof options.converter?options.converter(v):v};return srcObj[ID][srcAtt].event.add(lambda),options},exports.extend=function(_def,_ext,_obj,callback){var ext=_ext||{},obj=_obj||{},out=JSON.parse(JSON.stringify(_def||{})),extKeys=Object.keys(ext);return extKeys.forEach(function(key){if("$"!==key.charAt(0)){var val=ext[key];"undefined"==typeof out[key]?console.error("[tfw.data-binding.extend] Undefined argument: \"".concat(key,"\"!")):out[key]=val}}),"undefined"!=typeof obj&&(extKeys.forEach(function(key){"$"!==key.charAt(0)||Object.defineProperty(obj,key,{value:ext[key],writable:!1,configurable:!1,enumerable:!1})}),Object.keys(out).forEach(function(key){if("$"!==key.charAt(0))try{obj[key]=out[key]}catch(ex){console.error("Trying to extend property \"".concat(key,"\" of object "),obj),console.error("...with object ",out),console.error("...but got ",ex)}}),"function"==typeof callback&&(Object.keys(obj[ID]).forEach(function(key){exports.bind(obj,key,callback)}),callback())),out},exports.converters=converters,module.exports._=_});
//# sourceMappingURL=tfw.data-binding.js.map
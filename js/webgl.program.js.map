{"version":3,"sources":["webgl.program.js"],"names":["require","module","Program","gl","codes","includes","vert","Error","frag","parseIncludes","Object","freeze","BPE","_typesNamesLookup","getTypesNamesLookup","shaderProgram","createProgram","attachShader","getVertexShader","getFragmentShader","linkProgram","program","use","useProgram","createAttributes","createUniforms","that","index","item","attribs","attribsCount","getProgramParameter","ACTIVE_ATTRIBUTES","getActiveAttrib","typeName","getTypeName","type","length","getSize","location","getAttribLocation","name","console","info","uniforms","uniformsCount","ACTIVE_UNIFORMS","getActiveUniform","getUniformLocation","defineProperty","set","createUniformSetter","get","createUniformGetter","enumerable","configurable","id","code","result","split","map","line","trim","substr","pos","indexOf","includeName","charAt","snippet","error","join","nameGL","lookup","nameJS","BYTE","UNSIGNED_BYTE","SHORT","UNSIGNED_SHORT","INT","UNSIGNED_INT","SAMPLER_2D","size","v","uniform1i","uniform1iv","FLOAT","uniform1f","uniform1fv","FLOAT_VEC2","uniform2fv","FLOAT_VEC3","uniform3fv","FLOAT_VEC4","uniform4fv","FLOAT_MAT3","uniformMatrix3fv","FLOAT_MAT4","uniformMatrix4fv","getShader","shader","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","log","getShaderInfoLog","FRAGMENT_SHADER","VERTEX_SHADER","k","_","X","D","arguments","intl","all","Float32Array","BYTES_PER_ELEMENT","prototype","typeId","bindAttribs","buffer","bindBuffer","ARRAY_BUFFER","names","Array","slice","call","totalSize","forEach","attrib","keys","offset","enableVertexAttribArray","vertexAttribPointer","exports"],"mappings":"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","sourcesContent":["/** @module webgl.program */require( 'webgl.program', function(require, module, exports) { var _=function(){var D={\"en\":{},\"fr\":{}},X=require(\"$\").intl;function _(){return X(D,arguments);}_.all=D;return _}();\r\n   \"use strict\";\r\n\r\nvar BPE = ( new Float32Array() ).BYTES_PER_ELEMENT;\r\n\r\n/**\r\n * Creating  a  WebGL  program  for shaders  is  painful.  This  class\r\n * simplifies the process.\r\n *\r\n * @class Program\r\n *\r\n * Object properties starting with `$` are WebGL uniforms or attributes.\r\n * Uniforms behave as expected: you can read/write a value.\r\n * Attributes when read, return the location. And when written, enable/disabled\r\n * this attribute. So you read integers and writte booleans.\r\n *\r\n * @param gl - WebGL context.\r\n * @param codes  - Object  with two  mandatory attributes:  `vert` for\r\n * vertex shader and `frag` for fragment shader.\r\n * @param  includes  -  (optional)  If  defined,  the  `#include  foo`\r\n * directives  of  shaders   will  be  replaced  by   the  content  of\r\n * `includes.foo`.\r\n */\r\nfunction Program( gl, codes, includes ) {\r\n  if ( typeof codes.vert !== 'string' ) {\r\n    throw Error( '[webgl.program] Missing attribute `vert` in argument `codes`!' );\r\n  }\r\n  if ( typeof codes.frag !== 'string' ) {\r\n    throw Error( '[webgl.program] Missing attribute `frag` in argument `codes`!' );\r\n  }\r\n\r\n  codes = parseIncludes( codes, includes );\r\n\r\n  this.gl = gl;\r\n  Object.freeze( this.gl );\r\n  this.BPE = BPE;\r\n  Object.freeze( this.BPE );\r\n  \r\n  this._typesNamesLookup = getTypesNamesLookup( gl );\r\n\r\n  var shaderProgram = gl.createProgram();\r\n  gl.attachShader( shaderProgram, getVertexShader( gl, codes.vert ) );\r\n  gl.attachShader( shaderProgram, getFragmentShader( gl, codes.frag ) );\r\n  gl.linkProgram( shaderProgram );\r\n\r\n  this.program = shaderProgram;\r\n  Object.freeze( this.program );\r\n\r\n  this.use = function () {\r\n    gl.useProgram( shaderProgram );\r\n  };\r\n  this.use();\r\n\r\n  createAttributes( this, gl, shaderProgram );\r\n  createUniforms( this, gl, shaderProgram );\r\n}\r\n\r\nProgram.prototype.getTypeName = function ( typeId ) {\r\n  return this._typesNamesLookup[ typeId ];\r\n};\r\n\r\nProgram.prototype.bindAttribs = function ( buffer ) {\r\n  var gl = this.gl;\r\n  gl.bindBuffer( gl.ARRAY_BUFFER, buffer );\r\n  var names = Array.prototype.slice.call( arguments, 1 );\r\n  var totalSize = 0;\r\n  names.forEach( function ( name ) {\r\n    var attrib = this.attribs[ name ];\r\n    if ( !attrib ) {\r\n      throw \"Cannot find attribute \\\"\" + name + \"\\\"!\\n\" +\r\n        \"It may be not active because unused in the shader.\\n\" +\r\n        \"Available attributes are: \" + Object.keys( this.attribs ).map( function ( name ) {\r\n          return '\"' + name + '\"';\r\n        } ).join( \", \" );\r\n    }\r\n    totalSize += ( attrib.size * attrib.length ) * BPE;\r\n  }, this );\r\n  var offset = 0;\r\n  names.forEach( function ( name ) {\r\n    var attrib = this.attribs[ name ];\r\n    gl.enableVertexAttribArray( attrib.location );\r\n    gl.vertexAttribPointer(\r\n      attrib.location,\r\n      attrib.size * attrib.length,\r\n      gl.FLOAT,\r\n      false, // No normalisation.\r\n      totalSize,\r\n      offset\r\n    );\r\n    offset += ( attrib.size * attrib.length ) * BPE;\r\n  }, this );\r\n};\r\n\r\nmodule.exports = Program;\r\n\r\n\r\nfunction createAttributes( that, gl, shaderProgram ) {\r\n  var index, item;\r\n  var attribs = {};\r\n  var attribsCount = gl.getProgramParameter( shaderProgram, gl.ACTIVE_ATTRIBUTES );\r\n  for ( index = 0; index < attribsCount; index++ ) {\r\n    item = gl.getActiveAttrib( shaderProgram, index );\r\n    item.typeName = that.getTypeName( item.type );\r\n    item.length = getSize( gl, item );\r\n    item.location = gl.getAttribLocation( shaderProgram, item.name );\r\n    console.info( \"item=\", item );\r\n    attribs[ item.name ] = item;\r\n  }\r\n\r\n  that.attribs = attribs;\r\n  Object.freeze( that.attribs );\r\n}\r\n\r\nfunction createAttributeSetter( gl, item, shaderProgram ) {\r\n  console.info( \"item=\", item );\r\n  var name = item.name;\r\n  return function ( v ) {\r\n    if ( typeof v !== 'boolean' ) {\r\n      throw \"[webgl.program::$\" + name +\r\n        \"] Value must be a boolean: true if you want to enable this attribute, and false to disable it.\";\r\n    }\r\n    if ( v ) {\r\n      console.log( \"enableVertexAttribArray(\", gl.getAttribLocation( shaderProgram, name ), \")\" );\r\n      gl.enableVertexAttribArray(\r\n        gl.getAttribLocation( shaderProgram, name )\r\n      );\r\n    } else {\r\n      gl.disableVertexAttribArray(\r\n        gl.getAttribLocation( shaderProgram, name )\r\n      );\r\n    }\r\n  };\r\n}\r\n\r\nfunction createAttributeGetter( gl, item, shaderProgram ) {\r\n  var loc = gl.getAttribLocation( shaderProgram, item.name );\r\n  return function () {\r\n    return loc;\r\n  };\r\n}\r\n\r\nfunction createUniforms( that, gl, shaderProgram ) {\r\n  var index, item;\r\n  var uniforms = {};\r\n  var uniformsCount = gl.getProgramParameter( shaderProgram, gl.ACTIVE_UNIFORMS );\r\n  for ( index = 0; index < uniformsCount; index++ ) {\r\n    item = gl.getActiveUniform( shaderProgram, index );\r\n    uniforms[ item.name ] = gl.getUniformLocation( shaderProgram, item.name );\r\n    Object.defineProperty( that, '$' + item.name, {\r\n      set: createUniformSetter( gl, item, uniforms[ item.name ], that._typesNamesLookup ),\r\n      get: createUniformGetter( item ),\r\n      enumerable: true,\r\n      configurable: false\r\n    } );\r\n  }\r\n  that.uniforms = uniforms;\r\n  Object.freeze( that.uniforms );\r\n}\r\n\r\n/**\r\n * This is a preprocessor for shaders.\r\n * Directives  `#include`  will be  replaced  by  the content  of  the\r\n * correspondent attribute in `includes`.\r\n */\r\nfunction parseIncludes( codes, includes ) {\r\n  var result = {};\r\n  var id, code;\r\n  for ( id in codes ) {\r\n    code = codes[ id ];\r\n    result[ id ] = code.split( '\\n' ).map( function ( line ) {\r\n      if ( line.trim().substr( 0, 8 ) != '#include' ) return line;\r\n      var pos = line.indexOf( '#include' ) + 8;\r\n      var includeName = line.substr( pos ).trim();\r\n      // We accept all this systaxes:\r\n      // #include foo\r\n      // #include 'foo'\r\n      // #include <foo>\r\n      // #include \"foo\"\r\n      if ( \"'<\\\"\".indexOf( includeName.charAt( 0 ) ) > -1 ) {\r\n        includeName = includeName.substr( 1, includeName.length - 2 );\r\n      }\r\n      var snippet = includes[ includeName ];\r\n      if ( typeof snippet !== 'string' ) {\r\n        console.error( \"Include <\" + includeName + \"> not found in \", includes );\r\n        throw Error( \"Include not found in shader: \" + includeName );\r\n      }\r\n      return snippet;\r\n    } ).join( \"\\n\" );\r\n  }\r\n  return result;\r\n}\r\n\r\n\r\nfunction createUniformSetter( gl, item, nameGL, lookup ) {\r\n  var nameJS = '_$' + item.name;\r\n\r\n  switch ( item.type ) {\r\n  case gl.BYTE:\r\n  case gl.UNSIGNED_BYTE:\r\n  case gl.SHORT:\r\n  case gl.UNSIGNED_SHORT:\r\n  case gl.INT:\r\n  case gl.UNSIGNED_INT:\r\n  case gl.SAMPLER_2D: // For textures, we specify the texture unit.\r\n    if ( item.size == 1 ) {\r\n      return function ( v ) {\r\n        gl.uniform1i( nameGL, v );\r\n        this[ nameJS ] = v;\r\n      };\r\n    } else {\r\n      return function ( v ) {\r\n        gl.uniform1iv( nameGL, v );\r\n        this[ nameJS ] = v;\r\n      };\r\n    }\r\n    break;\r\n  case gl.FLOAT:\r\n    if ( item.size == 1 ) {\r\n      return function ( v ) {\r\n        gl.uniform1f( nameGL, v );\r\n        this[ nameJS ] = v;\r\n      };\r\n    } else {\r\n      return function ( v ) {\r\n        gl.uniform1fv( nameGL, v );\r\n        this[ nameJS ] = v;\r\n      };\r\n    }\r\n    break;\r\n  case gl.FLOAT_VEC2:\r\n    if ( item.size == 1 ) {\r\n      return function ( v ) {\r\n        gl.uniform2fv( nameGL, v );\r\n        this[ nameJS ] = v;\r\n      };\r\n    } else {\r\n      throw Error(\r\n        \"[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_VEC2 in uniform `\" +\r\n        item.name + \"'!'\"\r\n      );\r\n    }\r\n    break;\r\n  case gl.FLOAT_VEC3:\r\n    if ( item.size == 1 ) {\r\n      return function ( v ) {\r\n        gl.uniform3fv( nameGL, v );\r\n        this[ nameJS ] = v;\r\n      };\r\n    } else {\r\n      throw Error(\r\n        \"[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_VEC3 in uniform `\" +\r\n        item.name + \"'!'\"\r\n      );\r\n    }\r\n    break;\r\n  case gl.FLOAT_VEC4:\r\n    if ( item.size == 1 ) {\r\n      return function ( v ) {\r\n        gl.uniform4fv( nameGL, v );\r\n        this[ nameJS ] = v;\r\n      };\r\n    } else {\r\n      throw Error(\r\n        \"[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_VEC4 in uniform `\" +\r\n        item.name + \"'!'\"\r\n      );\r\n    }\r\n    break;\r\n  case gl.FLOAT_MAT3:\r\n    if ( item.size == 1 ) {\r\n      return function ( v ) {\r\n        gl.uniformMatrix3fv( nameGL, false, v );\r\n        this[ nameJS ] = v;\r\n      };\r\n    } else {\r\n      throw Error(\r\n        \"[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_MAT3 in uniform `\" +\r\n        item.name + \"'!'\"\r\n      );\r\n    }\r\n    break;\r\n  case gl.FLOAT_MAT4:\r\n    if ( item.size == 1 ) {\r\n      return function ( v ) {\r\n        gl.uniformMatrix4fv( nameGL, false, v );\r\n        this[ nameJS ] = v;\r\n      };\r\n    } else {\r\n      throw Error(\r\n        \"[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_MAT4 in uniform `\" +\r\n        item.name + \"'!'\"\r\n      );\r\n    }\r\n    break;\r\n  default:\r\n    throw Error(\r\n      \"[webgl.program.createWriter] Don't know how to deal with uniform `\" +\r\n      item.name + \"` of type \" + lookup[ item.type ] + \"!\"\r\n    );\r\n  }\r\n}\r\n\r\nfunction createUniformGetter( item ) {\r\n  var name = '_$' + item.name;\r\n  return function () {\r\n    return this[ name ];\r\n  };\r\n}\r\n\r\n\r\nfunction getShader( type, gl, code ) {\r\n  var shader = gl.createShader( type );\r\n  gl.shaderSource( shader, code );\r\n  gl.compileShader( shader );\r\n  if ( !gl.getShaderParameter( shader, gl.COMPILE_STATUS ) ) {\r\n    console.log( code );\r\n    console.error( \"An error occurred compiling the shader: \" + gl.getShaderInfoLog( shader ) );\r\n    return null;\r\n  }\r\n\r\n  return shader;\r\n}\r\n\r\nfunction getFragmentShader( gl, code ) {\r\n  return getShader( gl.FRAGMENT_SHADER, gl, code );\r\n}\r\n\r\nfunction getVertexShader( gl, code ) {\r\n  return getShader( gl.VERTEX_SHADER, gl, code );\r\n}\r\n\r\nfunction getTypesNamesLookup( gl ) {\r\n  var lookup = {};\r\n  var k, v;\r\n  for ( k in gl ) {\r\n    v = gl[ k ];\r\n    if ( typeof v === 'number' ) {\r\n      lookup[ v ] = k;\r\n    }\r\n  }\r\n  return lookup;\r\n}\r\n\r\nfunction getSize( gl, item ) {\r\n  switch ( item.type ) {\r\n  case gl.FLOAT_VEC4:\r\n    return 4;\r\n  case gl.FLOAT_VEC3:\r\n    return 3;\r\n  case gl.FLOAT_VEC2:\r\n    return 2;\r\n  case gl.FLOAT:\r\n    return 1;\r\n  default:\r\n    throw \"[webgl.program:getSize] I don't know the size of the attribute '\" + item.name +\r\n      \"' because I don't know the type \" + getTypeName( item.type ) + \"!\";\r\n  }\r\n}\r\n\r\n\r\n\r\nmodule.exports._ = _;\n})"]}
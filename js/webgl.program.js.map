{"version":3,"sources":["webgl.program.js"],"names":["require","module","exports","_","D","X","intl","arguments","all","BPE","Float32Array","BYTES_PER_ELEMENT","Program","gl","codes","includes","vert","Error","frag","parseIncludes","Object","freeze","_typesNamesLookup","getTypesNamesLookup","shaderProgram","createProgram","attachShader","getVertexShader","getFragmentShader","linkProgram","program","use","useProgram","createAttributes","createUniforms","prototype","getTypeName","typeId","bindAttribs","buffer","bindBuffer","ARRAY_BUFFER","names","Array","slice","call","totalSize","forEach","name","attrib","attribs","keys","map","join","size","length","offset","enableVertexAttribArray","location","vertexAttribPointer","FLOAT","that","index","item","attribsCount","getProgramParameter","ACTIVE_ATTRIBUTES","getActiveAttrib","typeName","type","getSize","getAttribLocation","console","info","createAttributeSetter","v","log","disableVertexAttribArray","createAttributeGetter","loc","uniforms","uniformsCount","ACTIVE_UNIFORMS","getActiveUniform","getUniformLocation","defineProperty","set","createUniformSetter","get","createUniformGetter","enumerable","configurable","result","id","code","split","line","trim","substr","pos","indexOf","includeName","charAt","snippet","error","nameGL","lookup","nameJS","BYTE","UNSIGNED_BYTE","SHORT","UNSIGNED_SHORT","INT","UNSIGNED_INT","SAMPLER_2D","uniform1i","uniform1iv","uniform1f","uniform1fv","FLOAT_VEC2","uniform2fv","FLOAT_VEC3","uniform3fv","FLOAT_VEC4","uniform4fv","FLOAT_MAT3","uniformMatrix3fv","FLOAT_MAT4","uniformMatrix4fv","getShader","shader","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","FRAGMENT_SHADER","VERTEX_SHADER","k"],"mappings":"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","sourcesContent":["/** @module webgl.program */require( 'webgl.program', function(require, module, exports) { var _=function(){var D={\"en\":{},\"fr\":{}},X=require(\"$\").intl;function _(){return X(D,arguments);}_.all=D;return _}();\r\n   \"use strict\";\r\n\r\nvar BPE = ( new Float32Array() ).BYTES_PER_ELEMENT;\r\n\r\n/**\r\n * Creating  a  WebGL  program  for shaders  is  painful.  This  class\r\n * simplifies the process.\r\n *\r\n * @class Program\r\n *\r\n * Object properties starting with `$` are WebGL uniforms or attributes.\r\n * Uniforms behave as expected: you can read/write a value.\r\n * Attributes when read, return the location. And when written, enable/disabled\r\n * this attribute. So you read integers and writte booleans.\r\n *\r\n * @param gl - WebGL context.\r\n * @param codes  - Object  with two  mandatory attributes:  `vert` for\r\n * vertex shader and `frag` for fragment shader.\r\n * @param  includes  -  (optional)  If  defined,  the  `#include  foo`\r\n * directives  of  shaders   will  be  replaced  by   the  content  of\r\n * `includes.foo`.\r\n */\r\nfunction Program( gl, codes, includes ) {\r\n  if ( typeof codes.vert !== 'string' ) {\r\n    throw Error( '[webgl.program] Missing attribute `vert` in argument `codes`!' );\r\n  }\r\n  if ( typeof codes.frag !== 'string' ) {\r\n    throw Error( '[webgl.program] Missing attribute `frag` in argument `codes`!' );\r\n  }\r\n\r\n  codes = parseIncludes( codes, includes );\r\n\r\n  this.gl = gl;\r\n  Object.freeze( this.gl );\r\n  this.BPE = BPE;\r\n  Object.freeze( this.BPE );\r\n  \r\n  this._typesNamesLookup = getTypesNamesLookup( gl );\r\n\r\n  var shaderProgram = gl.createProgram();\r\n  gl.attachShader( shaderProgram, getVertexShader( gl, codes.vert ) );\r\n  gl.attachShader( shaderProgram, getFragmentShader( gl, codes.frag ) );\r\n  gl.linkProgram( shaderProgram );\r\n\r\n  this.program = shaderProgram;\r\n  Object.freeze( this.program );\r\n\r\n  this.use = function () {\r\n    gl.useProgram( shaderProgram );\r\n  };\r\n  this.use();\r\n\r\n  createAttributes( this, gl, shaderProgram );\r\n  createUniforms( this, gl, shaderProgram );\r\n}\r\n\r\nProgram.prototype.getTypeName = function ( typeId ) {\r\n  return this._typesNamesLookup[ typeId ];\r\n};\r\n\r\nProgram.prototype.bindAttribs = function ( buffer ) {\r\n  var gl = this.gl;\r\n  gl.bindBuffer( gl.ARRAY_BUFFER, buffer );\r\n  var names = Array.prototype.slice.call( arguments, 1 );\r\n  var totalSize = 0;\r\n  names.forEach( function ( name ) {\r\n    var attrib = this.attribs[ name ];\r\n    if ( !attrib ) {\r\n      throw \"Cannot find attribute \\\"\" + name + \"\\\"!\\n\" +\r\n        \"It may be not active because unused in the shader.\\n\" +\r\n        \"Available attributes are: \" + Object.keys( this.attribs ).map( function ( name ) {\r\n          return '\"' + name + '\"';\r\n        } ).join( \", \" );\r\n    }\r\n    totalSize += ( attrib.size * attrib.length ) * BPE;\r\n  }, this );\r\n  var offset = 0;\r\n  names.forEach( function ( name ) {\r\n    var attrib = this.attribs[ name ];\r\n    gl.enableVertexAttribArray( attrib.location );\r\n    gl.vertexAttribPointer(\r\n      attrib.location,\r\n      attrib.size * attrib.length,\r\n      gl.FLOAT,\r\n      false, // No normalisation.\r\n      totalSize,\r\n      offset\r\n    );\r\n    offset += ( attrib.size * attrib.length ) * BPE;\r\n  }, this );\r\n};\r\n\r\nmodule.exports = Program;\r\n\r\n\r\nfunction createAttributes( that, gl, shaderProgram ) {\r\n  var index, item;\r\n  var attribs = {};\r\n  var attribsCount = gl.getProgramParameter( shaderProgram, gl.ACTIVE_ATTRIBUTES );\r\n  for ( index = 0; index < attribsCount; index++ ) {\r\n    item = gl.getActiveAttrib( shaderProgram, index );\r\n    item.typeName = that.getTypeName( item.type );\r\n    item.length = getSize( gl, item );\r\n    item.location = gl.getAttribLocation( shaderProgram, item.name );\r\n    console.info( \"item=\", item );\r\n    attribs[ item.name ] = item;\r\n  }\r\n\r\n  that.attribs = attribs;\r\n  Object.freeze( that.attribs );\r\n}\r\n\r\nfunction createAttributeSetter( gl, item, shaderProgram ) {\r\n  console.info( \"item=\", item );\r\n  var name = item.name;\r\n  return function ( v ) {\r\n    if ( typeof v !== 'boolean' ) {\r\n      throw \"[webgl.program::$\" + name +\r\n        \"] Value must be a boolean: true if you want to enable this attribute, and false to disable it.\";\r\n    }\r\n    if ( v ) {\r\n      console.log( \"enableVertexAttribArray(\", gl.getAttribLocation( shaderProgram, name ), \")\" );\r\n      gl.enableVertexAttribArray(\r\n        gl.getAttribLocation( shaderProgram, name )\r\n      );\r\n    } else {\r\n      gl.disableVertexAttribArray(\r\n        gl.getAttribLocation( shaderProgram, name )\r\n      );\r\n    }\r\n  };\r\n}\r\n\r\nfunction createAttributeGetter( gl, item, shaderProgram ) {\r\n  var loc = gl.getAttribLocation( shaderProgram, item.name );\r\n  return function () {\r\n    return loc;\r\n  };\r\n}\r\n\r\nfunction createUniforms( that, gl, shaderProgram ) {\r\n  var index, item;\r\n  var uniforms = {};\r\n  var uniformsCount = gl.getProgramParameter( shaderProgram, gl.ACTIVE_UNIFORMS );\r\n  for ( index = 0; index < uniformsCount; index++ ) {\r\n    item = gl.getActiveUniform( shaderProgram, index );\r\n    uniforms[ item.name ] = gl.getUniformLocation( shaderProgram, item.name );\r\n    Object.defineProperty( that, '$' + item.name, {\r\n      set: createUniformSetter( gl, item, uniforms[ item.name ], that._typesNamesLookup ),\r\n      get: createUniformGetter( item ),\r\n      enumerable: true,\r\n      configurable: false\r\n    } );\r\n  }\r\n  that.uniforms = uniforms;\r\n  Object.freeze( that.uniforms );\r\n}\r\n\r\n/**\r\n * This is a preprocessor for shaders.\r\n * Directives  `#include`  will be  replaced  by  the content  of  the\r\n * correspondent attribute in `includes`.\r\n */\r\nfunction parseIncludes( codes, includes ) {\r\n  var result = {};\r\n  var id, code;\r\n  for ( id in codes ) {\r\n    code = codes[ id ];\r\n    result[ id ] = code.split( '\\n' ).map( function ( line ) {\r\n      if ( line.trim().substr( 0, 8 ) != '#include' ) return line;\r\n      var pos = line.indexOf( '#include' ) + 8;\r\n      var includeName = line.substr( pos ).trim();\r\n      // We accept all this systaxes:\r\n      // #include foo\r\n      // #include 'foo'\r\n      // #include <foo>\r\n      // #include \"foo\"\r\n      if ( \"'<\\\"\".indexOf( includeName.charAt( 0 ) ) > -1 ) {\r\n        includeName = includeName.substr( 1, includeName.length - 2 );\r\n      }\r\n      var snippet = includes[ includeName ];\r\n      if ( typeof snippet !== 'string' ) {\r\n        console.error( \"Include <\" + includeName + \"> not found in \", includes );\r\n        throw Error( \"Include not found in shader: \" + includeName );\r\n      }\r\n      return snippet;\r\n    } ).join( \"\\n\" );\r\n  }\r\n  return result;\r\n}\r\n\r\n\r\nfunction createUniformSetter( gl, item, nameGL, lookup ) {\r\n  var nameJS = '_$' + item.name;\r\n\r\n  switch ( item.type ) {\r\n  case gl.BYTE:\r\n  case gl.UNSIGNED_BYTE:\r\n  case gl.SHORT:\r\n  case gl.UNSIGNED_SHORT:\r\n  case gl.INT:\r\n  case gl.UNSIGNED_INT:\r\n  case gl.SAMPLER_2D: // For textures, we specify the texture unit.\r\n    if ( item.size == 1 ) {\r\n      return function ( v ) {\r\n        gl.uniform1i( nameGL, v );\r\n        this[ nameJS ] = v;\r\n      };\r\n    } else {\r\n      return function ( v ) {\r\n        gl.uniform1iv( nameGL, v );\r\n        this[ nameJS ] = v;\r\n      };\r\n    }\r\n    break;\r\n  case gl.FLOAT:\r\n    if ( item.size == 1 ) {\r\n      return function ( v ) {\r\n        gl.uniform1f( nameGL, v );\r\n        this[ nameJS ] = v;\r\n      };\r\n    } else {\r\n      return function ( v ) {\r\n        gl.uniform1fv( nameGL, v );\r\n        this[ nameJS ] = v;\r\n      };\r\n    }\r\n    break;\r\n  case gl.FLOAT_VEC2:\r\n    if ( item.size == 1 ) {\r\n      return function ( v ) {\r\n        gl.uniform2fv( nameGL, v );\r\n        this[ nameJS ] = v;\r\n      };\r\n    } else {\r\n      throw Error(\r\n        \"[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_VEC2 in uniform `\" +\r\n        item.name + \"'!'\"\r\n      );\r\n    }\r\n    break;\r\n  case gl.FLOAT_VEC3:\r\n    if ( item.size == 1 ) {\r\n      return function ( v ) {\r\n        gl.uniform3fv( nameGL, v );\r\n        this[ nameJS ] = v;\r\n      };\r\n    } else {\r\n      throw Error(\r\n        \"[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_VEC3 in uniform `\" +\r\n        item.name + \"'!'\"\r\n      );\r\n    }\r\n    break;\r\n  case gl.FLOAT_VEC4:\r\n    if ( item.size == 1 ) {\r\n      return function ( v ) {\r\n        gl.uniform4fv( nameGL, v );\r\n        this[ nameJS ] = v;\r\n      };\r\n    } else {\r\n      throw Error(\r\n        \"[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_VEC4 in uniform `\" +\r\n        item.name + \"'!'\"\r\n      );\r\n    }\r\n    break;\r\n  case gl.FLOAT_MAT3:\r\n    if ( item.size == 1 ) {\r\n      return function ( v ) {\r\n        gl.uniformMatrix3fv( nameGL, false, v );\r\n        this[ nameJS ] = v;\r\n      };\r\n    } else {\r\n      throw Error(\r\n        \"[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_MAT3 in uniform `\" +\r\n        item.name + \"'!'\"\r\n      );\r\n    }\r\n    break;\r\n  case gl.FLOAT_MAT4:\r\n    if ( item.size == 1 ) {\r\n      return function ( v ) {\r\n        gl.uniformMatrix4fv( nameGL, false, v );\r\n        this[ nameJS ] = v;\r\n      };\r\n    } else {\r\n      throw Error(\r\n        \"[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_MAT4 in uniform `\" +\r\n        item.name + \"'!'\"\r\n      );\r\n    }\r\n    break;\r\n  default:\r\n    throw Error(\r\n      \"[webgl.program.createWriter] Don't know how to deal with uniform `\" +\r\n      item.name + \"` of type \" + lookup[ item.type ] + \"!\"\r\n    );\r\n  }\r\n}\r\n\r\nfunction createUniformGetter( item ) {\r\n  var name = '_$' + item.name;\r\n  return function () {\r\n    return this[ name ];\r\n  };\r\n}\r\n\r\n\r\nfunction getShader( type, gl, code ) {\r\n  var shader = gl.createShader( type );\r\n  gl.shaderSource( shader, code );\r\n  gl.compileShader( shader );\r\n  if ( !gl.getShaderParameter( shader, gl.COMPILE_STATUS ) ) {\r\n    console.log( code );\r\n    console.error( \"An error occurred compiling the shader: \" + gl.getShaderInfoLog( shader ) );\r\n    return null;\r\n  }\r\n\r\n  return shader;\r\n}\r\n\r\nfunction getFragmentShader( gl, code ) {\r\n  return getShader( gl.FRAGMENT_SHADER, gl, code );\r\n}\r\n\r\nfunction getVertexShader( gl, code ) {\r\n  return getShader( gl.VERTEX_SHADER, gl, code );\r\n}\r\n\r\nfunction getTypesNamesLookup( gl ) {\r\n  var lookup = {};\r\n  var k, v;\r\n  for ( k in gl ) {\r\n    v = gl[ k ];\r\n    if ( typeof v === 'number' ) {\r\n      lookup[ v ] = k;\r\n    }\r\n  }\r\n  return lookup;\r\n}\r\n\r\nfunction getSize( gl, item ) {\r\n  switch ( item.type ) {\r\n  case gl.FLOAT_VEC4:\r\n    return 4;\r\n  case gl.FLOAT_VEC3:\r\n    return 3;\r\n  case gl.FLOAT_VEC2:\r\n    return 2;\r\n  case gl.FLOAT:\r\n    return 1;\r\n  default:\r\n    throw \"[webgl.program:getSize] I don't know the size of the attribute '\" + item.name +\r\n      \"' because I don't know the type \" + getTypeName( item.type ) + \"!\";\r\n  }\r\n}\r\n\r\n\r\n\r\nmodule.exports._ = _;\n})"]}
{"version":3,"sources":["view.js"],"names":["require","module","exports","_","CODE_BEHIND","init","M4","m4","Add","Blur","Filter","Resize","HiltObject","PlasmaObject","that","canvas","$elements","$","gl","getContext","preserveDrawingBuffer","framebuffers","add","blur1","blur2","filter","blurPersistence","addPersistence","hiltObject","plasmaObject","projection","identity","rotation","translation","Float32Array","createFramebuffers","paint","time","requestAnimationFrame","console","log","angX","ramp","Math","sin","PI","angY","cos","w","clientWidth","h","clientHeight","rotationYX","perspective","sceneFB","scene","filterFB","blur1FB","blur2FB","persistence1FB","persistence1","renderScene","gloom","renderFilter","renderPersistence","renderBlur","renderAdd","bindFramebuffer","FRAMEBUFFER","fb","viewport","width","height","enable","DEPTH_TEST","clearColor","clearDepth","clear","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","blur","blurFB","attenuation","centerCoeff","segmentCoeff","cornerCoeff","persistence2","value","min","max","delta","Object","values","forEach","deleteFramebuffer","bind","createFramebuffer","texture","createTexture","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","LINEAR","TEXTURE_MAG_FILTER","texImage2D","RGBA","UNSIGNED_BYTE","framebufferTexture2D","COLOR_ATTACHMENT0","deleteTexture","PM","Tag","Link","View","Converters","TfwViewCheckbox","ensureCodeBehind","defVal","args","attName","attValue","undefined","addClassIfTrue","element","className","addClass","removeClass","conv_boolean","get","ViewClass","pm","create","cast","e_","e_canvas","e_1","e_2","content","wide","e_3","e_4","defineProperty","writable","enumerable","configurable","A","obj","name","B","action","v","class","set","fire","call","ex","error","Error"],"mappings":"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","sourcesContent":["/** @module light-saber.view */require( 'light-saber.view', function(require, module, exports) { var _=function(){return ''};   \"use strict\";\r\n\r\n/* exported CODE_BEHIND */\r\nconst CODE_BEHIND = { init };\r\n\r\nrequire( \"assets\" );\r\n\r\nconst\r\n    M4 = require( \"webgl.math\" ).m4,\r\n    Add = require( \"light-saber.add\" ),\r\n    Blur = require( \"light-saber.blur\" ),\r\n    Filter = require( \"light-saber.filter\" ),\r\n    Resize = require( \"webgl.resize\" ),\r\n    HiltObject = require( \"light-saber.saber-hilt\" ),\r\n    PlasmaObject = require( \"light-saber.saber-plasma\" );\r\n\r\n\r\n/**\r\n * According to wikipedia, a light saber has a tilt of 27 cm and a plasma blade of 91 cm.\r\n * @this ViewXJS\r\n */\r\nfunction init() {\r\n    const\r\n        that = this,\r\n        canvas = this.$elements.canvas.$,\r\n        gl = canvas.getContext( \"webgl\", { preserveDrawingBuffer: false } ),\r\n        framebuffers = {},\r\n        add = new Add( gl, framebuffers, \"persistence1\", \"scene\" ),\r\n        blur1 = new Blur( gl, framebuffers, \"filter\" ),\r\n        blur2 = new Blur( gl, framebuffers, \"blur1\" ),\r\n        filter = new Filter( gl, framebuffers, \"scene\" ),\r\n        blurPersistence = new Blur( gl, framebuffers, \"persistence1\" ),\r\n        addPersistence = new Add( gl, framebuffers, \"persistence2\", \"blur2\" ),\r\n        hiltObject = new HiltObject( gl ),\r\n        plasmaObject = new PlasmaObject( gl ),\r\n        projection = M4.identity(),\r\n        rotation = M4.identity(),\r\n        translation = new Float32Array( [ 0, -0.4, -1.5, 0 ] );\r\n\r\n    hiltObject.projection = projection;\r\n    hiltObject.rotation = rotation;\r\n    hiltObject.translation = translation;\r\n    plasmaObject.projection = projection;\r\n    plasmaObject.rotation = rotation;\r\n    plasmaObject.translation = translation;\r\n\r\n    createFramebuffers( gl, framebuffers );\r\n\r\n    const paint = function ( time ) {\r\n        requestAnimationFrame( paint );\r\n\r\n        if ( Resize( gl ) ) {\r\n            console.log( \"Resize!\" );\r\n            createFramebuffers( gl, framebuffers );\r\n        }\r\n\r\n        const\r\n            angX = ramp( Math.sin( 1 + time * 0.000147 ), -Math.PI * 0.5, Math.PI * 0.5 ),\r\n            angY = 4 * Math.cos( time * 0.000458 ),\r\n            w = gl.canvas.clientWidth,\r\n            h = gl.canvas.clientHeight;\r\n\r\n        M4.rotationYX( angY, angX, rotation );\r\n        M4.perspective( Math.PI * .35, w / h, .1, 10, projection );\r\n\r\n        const sceneFB = framebuffers.scene;\r\n        const filterFB = framebuffers.filter;\r\n        const blur1FB = framebuffers.blur1;\r\n        const blur2FB = framebuffers.blur2;\r\n        const persistence1FB = framebuffers.persistence1;\r\n\r\n        renderScene( gl, sceneFB, that.gloom, hiltObject, plasmaObject, time );\r\n\r\n        if ( that.gloom ) {\r\n            renderFilter( gl, filter, filterFB, time );\r\n            renderPersistence( gl, blurPersistence, framebuffers, time );\r\n            renderBlur( gl, blur1, blur1FB, time );\r\n            renderBlur( gl, blur2, blur2FB, time );\r\n            renderAdd( gl, addPersistence, time, persistence1FB );\r\n            renderAdd( gl, add, time );\r\n        }\r\n    };\r\n\r\n    requestAnimationFrame( paint );\r\n}\r\n\r\n/**\r\n * Render the scene on screen or in a frame buffer.\r\n *\r\n * @param   {[type]} gl      [description]\r\n * @param   {[type]} sceneFB [description]\r\n * @param   {[type]} gloom   [description]\r\n * @param {object} hiltObject -\r\n * @param {object} plasmaObject -\r\n * @param {float} time -\r\n */\r\nfunction renderScene( gl, sceneFB, gloom, hiltObject, plasmaObject, time ) {\r\n    if ( gloom ) {\r\n        gl.bindFramebuffer( gl.FRAMEBUFFER, sceneFB.fb );\r\n        gl.viewport( 0, 0, sceneFB.width, sceneFB.height );\r\n    } else {\r\n        gl.bindFramebuffer( gl.FRAMEBUFFER, null );\r\n        gl.viewport( 0, 0, gl.canvas.width, gl.canvas.height );\r\n    }\r\n\r\n    gl.enable( gl.DEPTH_TEST );\r\n    gl.clearColor( 0, 0, 0, 0 );\r\n    gl.clearDepth( 1 );\r\n    gl.clear( gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT );\r\n\r\n    hiltObject.paint( time );\r\n    plasmaObject.paint( time );\r\n}\r\n\r\n/**\r\n * Keep only the saber plasma.\r\n *\r\n * @param   {[type]} gl       [description]\r\n * @param   {[type]} filter   [description]\r\n * @param   {[type]} filterFB [description]\r\n * @param {double} time -\r\n */\r\nfunction renderFilter( gl, filter, filterFB, time ) {\r\n    gl.bindFramebuffer( gl.FRAMEBUFFER, filterFB.fb );\r\n    gl.viewport( 0, 0, filterFB.width, filterFB.height );\r\n\r\n    gl.clear( gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT );\r\n\r\n    filter.paint( time );\r\n}\r\n\r\n/**\r\n * Gaussian blur.\r\n *\r\n * @param   {[type]} gl       [description]\r\n * @param   {[type]} blur   [description]\r\n * @param   {[type]} blurFB [description]\r\n * @param {double} time -\r\n */\r\nfunction renderBlur( gl, blur, blurFB, time ) {\r\n    gl.bindFramebuffer( gl.FRAMEBUFFER, blurFB.fb );\r\n    gl.viewport( 0, 0, blurFB.width, blurFB.height );\r\n\r\n    gl.clear( gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT );\r\n\r\n    const attenuation = 1.75;\r\n    blur.centerCoeff = 0.332 * attenuation;\r\n    blur.segmentCoeff = 0.122 * attenuation;\r\n    blur.cornerCoeff = 0.045 * attenuation;\r\n    blur.paint( time );\r\n}\r\n\r\n/**\r\n * Add glowing effect above final image.\r\n *\r\n * @param   {[type]} gl   [description]\r\n * @param   {[type]} add  [description]\r\n * @param   {[type]} time [description]\r\n * @param {object} fb -\r\n */\r\nfunction renderAdd( gl, add, time, fb = null ) {\r\n    if ( fb === null ) {\r\n        gl.bindFramebuffer( gl.FRAMEBUFFER, null );\r\n        gl.viewport( 0, 0, gl.canvas.width, gl.canvas.height );\r\n    } else {\r\n        gl.bindFramebuffer( gl.FRAMEBUFFER, fb.fb );\r\n        gl.viewport( 0, 0, fb.width, fb.height );\r\n\r\n    }\r\n    gl.clear( gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT );\r\n\r\n    add.paint( time );\r\n}\r\n\r\n/**\r\n * Fade persistence buffer.\r\n *\r\n * @param   {[type]} gl           [description]\r\n * @param   {[type]} blur         [description]\r\n * @param   {[type]} framebuffers [description]\r\n * @param   {[type]} time         [description]\r\n */\r\nfunction renderPersistence( gl, blur, framebuffers, time ) {\r\n    const fb = framebuffers.persistence2;\r\n\r\n    gl.bindFramebuffer( gl.FRAMEBUFFER, fb.fb );\r\n    gl.viewport( 0, 0, fb.width, fb.height );\r\n\r\n    const attenuation = 1.0;\r\n    blur.centerCoeff = 0.332 * attenuation;\r\n    blur.segmentCoeff = 0.122 * attenuation;\r\n    blur.cornerCoeff = 0.045 * attenuation;\r\n    blur.paint( time );\r\n}\r\n\r\n/**\r\n * Take a number between -1 and +1 and project it between min and max.\r\n *\r\n * @param   {float} value - Value between -1 and +1.\r\n * @param   {float} min - Mapped value for -1.\r\n * @param   {float} max - Mapped value for +1.\r\n * @returns {float} .\r\n */\r\nfunction ramp( value, min, max ) {\r\n    const delta = max - min;\r\n    return min + ( value + 1 ) * 0.5 * delta;\r\n}\r\n\r\n/**\r\n * Create all needed framebuffers and delete the previous one.\r\n *\r\n * @param   {[type]} gl           [description]\r\n * @param   {[type]} framebuffers [description]\r\n */\r\nfunction createFramebuffers( gl, framebuffers ) {\r\n    Object.values( framebuffers ).forEach( deleteFramebuffer.bind( null, gl ) );\r\n\r\n    const\r\n        w = Math.max( 1, gl.canvas.width ),\r\n        h = Math.max( 1, gl.canvas.height );\r\n    framebuffers.scene = createFramebuffer( gl, w, h );\r\n    framebuffers.filter = createFramebuffer( gl, w / 2, h / 2 );\r\n    framebuffers.blur1 = createFramebuffer( gl, w / 8, h / 8 );\r\n    framebuffers.blur2 = createFramebuffer( gl, w / 8, h / 8 );\r\n    framebuffers.persistence1 = createFramebuffer( gl, w / 2, h / 2 );\r\n    framebuffers.persistence2 = createFramebuffer( gl, w / 2, h / 2 );\r\n}\r\n\r\n/**\r\n * Crate a Framebuffer and its associated texture.\r\n *\r\n * @param   {[type]} gl     [description]\r\n * @param   {[type]} width  [description]\r\n * @param   {[type]} height [description]\r\n *\r\n * @returns {object} `{ texture, framebuffer }`\r\n */\r\nfunction createFramebuffer( gl, width, height ) {\r\n    const texture = gl.createTexture();\r\n\r\n    // Tell GL that the current texture is this one.\r\n    gl.bindTexture( gl.TEXTURE_2D, texture );\r\n\r\n    // The texture doesn't wrap and it uses linear interpolation.\r\n    gl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE );\r\n    gl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE );\r\n    gl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR );\r\n    gl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR );\r\n    // gl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST );\r\n    // gl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST );\r\n\r\n    // Set texture dimension.\r\n    gl.texImage2D(\r\n        gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0,\r\n        gl.RGBA, gl.UNSIGNED_BYTE, null\r\n    );\r\n\r\n    const fb = gl.createFramebuffer();\r\n\r\n    // Tell GL that the current framebuffer is this one.\r\n    gl.bindFramebuffer( gl.FRAMEBUFFER, fb );\r\n\r\n    // Attach the texture to this framebuffer.\r\n    gl.framebufferTexture2D(\r\n        gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0,\r\n        gl.TEXTURE_2D, texture, 0\r\n    );\r\n\r\n    return { texture, fb, width, height };\r\n}\r\n\r\n/**\r\n * Clean up the framebuffer and its texture.\r\n *\r\n * @param   {[type]} gl          [description]\r\n * @param   {[type]} frameBuffer [description]\r\n */\r\nfunction deleteFramebuffer( gl, { texture, fb } ) {\r\n    gl.deleteTexture( texture );\r\n    gl.deleteFramebuffer( fb );\r\n}\n\n\n//===============================\n// XJS:View autogenerated code.\ntry {\n  module.exports = function() {\n    //--------------------\n    // Dependent modules.\n    const $ = require('dom');\n    const PM = require('tfw.binding.property-manager');\n    const Tag = require('tfw.view').Tag;\n    const Link = require('tfw.binding.link');\n    const View = require('tfw.view');;\n    const Converters = require('tfw.binding.converters');\n    const TfwViewCheckbox = require('tfw.view.checkbox');\n    //-------------------------------------------------------\n    // Check if needed functions are defined in code behind.\n    View.ensureCodeBehind( CODE_BEHIND, \"init\" );\n    //-------------------\n    // Global functions.\n    function defVal(args, attName, attValue) { return args[attName] === undefined ? attValue : args[attName]; };\n    function addClassIfTrue(element, className, value) {\n    if( value ) $.addClass(element, className);\n    else $.removeClass(element, className); };;\n    //-------------------\n    // Global variables.\n    const conv_boolean = Converters.get('boolean');\n    //-------------------\n    // Class definition.\n    const ViewClass = function( args ) {\n      try {\n        if( typeof args === 'undefined' ) args = {};\n        this.$elements = {};\n                const that = this;\n        const pm = PM(this);\n        //--------------------\n        // Create attributes.\n        pm.create(\"fullscreen\", { cast: conv_boolean });\n        pm.create(\"gloom\", { cast: conv_boolean });\n        //------------------\n        // Create elements.\n        const e_ = new Tag('DIV', [\"class\"]);\n        const e_canvas = new Tag('CANVAS');\n        this.$elements.canvas = e_canvas;\n        const e_1 = new Tag('DIV', [\"class\"]);\n        const e_2 = new TfwViewCheckbox({\n          content: \"Plein Ã©cran\",\n          wide: false\n        });\n        $.add( e_1, e_2 );\n        const e_3 = new Tag('DIV', [\"class\"]);\n        const e_4 = new TfwViewCheckbox({\n          content: \"Halo\",\n          wide: false\n        });\n        $.add( e_3, e_4 );\n        $.add( e_, e_canvas, e_1, e_3 );\n        //-----------------------\n        // Declare root element.\n        Object.defineProperty( this, '$', {\n          value: e_.$,\n          writable: false, \n          enumerable: false, \n          configurable: false\n        });\n        //-------\n        // Links\n        new Link({\n          A:{obj: that,\n              name: 'fullscreen'},\n          B:{action: function(v) {\n          addClassIfTrue( e_, \"fullscreen\", v );}},\n          name:\"fullscreen > undefined\"\n        });\n        new Link({\n          A:{obj: that,\n              name: 'fullscreen'},\n          B:{obj: e_2,\n              name: 'value'},\n          name:\"fullscreen > e_2/value\"\n        });\n        new Link({\n          A:{obj: that,\n              name: 'gloom'},\n          B:{obj: e_4,\n              name: 'value'},\n          name:\"gloom > e_4/value\"\n        });\n        //----------------------\n        // Initialize elements.\n        e_.class = \"wdg-light-saber-view\";\n        e_1.class = \"bottom\";\n        e_3.class = \"left\";\n        //------------------------\n        // Initialize attributes.\n        pm.set(\"fullscreen\", defVal(args, \"fullscreen\", false));\n        pm.set(\"gloom\", defVal(args, \"gloom\", false));\n        pm.fire(\"fullscreen\");\n        pm.fire(\"gloom\");\n        // Initialization.\n        CODE_BEHIND.init.call( this );\n        $.addClass(this, 'view', 'custom');\n\n      }\n      catch( ex ) {\n        console.error('mod/light-saber.view.js', ex);\n        throw Error('Instantiation error in XJS of \"mod/light-saber.view.js\":\\n' + ex)\n      }\n    };\n    return ViewClass;\n  }();\n}\ncatch( ex ) {\n  throw Error('Definition error in XJS of \"mod/light-saber.view.js\"\\n' + ex);\n}\n\r\n\r\n\r\nmodule.exports._ = _;\n})"]}
{"version":3,"sources":["wdg.wavefront.js"],"names":["require","module","exports","_","D","X","intl","arguments","all","GLOBAL","CODE_BEHIND","init","onFileLoaded","$","M4","m4","Resize","Program","Fillpoly","_colorArray","Float32Array","_colorText","that","canvas","$elements","gl","getContext","preserveDrawingBuffer","_gl","prgHachures","vert","frag","prgCouleursFranches","frag_couleurs_franches","prgLisse","frag_lisse","prgHuile","frag_huile","prg1","prg2","vert2","frag2","_buffVert","createBuffer","_buffElem","enable","CULL_FACE","DEPTH_TEST","clearColor","clearDepth","projection","identity","rotation","translation","_translation","angX","angY","rotX","rotY","touching","time0","time","on","down","up","drag","evt","Math","PI","vx","clientWidth","vy","clientHeight","draw","t","requestAnimationFrame","color","getColor","call","w","h","perspective","automaticRotation","sin","rotationXY","clear","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","bindBuffer","ARRAY_BUFFER","ELEMENT_ARRAY_BUFFER","cullFace","BACK","prg","material","use","$uniColor","$uniProjection","$uniRotation","$uniTranslation","bindAttribs","drawElements","TRIANGLES","elemCount","UNSIGNED_SHORT","borderVisible","FRONT","$uniBorderThickness","borderThickness","fetch","then","response","ok","text","parse","bind","rr","parseInt","substr","gg","bb","file","reader","FileReader","onload","event","result","readAsText","content","model","parseResult","console","info","vertCount","length","elem","z","radius","bufferData","STATIC_DRAW","def","parseWaveFront","vertArray","elemArray","vertices","count","maxLength","f","forEach","triangle","point","vertexIndex","pointPieces","split","vIdx","vnIdx","v","vn","x","y","max","xn","yn","zn","push","Uint16Array","sqrt","waveFrontToDefinitions","vertexCount","normalCount","faceCount","map","toVector3","unshift","F","cutFacesInTriangles","triangleCount","RX_PREFIX","itr","TextFileIterator","line","nextLine","lastIndex","matcher","exec","key","val","trim","Array","isArray","triangles","faceDef","faceDefIndex","poly","face","vertex","vertexPieces","idxVertex","vertexArrayToAttribs","trianglesElements","fillPolyline","k","idx0","idx1","idx2","ex","error","txt","parseFloat","_content","_length","_cursor","prototype","cursor","nextEndOfLine","indexOf","PM","Tag","View","Converters","ensureCodeBehind","defVal","args","attName","attValue","undefined","conv_boolean","get","conv_float","conv_integer","conv_color","ViewClass","pm","create","cast","e_","Object","defineProperty","value","writable","enumerable","configurable","class","set","fire","addClass","Error"],"mappings":"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","sourcesContent":["/** @module wdg.wavefront */require( 'wdg.wavefront', function(require, module, exports) { var _=function(){var D={\"en\":{},\"fr\":{}},X=require(\"$\").intl;function _(){return X(D,arguments);}_.all=D;return _}();\r\n const GLOBAL = {\n  \"vert\": \"// Perspective\\r\\nuniform mat4 uniProjection;\\r\\n// Rotation de la multiball.\\r\\nuniform mat4 uniRotation;\\r\\n// Translation.\\r\\nuniform vec4 uniTranslation;\\r\\n// Largeur de l'écran en pixels.\\r\\nuniform float uniScreenWidth;\\r\\n\\r\\n// Coordonnées du centre du modèle.\\r\\nattribute vec3 attPoint;\\r\\n// Vecteur normal en ce point.\\r\\nattribute vec3 attNormal;\\r\\nvarying vec3 varNormal;\\r\\n\\r\\nvoid main() {\\r\\n  // Rotation, translation et projection en perspective.\\r\\n  vec4 vertex = uniRotation * vec4( attPoint, 1 ) + uniTranslation;\\r\\n  gl_Position = uniProjection * vertex;\\r\\n\\r\\n  vec4 normal = uniRotation * vec4( attNormal, 1 );\\r\\n  varNormal = normal.xyz;\\r\\n}\\r\\n\",\n  \"frag\": \"precision mediump float;\\r\\nuniform vec3 uniColor;\\r\\n\\r\\n// Couleur principale du modèle.\\r\\nconst vec3 WHITE = vec3(1, 1, 1);\\r\\nconst vec3 BLACK = vec3(0, 0, 0);\\r\\n\\r\\n// Direction de la lumière.\\r\\nconst vec3 LIGHT = normalize( vec3(10, -5, -2) );\\r\\n\\r\\nvarying vec3 varNormal;\\r\\n\\r\\nvoid main() {\\r\\n  vec3 color = uniColor;\\r\\n\\r\\n  vec3 normal = normalize( varNormal );\\r\\n  vec3 reflection = reflect( LIGHT, normal );\\r\\n  float r = reflection.z;\\r\\n  float x = gl_FragCoord.x;\\r\\n  float y = gl_FragCoord.y;\\r\\n  \\r\\n  if( r < -0.5 ) {\\r\\n    if( mod( x - y, 6.0 ) < 1.0 || mod( y, 6.0 ) < 1.0 ) color = BLACK;\\r\\n  }\\r\\n  else if( r < 0.5 ) {\\r\\n    if( mod( x - y, 6.0 ) < 1.0 ) color = BLACK;\\r\\n  }\\r\\n  \\r\\n  gl_FragColor = vec4( color, 1.0 );\\r\\n}\\r\\n\",\n  \"frag_couleurs_franches\": \"precision mediump float;\\r\\nuniform vec3 uniColor;\\r\\n\\r\\n// Couleur principale du modèle.\\r\\nconst vec3 WHITE = vec3(1, 1, 1);\\r\\nconst vec3 BLACK = vec3(0, 0, 0);\\r\\n\\r\\n// Direction de la lumière.\\r\\nconst vec3 LIGHT = normalize( vec3(10, -5, -2) );\\r\\n\\r\\nvarying vec3 varNormal;\\r\\n\\r\\nvoid main() {\\r\\n  vec3 color = uniColor;\\r\\n\\r\\n  vec3 normal = normalize( varNormal );\\r\\n  vec3 reflection = reflect( LIGHT, normal );\\r\\n  float r = reflection.z;\\r\\n  float x = gl_FragCoord.x;\\r\\n  float y = gl_FragCoord.y;\\r\\n  \\r\\n  if( r < -0.5 ) {\\r\\n    color *= .3;\\r\\n  }\\r\\n  else if( r < 0.5 ) {\\r\\n    color *= .6;\\r\\n  }\\r\\n  \\r\\n  gl_FragColor = vec4( color, 1.0 );\\r\\n}\\r\\n\",\n  \"frag_lisse\": \"precision mediump float;\\r\\nuniform vec3 uniColor;\\r\\n\\r\\n// Direction de la lumière.\\r\\nconst vec3 LIGHT = normalize( vec3(10, -5, -2) );\\r\\n\\r\\nvarying vec3 varNormal;\\r\\n\\r\\nvoid main() {\\r\\n  vec3 color = uniColor;\\r\\n\\r\\n  vec3 normal = normalize( varNormal );\\r\\n  vec3 reflection = reflect( LIGHT, normal );\\r\\n  float r = reflection.z;\\r\\n  float R = 0.5 + 0.25 * (1.0 + r);\\r\\n  \\r\\n  gl_FragColor = vec4( color * R, 1.0 );\\r\\n}\\r\\n\",\n  \"frag_huile\": \"precision mediump float;\\r\\nuniform vec3 uniColor;\\r\\n\\r\\n// Direction de la lumière.\\r\\nconst vec3 LIGHT = normalize( vec3(10, -5, -2) );\\r\\n\\r\\nvarying vec3 varNormal;\\r\\n\\r\\nvoid main() {\\r\\n  vec3 color = uniColor;\\r\\n\\r\\n  vec3 normal = normalize( varNormal );\\r\\n  vec3 reflection = reflect( LIGHT, normal );\\r\\n  float r = reflection.z;\\r\\n  float R = 0.0 + 0.5 * (1.0 + r);\\r\\n  \\r\\n  if( r < -.95 ) color *= mix( 1.0, R, 12.0 * (1.0 + r));\\r\\n  else if( r > .82 ) color = mix( color, vec3(1, 1, 1), 0.9);\\r\\n  else if( r > .8 ) color = mix( color * R, vec3(1, 1, 1), 50.0 * (r - .8));\\r\\n  else color *= R;\\r\\n  gl_FragColor = vec4( color, 1.0 );\\r\\n}\\r\\n\",\n  \"vert2\": \"// Perspective\\r\\nuniform mat4 uniProjection;\\r\\n// Rotation de la multiball.\\r\\nuniform mat4 uniRotation;\\r\\n// Translation.\\r\\nuniform vec4 uniTranslation;\\r\\n// Largeur de l'écran en pixels.\\r\\nuniform float uniScreenWidth;\\r\\n// Border thickness.\\r\\nuniform float uniBorderThickness;\\r\\n\\r\\n// Coordonnées du centre du modèle.\\r\\nattribute vec3 attPoint;\\r\\n// Vecteur normal en ce point.\\r\\nattribute vec3 attNormal;\\r\\n\\r\\n\\r\\nvoid main() {\\r\\n  // Rotation, translation et projection en perspective.\\r\\n  vec4 vertex = uniRotation * vec4( attPoint + normalize(attNormal) * uniBorderThickness, 1 ) + uniTranslation;\\r\\n  gl_Position = uniProjection * vertex;\\r\\n}\\r\\n\",\n  \"frag2\": \"precision mediump float;\\r\\n\\r\\nvoid main() {\\r\\n  gl_FragColor = vec4( 0, 0, 0, 1 );\\r\\n}\\r\\n\"};\n  // Code behind.\r\n\"use strict\";\r\n\r\nvar CODE_BEHIND = {\r\n  init: init,\r\n  onFileLoaded: onFileLoaded\r\n};\r\n\r\n\r\nvar $ = require(\"dom\");\r\nvar M4 = require(\"webgl.math\").m4;\r\nvar Resize = require(\"webgl.resize\");\r\nvar Program = require(\"webgl.program\");\r\nvar Fillpoly = require(\"webgl.fillpoly\");\r\n\r\n\r\nfunction init() {\r\n  this._colorArray = new Float32Array([0, 0, 0]);\r\n  this._colorText = '';\r\n  \r\n  var that = this;\r\n\r\n  var canvas = this.$elements.canvas.$;\r\n  var gl = canvas.getContext( \"webgl\", { preserveDrawingBuffer: false } );\r\n  this._gl = gl;\r\n  var prgHachures = new Program( gl, {\r\n    vert: GLOBAL.vert,\r\n    frag: GLOBAL.frag\r\n  });\r\n  var prgCouleursFranches = new Program( gl, {\r\n    vert: GLOBAL.vert,\r\n    frag: GLOBAL.frag_couleurs_franches\r\n  });\r\n  var prgLisse = new Program( gl, {\r\n    vert: GLOBAL.vert,\r\n    frag: GLOBAL.frag_lisse\r\n  });\r\n  var prgHuile = new Program( gl, {\r\n    vert: GLOBAL.vert,\r\n    frag: GLOBAL.frag_huile\r\n  });\r\n  \r\n  var prg1 = [prgHachures, prgCouleursFranches, prgLisse, prgHuile];\r\n  \r\n  var prg2 = new Program( gl, {\r\n    vert: GLOBAL.vert2,\r\n    frag: GLOBAL.frag2\r\n  });\r\n\r\n  this._buffVert = gl.createBuffer();\r\n  this._buffElem = gl.createBuffer();\r\n\r\n  gl.enable( gl.CULL_FACE );\r\n  gl.enable( gl.DEPTH_TEST );\r\n  gl.clearColor( 0, .5, 0.866666666667, 1 );\r\n  gl.clearDepth( 1 );\r\n\r\n  var projection = M4.identity();\r\n  var rotation = M4.identity();\r\n  var translation = new Float32Array([ 0, 0, -3, 0 ]);\r\n  that._translation = translation;\r\n  \r\n  var angX = 0;\r\n  var angY = 0;\r\n  var rotX = 0;\r\n  var rotY = 0;\r\n  var touching = false;\r\n  var time0 = 0;\r\n  var time = 0;\r\n  \r\n  $.on( canvas, {\r\n    down: function() {\r\n      touching = true;\r\n      angX += rotX;\r\n      angY += rotY;\r\n      rotX = 0;\r\n      rotY = 0;\r\n    },\r\n    up: function() {\r\n      touching = false;\r\n      angX += rotX;\r\n      angY += rotY;\r\n      rotX = 0;\r\n      rotY = 0;\r\n      time0 = time;\r\n    },\r\n    drag: function( evt ) {\r\n      rotY = 2 * Math.PI * evt.vx / canvas.clientWidth;\r\n      rotX = 2 * Math.PI * evt.vy / canvas.clientHeight;\r\n    }\r\n  });\r\n\r\n  var draw = function( t ) {    \r\n    requestAnimationFrame( draw );\r\n\r\n    var color = getColor.call( that );\r\n    \r\n    var translation = that._translation;\r\n    time = t;\r\n    var w = gl.canvas.clientWidth;\r\n    var h = gl.canvas.clientHeight;\r\n    Resize( gl );\r\n\r\n    M4.perspective( Math.PI * .35, w/h, .1, 10, projection );\r\n    if( !touching && that.automaticRotation ) {\r\n      rotX = 1.97 * Math.sin( (time - time0) * 0.0000347 );\r\n      rotY = 5.78 * Math.sin( (time - time0) * 0.0000758 );\r\n    }\r\n    M4.rotationXY( angX + rotX, angY + rotY, rotation );\r\n\r\n    gl.clear( gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT );\r\n\r\n    gl.bindBuffer( gl.ARRAY_BUFFER, that._buffVert );\r\n    gl.bindBuffer( gl.ELEMENT_ARRAY_BUFFER, that._buffElem );\r\n\r\n    gl.cullFace( gl.BACK );\r\n    var prg = prg1[that.material];\r\n    prg.use();\r\n    prg.$uniColor = color;\r\n    prg.$uniProjection = projection;\r\n    prg.$uniRotation = rotation;\r\n    prg.$uniTranslation = translation;\r\n\r\n    prg.bindAttribs( that._buffVert, \"attPoint\", \"attNormal\" );\r\n    gl.drawElements( gl.TRIANGLES, that.elemCount, gl.UNSIGNED_SHORT, 0 );\r\n\r\n    if( that.borderVisible ) {\r\n      gl.cullFace( gl.FRONT );\r\n      prg2.use();\r\n      prg2.$uniProjection = projection;\r\n      prg2.$uniRotation = rotation;\r\n      prg2.$uniTranslation = translation;\r\n      prg2.$uniBorderThickness = that.borderThickness * 0.01;\r\n\r\n      prg2.bindAttribs( that._buffVert, \"attPoint\", \"attNormal\" );\r\n      gl.drawElements( gl.TRIANGLES, that.elemCount, gl.UNSIGNED_SHORT, 0 );\r\n    }\r\n  };\r\n\r\n  requestAnimationFrame( draw );\r\n\r\n  if( typeof fetch === 'function' ) {\r\n    fetch( \"./css/wdg.wavefront/wolf.obj\" ).then(function( response ) {\r\n      if( response.ok ) return response.text();\r\n    }).then( parse.bind( that ) );\r\n  }\r\n}\r\n\r\n\r\nfunction getColor() {\r\n  var color = this.color;\r\n  if( color == this._colorText ) return this._colorArray;\r\n  this._colorText = color;\r\n  var rr = parseInt( color.substr( 1, 2 ), 16 ) / 255;\r\n  var gg = parseInt( color.substr( 3, 2 ), 16 ) / 255;\r\n  var bb = parseInt( color.substr( 5, 2 ), 16 ) / 255;\r\n  this._colorArray[0] = rr;\r\n  this._colorArray[1] = gg;\r\n  this._colorArray[2] = bb;\r\n  return this._colorArray;\r\n}\r\n\r\n\r\nfunction onFileLoaded( file ) {\r\n  var that = this;\r\n\r\n  var reader = new FileReader();\r\n  reader.onload = function( event ) {\r\n    var result = reader.result;\r\n    parse.call( that, result );\r\n  };\r\n  reader.readAsText(file);\r\n}\r\n\r\n\r\nfunction parse( content ) {\r\n  var model = parseResult.call( this, content );\r\n  console.info(\"[wdg.wavefront] model=\", model);\r\n  this.vertCount = model.vert.length / 6;\r\n  this.elemCount = model.elem.length;\r\n  this._translation.z = -model.radius;\r\n  console.info(\"[wdg.wavefront] this._translation=\", this._translation);\r\n  \r\n  var gl = this._gl;\r\n\r\n  if( !this._buffVert ) {\r\n    this._buffVert = gl.createBuffer();\r\n  }\r\n  gl.bindBuffer( gl.ARRAY_BUFFER, this._buffVert );\r\n  gl.bufferData( gl.ARRAY_BUFFER, model.vert, gl.STATIC_DRAW );\r\n\r\n  if( !this._buffElem ) {\r\n    this._buffElem = gl.createBuffer();\r\n  }\r\n  gl.bindBuffer( gl.ELEMENT_ARRAY_BUFFER, this._buffElem );\r\n  gl.bufferData( gl.ELEMENT_ARRAY_BUFFER, model.elem, gl.STATIC_DRAW );  \r\n}\r\n\r\nfunction parseResult( content ) {\r\n  var def = parseWaveFront.call( this, content );\r\n  var vertArray = [];\r\n  var elemArray = [];\r\n  var vertices = {};\r\n  var count = 0;\r\n  var maxLength = 0;\r\n  def.f.forEach(function (triangle) {\r\n    triangle.forEach(function (point) {\r\n      var vertexIndex = vertices[point];\r\n      if( typeof vertexIndex === 'undefined' ) {\r\n        vertexIndex = count++;\r\n        vertices[point] = vertexIndex;\r\n        var pointPieces = point.split( '/' );\r\n        var vIdx = pointPieces[0];\r\n        var vnIdx = pointPieces[2];\r\n        var v = def.v[vIdx];\r\n        var vn = def.vn[vnIdx];\r\n        var x = v[0], y = v[1], z = v[2];\r\n        var length = x*x + y*y + z*z;\r\n        maxLength = Math.max( maxLength, length );\r\n        var xn = vn[0], yn = vn[1], zn = vn[2];\r\n        vertArray.push( x, y, z, xn, yn, zn );\r\n      }\r\n      elemArray.push( vertexIndex );\r\n    });\r\n  });\r\n  return {\r\n    vert: new Float32Array( vertArray ),\r\n    elem: new Uint16Array( elemArray ),\r\n    radius: Math.sqrt( maxLength )\r\n  };\r\n}\r\n\r\n\r\nfunction parseWaveFront( content ) {\r\n  var def = waveFrontToDefinitions( content );\r\n  this.vertexCount = def.v.length;\r\n  this.normalCount = def.vn.length;\r\n  this.faceCount = def.f.length;\r\n\r\n  // [[x,y,z], ...]\r\n  def.v = def.v.map( toVector3 );\r\n  def.v.unshift( null ); // Because indexes must start from 1.\r\n  // [[nx,ny,nz], ...]\r\n  def.vn = def.vn.map( toVector3 );\r\n  def.vn.unshift( null ); // Because indexes must start from 1.\r\n  // [ [\"7//1\", \"10//2\", \"4//3\"], ... ]\r\n  var F = [];\r\n  cutFacesInTriangles( F, def );\r\n  this.triangleCount = F.length;\r\n  def.f = F;\r\n\r\n  return def;\r\n}\r\n\r\n\r\nvar RX_PREFIX = /^([a-z]+)[ ]+/g;\r\n\r\nfunction waveFrontToDefinitions( content ) {\r\n  var itr = new TextFileIterator( content );\r\n  var line;\r\n  var def = {};\r\n  while( null != (line = itr.nextLine()) ) {\r\n    RX_PREFIX.lastIndex = 0;\r\n    var matcher = RX_PREFIX.exec( line );\r\n    if( !matcher ) continue;\r\n    var key = matcher[1];\r\n    var val = line.substr( matcher[0].length ).trim();\r\n    if( !Array.isArray( def[key] ) ) def[key] = [];\r\n    def[key].push( val );\r\n  }\r\n  return def;\r\n}\r\n\r\n\r\nfunction cutFacesInTriangles( triangles, def ) {\r\n  def.f.forEach(function (faceDef, faceDefIndex) {\r\n    try {\r\n      var poly = [];\r\n      var face = faceDef.split( ' ' );\r\n      if( face.length === 3 ) {\r\n        triangles.push( face );\r\n      }\r\n      else {\r\n        // More than 3 vertices, we must cut in triangles.\r\n        face.forEach(function (vertex) {\r\n          var vertexPieces = vertex.split( '/' );\r\n          var idxVertex = parseInt( vertexPieces[0] );\r\n          poly.push( def.v[idxVertex] );\r\n        });\r\n\r\n        var vertices = Fillpoly.vertexArrayToAttribs( poly );\r\n        var trianglesElements = Fillpoly.fillPolyline( vertices );\r\n        for( var k=0; k<trianglesElements.length/3; k++ ) {\r\n          var idx0 = trianglesElements[k * 3 + 0];\r\n          var idx1 = trianglesElements[k * 3 + 1];\r\n          var idx2 = trianglesElements[k * 3 + 2];\r\n          triangles.push([ face[idx0], face[idx1], face[idx2] ]);\r\n        }\r\n      }\r\n    }\r\n    catch( ex ) {\r\n      console.error( \"[wdg.wavefront.cutFacesInTriangles] error = \", ex );\r\n      console.error( \"[wdg.wavefront.cutFacesInTriangles] faceDef = \", faceDef );\r\n      console.error( \"[wdg.wavefront.cutFacesInTriangles] faceDefIndex = \", faceDefIndex );\r\n      console.error( \"[wdg.wavefront.cutFacesInTriangles] face = \", face );\r\n      console.error( \"[wdg.wavefront.cutFacesInTriangles] poly = \", poly );\r\n      console.error( \"[wdg.wavefront.cutFacesInTriangles] vertices = \", vertices );\r\n      console.error( \"[wdg.wavefront.cutFacesInTriangles] trianglesElements = \", trianglesElements );\r\n      throw ex + \"\\n...in wdg.wavefront.cutFacesInTriangles\";\r\n    }\r\n  });\r\n  return triangles;\r\n}\r\n\r\n\r\nfunction toVector3( txt ) {\r\n  return txt.split(\" \").map( parseFloat );\r\n}\r\n\r\n\r\nvar TextFileIterator = function( content ) {\r\n  this._content = content;\r\n  this._length = content.length;\r\n  this._cursor = 0;\r\n};\r\n\r\n/**\r\n * @member TextFileIterator.nextLine\r\n */\r\nTextFileIterator.prototype.nextLine = function() {\r\n  var cursor = this._cursor;\r\n  if( cursor >= this._length ) return null;\r\n  var nextEndOfLine = this._content.indexOf( '\\n', cursor );\r\n  if( nextEndOfLine < 0 ) {\r\n    this._cursor = this._length;\r\n    return this._content.substr( cursor );\r\n  }\r\n  this._cursor = nextEndOfLine + 1;\r\n  return this._content.substr( cursor, this._cursor - cursor );\r\n};\r\n\n\n\n//===============================\n// XJS:View autogenerated code.\ntry {\n  module.exports = function() {\n    //--------------------\n    // Dependent modules.\n    const $ = require('dom');\n    const PM = require('tfw.binding.property-manager');\n    const Tag = require('tfw.view').Tag;\n    const View = require('tfw.view');;\n    const Converters = require('tfw.binding.converters');\n    //-------------------------------------------------------\n    // Check if needed functions are defined in code behind.\n    View.ensureCodeBehind( CODE_BEHIND, \"onFileLoaded\", \"init\" );\n    //-------------------\n    // Global functions.\n    function defVal(args, attName, attValue) { return args[attName] === undefined ? attValue : args[attName]; };\n    //-------------------\n    // Global variables.\n    const conv_boolean = Converters.get('boolean');\n    const conv_float = Converters.get('float');\n    const conv_integer = Converters.get('integer');\n    const conv_color = Converters.get('color');\n    //-------------------\n    // Class definition.\n    const ViewClass = function( args ) {\n      try {\n        if( typeof args === 'undefined' ) args = {};\n        this.$elements = {};\n                const that = this;\n        const pm = PM(this);\n        //--------------------\n        // Create attributes.\n        pm.create(\"file\");\n        pm.create(\"automaticRotation\", { cast: conv_boolean });\n        pm.create(\"borderVisible\", { cast: conv_boolean });\n        pm.create(\"borderThickness\", { cast: conv_float(0) });\n        pm.create(\"vertexCount\", { cast: conv_integer(0) });\n        pm.create(\"normalCount\", { cast: conv_integer(0) });\n        pm.create(\"faceCount\", { cast: conv_integer(0) });\n        pm.create(\"triangleCount\", { cast: conv_integer(0) });\n        pm.create(\"vertCount\", { cast: conv_integer(0) });\n        pm.create(\"elemCount\", { cast: conv_integer(0) });\n        pm.create(\"material\", { cast: conv_integer(0) });\n        pm.create(\"color\", { cast: conv_color });\n        //------------------\n        // Create elements.\n        const e_ = new Tag('DIV', [\"class\"]);\n        //-----------------------\n        // Declare root element.\n        Object.defineProperty( this, '$', {\n          value: undefined.$,\n          writable: false, \n          enumerable: false, \n          configurable: false\n        });\n        //-----------------------\n        // On attribute changed.\n        pm.on(\"file\", function(v) {\n          try {\n            CODE_BEHIND.onFileLoaded.call( that, v );\n          }\n          catch( ex ) {\n            console.error(\n              'Exception in function behind \"onFileLoaded\" of module \"mod/wdg.wavefront.js\" for attribute \"file\"!'\n            );\n            console.error( ex );\n          }\n        });\n        //----------------------\n        // Initialize elements.\n        e_.class = \"wdg-wavefront\";\n        //------------------------\n        // Initialize attributes.\n        pm.set(\"file\", args[\"file\"]);\n        pm.set(\"automaticRotation\", defVal(args, \"automaticRotation\", true));\n        pm.set(\"borderVisible\", defVal(args, \"borderVisible\", true));\n        pm.set(\"borderThickness\", defVal(args, \"borderThickness\", 2));\n        pm.set(\"vertexCount\", defVal(args, \"vertexCount\", 0));\n        pm.set(\"normalCount\", defVal(args, \"normalCount\", 0));\n        pm.set(\"faceCount\", defVal(args, \"faceCount\", 0));\n        pm.set(\"triangleCount\", defVal(args, \"triangleCount\", 0));\n        pm.set(\"vertCount\", defVal(args, \"vertCount\", 0));\n        pm.set(\"elemCount\", defVal(args, \"elemCount\", 0));\n        pm.set(\"material\", defVal(args, \"material\", 0));\n        pm.set(\"color\", defVal(args, \"color\", \"#ff8800\"));\n        pm.fire(\"file\");\n        pm.fire(\"automaticRotation\");\n        pm.fire(\"borderVisible\");\n        pm.fire(\"borderThickness\");\n        pm.fire(\"vertexCount\");\n        pm.fire(\"normalCount\");\n        pm.fire(\"faceCount\");\n        pm.fire(\"triangleCount\");\n        pm.fire(\"vertCount\");\n        pm.fire(\"elemCount\");\n        pm.fire(\"material\");\n        pm.fire(\"color\");\n        // Initialization.\n        CODE_BEHIND.init.call( this );\n        $.addClass(this, 'view', 'custom');\n\n      }\n      catch( ex ) {\n        console.error('mod/wdg.wavefront.js', ex);\n        throw Error('Instantiation error in XJS of \"mod/wdg.wavefront.js\":\\n' + ex)\n      }\n    };\n    return ViewClass;\n  }();\n}\ncatch( ex ) {\n  throw Error('Definition error in XJS of \"mod/wdg.wavefront.js\"\\n' + ex);\n}\n\r\n\r\n\r\nmodule.exports._ = _;\n})"]}
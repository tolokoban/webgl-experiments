{"version":3,"sources":["dom.fx.js"],"names":["require","module","Fx","name","_session","Object","defineProperty","prototype","value","writable","configurable","enumerable","_name","_tasks","_index","_started","_startTime","_onEnd","EMPTY_FUNC","next","session","length","that","tsk","_debug","console","info","label","Date","now","args","delay","bind","fullscreenOn","target","tools","terminate","rect","getBoundingClientRect","substitute","$","div","css","display","width","height","onBeforeReplace","replace","onAfterReplace","styles","saveStyles","overlay","document","body","appendChild","left","top","addClass","r2","fullscreenOff","detach","loadStyles","element","key","val","style","_","X","D","arguments","intl","all","DB","ID","window","setTimeout","start","onEnd","end","$id","call","debug","addTask","task","push","log","msg","pause","exec","Array","slice","forEach","arg","ex","error","methodname","slot","apply","vanish","elem","ms","parseInt","isNaN","transition","opacity","wait","vanishAndDetach","msOrElem","async","e","itm","removeEventListener","addEventListener","exports","Fullscreen","opts","Error","voidFunc","propBoolean","isFullScreen"],"mappings":"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","sourcesContent":["/** @module dom.fx */require( 'dom.fx', function(require, module, exports) { var _=function(){var D={\"en\":{}},X=require(\"$\").intl;function _(){return X(D,arguments);}_.all=D;return _}();\r\n   \"use strict\";\r\n\r\nrequire( \"polyfill.promise\" );\r\n\r\nconst\r\n    $ = require( \"dom\" ),\r\n    DB = require( \"tfw.data-binding\" );\r\n\r\nconst EMPTY_FUNC = function () {\r\n    // Do nothing.\r\n};\r\n\r\n// Unique ID.\r\nlet ID = 1;\r\n\r\nconst delay = window.setTimeout;\r\n\r\n/**\r\n * @class Fx\r\n * @param {string} name - Optional name of this animation chain.\r\n */\r\nfunction Fx( name ) {\r\n    // Because it is  possible to call `end()` before  the sequence is\r\n    // over, we need  to know in what  session we are. This  way, if a\r\n    // callback is called after the end,  it can know that it must not\r\n    // execute the next task.\r\n    this._session = {};\r\n    // A name can be defined for debug purpose, but it is not used right now.\r\n    Object.defineProperty( Fx.prototype, 'name', {\r\n        value: name,\r\n        writable: false,\r\n        configurable: true,\r\n        enumerable: true\r\n    } );\r\n    this._name = name;\r\n    // Sequence of  tasks. A task  is a function with  two parameters:\r\n    // the `next()` function and a  boolean `async` which tells you if\r\n    // your are allowed to call async functions.\r\n    // When  a task  is  called in  the `end()`  function,  it is  not\r\n    // allowed to call async functions.\r\n    this._tasks = [];\r\n    // Index of the current task.\r\n    this._index = 0;\r\n    this._started = false;\r\n    this._startTime = 0;\r\n    this._onEnd = EMPTY_FUNC;\r\n}\r\n\r\n/**\r\n * @param {function} _onEnd - Function to call as soon as the animation ends.\r\n * @returns {undefined}\r\n */\r\nFx.prototype.start = function ( _onEnd ) {\r\n    const onEnd = typeof _onEnd !== \"undefined\" ? _onEnd : EMPTY_FUNC;\r\n    if ( this._started ) this.end();\r\n    this._onEnd = onEnd;\r\n    this._started = true;\r\n    this._index = 0;\r\n    this._session = { $id: ID++ };\r\n    this._startTime = Date.now();\r\n    next.call( this, this._session );\r\n};\r\n\r\n/**\r\n * Next step of the animation.\r\n * @this Fx\r\n * @param {object} session - ``{ $id }\r\n * @returns {undefined}\r\n */\r\nfunction next( session ) {\r\n    if ( session !== this._session ) return;\r\n    if ( this._index >= this._tasks.length ) {\r\n        this._index = 0;\r\n        this._started = false;\r\n        delete this._session;\r\n        this._onEnd( this );\r\n        return;\r\n    }\r\n\r\n    const\r\n        that = this,\r\n        tsk = this._tasks[ this._index++ ];\r\n    if ( this._debug ) {\r\n        console.info(\r\n            `[dom.fx] tsk[${this._index - 1}]: `, tsk.label,\r\n            `(${Date.now() - this._startTime} ms)`, tsk.args, session\r\n        );\r\n    }\r\n    tsk( function () {\r\n        delay( next.bind( that, session ) );\r\n    }, true );\r\n}\r\n\r\nFx.prototype.end = function () {\r\n    if ( !this._started ) return this;\r\n    var that = this;\r\n    this._started = false;\r\n    delete this._session;\r\n    while ( this._index < this._tasks.length ) {\r\n        var tsk = this._tasks[ this._index++ ];\r\n        if ( that._debug ) {\r\n            console.info( \"[dom.fx.end] tsk[\" + ( this._index - 1 ) + \"]: \", tsk.label, tsk.args );\r\n        }\r\n        tsk( EMPTY_FUNC, false );\r\n    }\r\n    this._onEnd( this );\r\n    return this;\r\n};\r\n\r\n/**\r\n * @member Fx.debug\r\n * @param value\r\n */\r\nFx.prototype.debug = function ( value ) {\r\n    this.addTask( function ( next ) {\r\n        this._debug = value ? true : false;\r\n        next();\r\n    } );\r\n    return this;\r\n};\r\n\r\n/**\r\n * @return void\r\n */\r\nFx.prototype.addTask = function ( task, label, args ) {\r\n    task.label = label;\r\n    task.args = args;\r\n    this._tasks.push( task );\r\n    return this;\r\n};\r\n\r\n/**\r\n * @return void\r\n */\r\nFx.prototype.log = function ( msg ) {\r\n    this.addTask( function ( next ) {\r\n        console.log( \"[dom.fx]\", msg );\r\n        next();\r\n    }, 'log' );\r\n    return this;\r\n};\r\n\r\n/**\r\n * Stop execution of the animation until end() has been called.\r\n */\r\nFx.prototype.pause = function () {\r\n    this.addTask( EMPTY_FUNC, 'pause' );\r\n    return this;\r\n};\r\n\r\nFx.prototype.exec = function () {\r\n    var args = Array.prototype.slice.call( arguments );\r\n    this.addTask( function ( next, session ) {\r\n        args.forEach( function ( arg ) {\r\n            try {\r\n                if ( typeof arg === 'function' ) arg( session );\r\n                else console.log( '[dom.fx]', arg );\r\n            } catch ( ex ) {\r\n                console.error( ex );\r\n            }\r\n        } );\r\n        next();\r\n    }, 'exec', args );\r\n    return this;\r\n};\r\n\r\n[\r\n  'css', 'addClass', 'removeClass', 'toggleClass', 'detach',\r\n  'saveStyle', 'restoreStyle', 'add', 'removeAtt', 'replace'\r\n].forEach( function ( methodname ) {\r\n    var slot = $[ methodname ];\r\n    Fx.prototype[ methodname ] = function () {\r\n        var args = Array.prototype.slice.call( arguments );\r\n        this.addTask( function ( next ) {\r\n            slot.apply( $, args );\r\n            next();\r\n        }, methodname, args );\r\n        return this;\r\n    };\r\n} );\r\n\r\n\r\n/**\r\n * @member Fx.vanish\r\n * @param elem, ms\r\n */\r\nFx.prototype.vanish = function ( elem, ms ) {\r\n    ms = parseInt( ms );\r\n    if ( isNaN( ms ) ) ms = 300;\r\n    return this.css( elem, { transition: \"none\" } )\r\n        .css( elem, { transition: \"opacity \" + ms + \"ms\", opacity: 0 } )\r\n        .wait( ms );\r\n};\r\n\r\nFx.prototype.vanishAndDetach = function ( elem, ms ) {\r\n    ms = parseInt( ms );\r\n    if ( isNaN( ms ) ) ms = 300;\r\n    return this.vanish( elem, ms ).detach( elem );\r\n};\r\n\r\n/**\r\n * @member Fx.wait\r\n * @param ms\r\n */\r\nFx.prototype.wait = function ( msOrElem ) {\r\n    var that = this;\r\n    var args = Array.prototype.slice.call( arguments );\r\n\r\n    if ( typeof msOrElem === 'undefined' ) msOrElem = 0;\r\n    if ( typeof msOrElem === 'number' ) {\r\n        this.addTask( function ( next, async ) {\r\n            if ( async ) {\r\n                delay( next, msOrElem );\r\n            }\r\n        }, 'wait', args );\r\n    } else {\r\n        this.addTask( function ( next, async ) {\r\n            if ( async ) {\r\n                var e = $( msOrElem );\r\n                var slot = function ( evt ) {\r\n          [ 'transitionend', 'oTransitionEnd', 'webkitTransitionEnd' ].forEach( function ( itm ) {\r\n                        e.removeEventListener( itm, slot );\r\n                    } );\r\n                    next();\r\n                };\r\n        [ 'transitionend', 'oTransitionEnd', 'webkitTransitionEnd' ].forEach( function ( itm ) {\r\n                    e.addEventListener( itm, slot );\r\n                } );\r\n            }\r\n        }, 'wait', args );\r\n    }\r\n    return this;\r\n};\r\n\r\n\r\nmodule.exports = function ( name ) {\r\n    return new Fx( name );\r\n};\r\n\r\n\r\n/**\r\n * @module dom.fx\r\n *\r\n * @description\r\n * All the animation effects you can do on DOM elements.\r\n *\r\n * @example\r\n * var mod = require('dom.fx');\r\n */\r\n\r\n\r\n/**\r\n * @export {function} fullscreen\r\n * @param opts\r\n * * __target__: target DOM element.\r\n *\r\n * @return {object}\r\n * * __value__    {boolean}:    If    `true`    the    element    goes\r\n fullscreen. Otherwise, it returns to its initial position.\r\n */\r\nmodule.exports.Fullscreen = function ( opts ) {\r\n    if ( typeof opts === 'undefined' ) {\r\n        throw Error( \"[dom.fx:fullscreen] Missing argument!\" );\r\n    }\r\n    if ( typeof opts.target === 'undefined' ) {\r\n        throw Error( \"[dom.fx:fullscreen] Missing `opts.target`!\" );\r\n    }\r\n    if ( typeof opts.target.element === 'function' ) opts.target = opts.target.element();\r\n    if ( typeof opts.target.element !== 'undefined' ) opts.target = opts.target.element;\r\n\r\n    var voidFunc = function () {};\r\n    var tools = {\r\n        onBeforeReplace: typeof opts.onBeforeReplace === 'function' ? opts.onBeforeReplace : voidFunc,\r\n        onAfterReplace: typeof opts.onAfterReplace === 'function' ? opts.onAfterReplace : voidFunc\r\n    };\r\n    DB.propBoolean( this, 'value' )( function ( isFullScreen ) {\r\n        if ( isFullScreen ) {\r\n            fullscreenOn( opts.target, tools );\r\n        } else {\r\n            fullscreenOff( opts.target, tools );\r\n        }\r\n    } );\r\n};\r\n\r\nfunction fullscreenOn( target, tools ) {\r\n    if ( tools.terminate ) tools.terminate();\r\n\r\n    var rect = target.getBoundingClientRect();\r\n    console.info( \"[dom.fx] rect=...\", rect );\r\n    var substitute = $.div();\r\n    $.css( substitute, {\r\n        display: 'inline-block',\r\n        width: rect.width + \"px\",\r\n        height: rect.height + \"px\"\r\n    } );\r\n\r\n    tools.onBeforeReplace( target );\r\n    $.replace( substitute, target );\r\n    tools.onAfterReplace( target );\r\n\r\n    tools.substitute = substitute;\r\n    tools.styles = saveStyles( target );\r\n    tools.overlay = $.div( 'dom-fx-fullscreen' );\r\n    document.body.appendChild( tools.overlay );\r\n    tools.overlay.appendChild( target );\r\n    $.css( target, {\r\n        left: rect.left + 'px',\r\n        top: rect.top + 'px',\r\n        width: rect.width + 'px',\r\n        height: rect.height + 'px'\r\n    } );\r\n    $.addClass( target, 'dom-fx-fullscreen-target' );\r\n\r\n    delay( function () {\r\n        var r2 = tools.overlay.getBoundingClientRect();\r\n        $.css( target, {\r\n            left: '20px',\r\n            top: '20px',\r\n            width: ( r2.width - 40 ) + 'px',\r\n            height: ( r2.height - 40 ) + 'px'\r\n        } );\r\n    } );\r\n}\r\n\r\nfunction fullscreenOff( target, tools ) {\r\n    var rect = tools.substitute.getBoundingClientRect();\r\n    $.css( target, {\r\n        left: rect.left + 'px',\r\n        top: rect.top + 'px',\r\n        width: rect.width + 'px',\r\n        height: rect.height + 'px'\r\n    } );\r\n    tools.terminate = function () {\r\n        $.detach( tools.overlay );\r\n\r\n        tools.onBeforeReplace( target );\r\n        $.replace( target, tools.substitute );\r\n        tools.onAfterReplace( target );\r\n\r\n        loadStyles( target, tools.styles );\r\n        delete tools.terminate;\r\n    };\r\n\r\n    delay( tools.terminate, 200 );\r\n}\r\n\r\nfunction saveStyles( element ) {\r\n    var styles = {};\r\n    var key, val;\r\n    for ( key in element.style ) {\r\n        val = element.style[ key ];\r\n        styles[ key ] = val;\r\n    }\r\n    console.info( \"[dom.fx] styles=...\", styles );\r\n    return styles;\r\n}\r\n\r\nfunction loadStyles( element, styles ) {\r\n    for ( var key in styles ) {\r\n        element.style[ key ] = styles[ key ];\r\n    }\r\n}\r\n\r\n\r\nmodule.exports._ = _;\n})"]}
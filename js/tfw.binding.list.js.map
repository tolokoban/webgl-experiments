{"version":3,"sources":["tfw.binding.list.js"],"names":["require","module","isAlreadySorted","array","comparator","length","current","previous","k","isList","candidate","readOnly","object","attrib","value","Object","defineProperty","writable","configurable","enumerable","_","X","D","arguments","intl","all","PM","Listeners","ID","COUNT","List","arg","Array","isArray","_array","link","exports","prototype","fire","functionName","args","wave","id","indexOf","push","_listeners","_links","forEach","list","properties","getProperties","prop","manager","name","addListener","listener","add","removeListener","remove","console","error","Error","unlink","index","splice","get","put","newValue","oldValue","elem","removeAt","mapInPlace","func","that","_Array","itm","idx","DEFAULT_COMPARATOR","a","b","sort","funcName","slice","call","result","apply","includes","item","set","v"],"mappings":"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","sourcesContent":["/** @module tfw.binding.list */require( 'tfw.binding.list', function(require, module, exports) { var _=function(){var D={\"en\":{},\"fr\":{}},X=require(\"$\").intl;function _(){return X(D,arguments);}_.all=D;return _}();\r\n   \"use strict\";\r\n\r\n/*\r\n  fire( functionName, arguments, wave )\r\n  addListener( listener )\r\n  removeListener( listener )\r\n\r\n  link( list )\r\n  unlink( list )\r\n\r\n  get( index )\r\n  put( index, elem )\r\n\r\n  remove( elem )\r\n  removeAt( index )\r\n\r\n  mapInPlace( function(elem, index) )\r\n*/\r\nconst\r\n    PM = require(\"tfw.binding.property-manager\"),\r\n    Listeners = require(\"tfw.listeners\");\r\n\r\nconst ID = \"__tfw.binding.list__\";\r\nlet COUNT = 1;\r\n\r\n/**\r\n * A list is an observable array.\r\n *\r\n * Several lists can share the same internal array. In that case, when\r\n * one list modifies the array, all  lists will emit the same event as\r\n * it. Such lists are linked.\r\n */\r\nvar List = function(arg) {\r\n    readOnly(this, ID, COUNT++);\r\n    readOnly(this, \"_listeners\", new Listeners());\r\n    readOnly(this, \"_links\", []);\r\n    // An object  with the  attribute `isContentChangeAware  === true`\r\n    // can fire a property value changed when its contant has change.\r\n    readOnly(this, \"isContentChangeAware\", true);\r\n    if (Array.isArray(arg)) {\r\n        readOnly(this, \"_array\", arg);\r\n    } else if (isList(arg)) {\r\n        readOnly(this, \"_array\", arg._array);\r\n        this.link(arg);\r\n    } else {\r\n        readOnly(this, \"_array\", [arg]);\r\n    }\r\n};\r\n\r\nmodule.exports = List;\r\nList.isList = isList;\r\n\r\n\r\nList.prototype.fire = function(functionName, args, wave) {\r\n    var id = this[ID];\r\n    if (!Array.isArray(wave)) wave = [id];\r\n    else if (wave.indexOf(id) === -1) wave.push(id);\r\n\r\n    // Listeners for content change.\r\n    this._listeners.fire(functionName, args, wave);\r\n\r\n    // Two Lists are linked if and only if they share the same array.\r\n    this._links.forEach(function(list) {\r\n        if (wave.indexOf(list[ID]) > -1) return;\r\n        list.fire(functionName, args, wave);\r\n    });\r\n\r\n    // The content  of the List  has changed.  We must fire  a 'changed'\r\n    // event on the manager if this list is linkable.\r\n    var properties = PM.getProperties(this);\r\n    if (Array.isArray(properties)) {\r\n        properties.forEach(function(prop) {\r\n            prop.manager.fire(prop.name);\r\n        });\r\n    }\r\n};\r\n\r\nList.prototype.addListener = function(listener) {\r\n    this._listeners.add(listener);\r\n};\r\n\r\nList.prototype.removeListener = function(listener) {\r\n    this._listeners.remove(listener);\r\n};\r\n\r\n\r\nList.prototype.link = function(list) {\r\n    if (!isList(list)) {\r\n        console.error(\"Argument: \", list);\r\n        throw Error(\"[tfw.binding.list.link] Argument must be a tfw.binding.list object!\");\r\n    }\r\n\r\n    if (this._links.indexOf(list) === -1) {\r\n        this._links.push(list);\r\n        list.link(this);\r\n    }\r\n};\r\n\r\nList.prototype.unlink = function(list) {\r\n    var index = this._links.indexOf(list);\r\n    if (index === -1) return;\r\n\r\n    this._links.splice(index, 1);\r\n    list.unlink(this);\r\n};\r\n\r\n/**\r\n * The braket notation doesn't work with list.\r\n * This function\r\n */\r\nList.prototype.get = function(index) {\r\n    return this._array[index];\r\n};\r\n\r\nList.prototype.put = function(index, newValue) {\r\n    var oldValue = this._array[index];\r\n    if (oldValue === newValue) return false;\r\n    this._array[index] = newValue;\r\n    this.fire(\"put\", {\r\n        index: index,\r\n        oldValue: oldValue,\r\n        newValue: newValue\r\n    });\r\n    return true;\r\n};\r\n\r\nList.prototype.remove = function(elem) {\r\n    var index = this._array.indexOf(elem);\r\n    if (index === -1) return false;\r\n    this._array.splice(index, 1);\r\n    this.fire(\"remove\", { elem: elem, index: index });\r\n    return true;\r\n};\r\n\r\nList.prototype.removeAt = function(index) {\r\n    var elem = this._array[index];\r\n    this._array.splice(index, 1);\r\n    this.fire(\"remove\", { elem: elem, index: index });\r\n    return true;\r\n};\r\n\r\nList.prototype.mapInPlace = function(func) {\r\n    var that = this;\r\n\r\n    this._Array.forEach(function(itm, idx) {\r\n        var newValue = func(itm);\r\n        that.put(idx, newValue);\r\n    });\r\n\r\n    return this;\r\n};\r\n\r\nvar DEFAULT_COMPARATOR = function(a, b) {\r\n    if (a == b) return 0;\r\n    return a < b ? -1 : 1;\r\n};\r\n\r\n/**\r\n * Sort and fire only if the array is not already in order.\r\n */\r\nList.prototype.sort = function(comparator) {\r\n    if (typeof comparator !== 'function') comparator = DEFAULT_COMPARATOR;\r\n    if (isAlreadySorted(this._array, comparator)) return this;\r\n    this._array.sort(comparator);\r\n    this.fire(\"sort\", comparator);\r\n    return this;\r\n};\r\n\r\nfunction isAlreadySorted(array, comparator) {\r\n    if (array.length < 2) return true;\r\n\r\n    var previous = array[0];\r\n    var current;\r\n\r\n    for (var k = 1; k < array.length; k++) {\r\n        current = array[k];\r\n        if (comparator(previous, current) > 0) return false;\r\n        previous = current;\r\n    }\r\n    return true;\r\n}\r\n\r\n[\r\n    \"push\", \"pop\", \"shift\", \"unshift\", \"splice\", \"reverse\"\r\n]\r\n.forEach(function(funcName) {\r\n    List.prototype[funcName] = function() {\r\n        var args = Array.prototype.slice.call(arguments);\r\n        var result = Array.prototype[funcName].apply(this._array, args);\r\n        this.fire(funcName, args);\r\n        return result;\r\n    };\r\n});\r\n\r\n/**\r\n * Functions that don't change the array.\r\n */\r\n[\r\n    \"slice\", \"forEach\", \"filter\", \"map\", \"reduce\",\r\n    \"indexOf\", \"lastIndexOf\"\r\n].forEach((funcName) => {\r\n    List.prototype[funcName] = function(...args) {\r\n        // const args = Array.prototype.slice.call(arguments);\r\n        return Array.prototype[funcName].apply(this._array, args);\r\n    };\r\n});\r\n\r\nif (!Array.prototype.includes) {\r\n    // Polyfill for IE11.\r\n    Array.prototype.includes = function(item) {\r\n        return this.indexOf(item) !== -1;\r\n    }\r\n}\r\nList.prototype.includes = function(item) {\r\n    return Array.prototype.includes.call(this._array, item);\r\n};\r\n\r\n/**\r\n * Define the `length` property.\r\n */\r\nObject.defineProperty(List.prototype, \"length\", {\r\n    get: function() {\r\n        return this._array.length;\r\n    },\r\n    set: function(v) {\r\n        this._array.length = v;\r\n        this.fire(\"length\", v);\r\n    },\r\n    configurable: false,\r\n    enumerable: true\r\n});\r\n\r\n\r\nfunction isList(candidate) {\r\n    if (!candidate) return false;\r\n    return typeof candidate[ID] === 'number';\r\n}\r\n\r\nfunction readOnly(object, attrib, value) {\r\n    Object.defineProperty(object, attrib, {\r\n        value: value,\r\n        writable: false,\r\n        configurable: false,\r\n        enumerable: true\r\n    });\r\n}\r\n\r\n\r\nmodule.exports._ = _;\n})"]}
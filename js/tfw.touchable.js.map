{"version":3,"sources":["tfw.touchable.js"],"names":["require","module","makeFixedElementWithSameShape","elem","rect","$","getBoundingClientRect","copy","div","css","left","top","width","height","borderRadius","window","getComputedStyle","getPropertyValue","_","X","D","arguments","intl","all","exports","opts","that","target","shadow","container","enabled","color","classToAdd","opacity","element","tap","Listeners","press","lastX","lastY","addClass","fxDown","Fx","transition","transform","exec","cls","w","Math","max","h","radius","ceil","sqrt","margin","background","clear","wait","detach","removeClass","on","down","evt","stopPropagation","preventDefault","floor","x","y","add","document","body","start","fire","console","log","doubletap"],"mappings":"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","sourcesContent":["/** @module tfw.touchable */require( 'tfw.touchable', function(require, module, exports) { var _=function(){var D={\"en\":{},\"fr\":{}},X=require(\"$\").intl;function _(){return X(D,arguments);}_.all=D;return _}();\r\n   \"use strict\";\r\n\r\n/**\r\n * @module tfw.touchable\r\n *\r\n * @description\r\n * Turn  a DOM  element  into  a touchable  one  with material  design\r\n * animation: a growing transparent disk.\r\n *\r\n * @example\r\n * var Touchable = require('tfw.touchable');\r\n * var div = document.querySelector('#button');\r\n * var touchable = new Touchable( div, {\r\n *   opacity: .2,\r\n *   color: \"white\"\r\n * });\r\n * touchable.tap.add(function() { ... });\r\n * touchable.press.add(function() { ... });\r\n */\r\nmodule.exports = Touchable;\r\n\r\nconst $ = require(\"dom\"),\r\n    Fx = require(\"dom.fx\"),\r\n    Listeners = require(\"tfw.listeners\");\r\n\r\n/**\r\n * @class Touchable\r\n * @param {any} elem - DOMElement or string representing a DOM ID.\r\n * @param {object} opts - Options.\r\n * @param {boolean} opts.enabled - .\r\n * @param {string} opts.color - CSS color.\r\n * @returns {undefined}\r\n */\r\nfunction Touchable(elem, opts = {}) {\r\n    const that = this,\r\n        target = {elem: null},\r\n        shadow = $.div(\"tfw-touchable-shadow\"),\r\n        container = $.div(\"tfw-touchable-container\", [shadow]);\r\n\r\n    if (typeof opts.enabled === \"undefined\") opts.enabled = true;\r\n\r\n    this.enabled = opts.enabled;\r\n    this.color = opts.color || \"#333\";\r\n    this.classToAdd = opts.classToAdd;\r\n    this.opacity = opts.opacity || 0.4;\r\n    this.element = $(elem);\r\n    this.tap = new Listeners();\r\n    this.press = new Listeners();\r\n\r\n    let lastX = 0,\r\n        lastY = 0;\r\n\r\n    $.addClass(elem, \"tfw-touchable-elem\");\r\n\r\n    const fxDown = Fx()\r\n        .css(shadow, {\r\n            transition: \"none\",\r\n            transform: \"scale(0)\"\r\n        })\r\n        .exec(function() {\r\n            const cls = that.classToAdd;\r\n            if (typeof cls === \"string\") {\r\n                $.addClass(elem, cls);\r\n            }\r\n            const rect = target.elem.getBoundingClientRect(),\r\n                w = Math.max(lastX, rect.width - lastX),\r\n                h = Math.max(lastY, rect.height - lastY),\r\n                radius = Math.ceil(Math.sqrt(w * w + h * h));\r\n            $.css(shadow, {\r\n                left: `${lastX}px`,\r\n                top: `${lastY}px`,\r\n                margin: `-${radius}px`,\r\n                width: `${2 * radius}px`,\r\n                height: `${2 * radius}px`,\r\n                opacity: 0,\r\n                background: that.color,\r\n                transform: \"scale(0)\",\r\n                transition: \"all .15s ease\",\r\n                \"transition-timing-function\": \"cubic-bezier(0,1,0.780,1)\",\r\n                \"-moz-transition-timing-function\": \"cubic-bezier(0,1,0.780,1)\",\r\n                \"-webkit-transition-timing-function\":\r\n                    \"cubic-bezier(0,1,0.780,1)\"\r\n            });\r\n            $.clear(target.elem, container);\r\n        })\r\n        .wait(10)\r\n        .css(shadow, {\r\n            opacity: that.opacity,\r\n            transform: \"scale(.25)\"\r\n        })\r\n        .wait(150)\r\n        .css(shadow, {transform: \"scale(.2)\"})\r\n        .wait(150)\r\n        .css(shadow, {\r\n            transition: \"all .6s ease\",\r\n            transform: \"scale(1)\",\r\n            opacity: 0\r\n        })\r\n        .wait(600)\r\n        .exec(function() {\r\n            $.detach(target.elem);\r\n            const cls = that.classToAdd;\r\n            if (typeof cls === \"string\") {\r\n                $.removeClass(elem, cls);\r\n            }\r\n        });\r\n\r\n    $.on(elem, {\r\n        down(evt) {\r\n            if (!that.enabled) return;\r\n            evt.stopPropagation();\r\n            evt.preventDefault();\r\n            lastX = Math.floor(evt.x);\r\n            lastY = Math.floor(evt.y);\r\n            target.elem = makeFixedElementWithSameShape(elem);\r\n            $.add(document.body, target.elem);\r\n            fxDown.start();\r\n        },\r\n        tap(evt) {\r\n            if (!that.enabled) {\r\n                console.log(\"DISABLED!\");\r\n                return;\r\n            }\r\n            that.tap.fire(evt);\r\n        },\r\n        doubletap(evt) {\r\n            if (!that.enabled) {\r\n                console.log(\"DISABLED!\");\r\n                return;\r\n            }\r\n            that.press.fire(evt);\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * @param {DOMElement} elem - Element from which to make a new element with the same shape but fixed.\r\n * @returns {undefined}\r\n */\r\nfunction makeFixedElementWithSameShape(elem) {\r\n    const rect = $(elem).getBoundingClientRect(),\r\n        copy = $.div(\"tfw-touchable\");\r\n\r\n    $.css(copy, {\r\n        left: `${rect.left}px`,\r\n        top: `${rect.top}px`,\r\n        width: `${rect.width}px`,\r\n        height: `${rect.height}px`,\r\n        borderRadius: window\r\n            .getComputedStyle($(elem))\r\n            .getPropertyValue(\"border-radius\")\r\n    });\r\n    return copy;\r\n}\r\n\r\n\r\n\r\nmodule.exports._ = _;\n})"]}
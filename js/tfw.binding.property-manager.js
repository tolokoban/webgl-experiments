"use strict";function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}require("tfw.binding.property-manager",function(require,module){function PropertyManager(container){Object.defineProperty(this,"id",{value:ID++,writable:!1,configurable:!1,enumerable:!0}),this.name=this.id,this._props={},this._container=container}function constructor(container){try{if("undefined"==typeof container&&fail("Argument `container` is mandatory!"),"object"!==_typeof(container))return null;var pm=container["__tfw.property-manager__"];return pm||(pm=new PropertyManager(container),container["__tfw.property-manager__"]=pm),pm}catch(ex){return console.error(ex),null}}function createNewProperty(propertyName,options){var that=this,prop={value:void 0,event:new Event,filter:functionOrUndefined(options.filter),converter:functionOrUndefined(options.converter),delay:castPositiveInteger(options.delay),action:null,alwaysFired:!!options.alwaysFired,manager:this,name:propertyName,timeout:0};return prop.get=createGetter(prop,options),prop.set=createSetter(prop,options,that,propertyName),this._props[propertyName]=prop,"undefined"!=typeof options.init&&prop.set(options.init),Object.defineProperty(this._container,propertyName,{get:prop.get.bind(prop),set:that.change.bind(that,propertyName),enumerable:!0,configurable:!1}),prop}function createGetter(prop,options){return"function"==typeof options.get?function(v){var newValue=options.get(v);return addPropToValue(prop,newValue),newValue}:function(){return prop.value}}function createSetter(prop,options,that){var setter;return setter="function"==typeof options.cast?"function"==typeof options.set?function(v){removePropFromValue(prop,prop.get());var castedValue=options.cast(v,that);addPropToValue(prop,prop.value),options.set(castedValue)}:function(v){removePropFromValue(prop,prop.get()),prop.value=options.cast(v,that),addPropToValue(prop,prop.value)}:"function"==typeof options.set?options.set:function(v){removePropFromValue(prop,prop.get()),prop.value=v,addPropToValue(prop,prop.value)},setter}function addPropToValue(prop,value){if(void 0!==value&&null!==value&&!0===value.isContentChangeAware){var properties=value["__tfw.binding.property-manager__"];Array.isArray(properties)?-1===properties.indexOf(prop)&&properties.push(prop):properties=[prop],value["__tfw.binding.property-manager__"]=properties}}function removePropFromValue(prop,value){if(void 0!==value&&null!==value&&!0===value.isContentChangeAware){var properties=value["__tfw.binding.property-manager__"];if(Array.isArray(properties)){var pos=properties.indexOf(prop);-1===pos||properties.splice(pos,1)}}}function exec(prop,action){prop.delay?(clearTimeout(prop.timeout),prop.timeout=setTimeout(action,prop.delay)):action()}function fail(msg,source){throw source="undefined"==typeof source?"":"::"+source,Error("[tfw.binding.property-manager"+source+"] "+msg)}function castPositiveInteger(v){return"number"==typeof v?isNaN(v)?0:Math.max(0,Math.floor(v)):0}function functionOrUndefined(f){return"function"==typeof f?f:void 0}function areDifferent(oldValue,newValue){return oldValue!==newValue}var _=function(){function _(){return X(D,arguments)}var D={en:{},fr:{}},X=require("$").intl;return _.all=D,_}();"use strict",module.exports=constructor,module.exports.isLinkable=function(container,propertyName){return"undefined"!=typeof container["__tfw.property-manager__"]&&("string"!=typeof propertyName||"undefined"!=typeof container["__tfw.property-manager__"]._props[propertyName])},module.exports.getAllAttributesNames=function(container){return void 0===container["__tfw.property-manager__"]?[]:Object.keys(container["__tfw.property-manager__"]._props)},module.exports.getProperties=function(property){var properties=property["__tfw.binding.property-manager__"];return Array.isArray(properties)?properties:null},module.exports.readonly=function(target,attribs){var attribNames=Object.keys(attribs);attribNames.forEach(function(attName){var attValue=attribs[attName];"function"==typeof attValue?Object.defineProperty(target,attName,{set:function set(){throw Error("Attribute \"".concat(attName,"\" is read only!"))},get:attValue,configurable:!1,enumerable:!0}):Object.defineProperty(target,attName,{value:attValue,writable:!1,configurable:!1,enumerable:!0})})};var Event=require("tfw.event"),ID=0,CONTAINER_SYMBOL="__tfw.property-manager__";PropertyManager.prototype.set=function(propertyName,value){this.create(propertyName).set(value)},PropertyManager.prototype.isLinkable=function(propertyName){var container=this._container;return!!container&&"undefined"!=typeof container[CONTAINER_SYMBOL]&&"undefined"!=typeof container[CONTAINER_SYMBOL]._props[propertyName]},PropertyManager.prototype.get=function(propertyName){return this.create(propertyName).get()},PropertyManager.prototype.propertyId=function(propertyName){return this.create(propertyName).id},PropertyManager.prototype.fire=function(propertyName,wave){var prop=this.create(propertyName);prop.event.fire(prop.get(),propertyName,this._container,wave)},PropertyManager.prototype.change=function(propertyName,value,wave){"undefined"==typeof wave&&(wave=[]);var prop=this.create(propertyName),converter=prop.converter;"function"==typeof converter&&(value=converter(value));var currentValue=prop.get();if(prop.alwaysFired||areDifferent(value,currentValue)){prop.set(value);var that=this;exec(prop,function(){that.fire(propertyName,wave)})}},PropertyManager.prototype.converter=function(propertyName,converter){var prop=this.create(propertyName);if("function"==typeof converter)prop.converter=converter;else if("undefined"!=typeof converter)throw Error("[tfw.binding.property-manager::converter] `converter` must be of type function or undefined!");return prop.converter},PropertyManager.prototype.delay=function(propertyName,delay){var prop=this.create(propertyName);return delay=parseFloat(delay),isNaN(delay)?prop.delay:void(prop.delay=delay)},PropertyManager.prototype.on=function(propertyName,action){var prop=this.create(propertyName);prop.event.add(action)},PropertyManager.prototype.off=function(propertyName,action){var prop=this.create(propertyName);prop.event.remove(action)};PropertyManager.prototype.create=function(propertyName,options){this;"string"!=typeof propertyName&&fail("propertyName must be a string!");var p=this._props[propertyName];return p||("undefined"==typeof options&&(options={}),p=createNewProperty.call(this,propertyName,options)),p},PropertyManager.prototype.createAction=function(propertyName,options){return"undefined"==typeof options&&(options={}),options.alwaysFired=!0,this.create(propertyName,options)};module.exports._=_});
//# sourceMappingURL=tfw.binding.property-manager.js.map
require("wdg.gl8",function(e,r){function n(){return o(t,arguments)}var t={en:{}},o=require("$").intl,u=require("dom"),i=require("tfw.data-binding"),a=require("tfw.webgl"),l=require("explosive-tp"),v=function(e){var r=u.elem(this,"canvas");i.propInteger(this,"width")(function(e){r.setAttribute("width",e),r.style.width=e+"px"}),i.propInteger(this,"height")(function(e){r.setAttribute("height",e),r.style.height=e+"px"}),i.propBoolean(this,"zindex"),e=i.extend({width:640,height:480,zbuffer:!1},e,this);var n=new a(r),t=n.gl,o=new l(r),v=n.createTextureForFB(512,512),f=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,f),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,v,0),t.bindFramebuffer(t.FRAMEBUFFER,null);var x=t.createBuffer(),s=new Float32Array([-1,-1,0,-1,1,0,1,-1,0,1,1,0]),g=n.createProgram({vertex:c.vert,fragment:c.frag});n.start(function(e){t.bindFramebuffer(t.FRAMEBUFFER,f),t.clear(t.COLOR_BUFFER_BIT),o.render(e),g.use(),t.bindFramebuffer(t.FRAMEBUFFER,null),t.disable(t.BLEND),t.disable(t.DEPTH_TEST),t.clear(t.COLOR_BUFFER_BIT),t.bindBuffer(t.ARRAY_BUFFER,x),t.enableVertexAttribArray(g.$attPosition),t.vertexAttribPointer(g.$attPosition,3,t.FLOAT,!1,0,0),t.bufferData(t.ARRAY_BUFFER,s,t.STATIC_DRAW),t.bindTexture(t.TEXTURE_2D,v),g.$uniTime=e,t.drawArrays(t.TRIANGLE_STRIP,0,4)})};r.exports=v;var c={vert:"// Temps courant en millisecondes\nuniform float uniTime;\n\n// Position en valeurs comprises entre -1.0 et +1.0\nattribute vec2 attPosition;\n\n// Passer les coordonnÃ©es UV pour la texture.\nvarying vec2 varUV;\nvarying float varTime;\n\nvoid main() {\n  float x = attPosition.x;\n  float y = attPosition.y;\n  float z = 0.0;\n\n  gl_Position = vec4(x, y, z, 1.0 );\n\n  varUV = vec2( x, y );\n  varTime = uniTime;\n}\n",frag:"precision mediump float;\n\nuniform sampler2D uniTexture;\n\nvarying vec2 varUV;\nvarying float varTime;\n\nconst float S = 1.0 / 128.0;\n\n\nbool isBackground(vec4 color) {\n  if (color.r > .9 && color.g > .9 && color.b > .9) return true;\n  return false;\n}\n\nvoid fx1(vec4 color, float u, float v, float x, float y) {\n  gl_FragColor = color;\n}\n\nvoid fx2(vec4 color, float u, float v, float x, float y) {\n  gl_FragColor = color * 9.0\n    - texture2D( uniTexture, vec2(u - S, v - S) )\n    - texture2D( uniTexture, vec2(u    , v - S) )\n    - texture2D( uniTexture, vec2(u + S, v - S) )\n    - texture2D( uniTexture, vec2(u - S, v    ) )\n    - texture2D( uniTexture, vec2(u + S, v    ) )\n    - texture2D( uniTexture, vec2(u - S, v + S) )\n    - texture2D( uniTexture, vec2(u    , v + S) )\n    - texture2D( uniTexture, vec2(u + S, v + S) );\n  if (gl_FragColor.r + gl_FragColor.g + gl_FragColor.b > .1) {\n    if (!isBackground(color)) {\n      gl_FragColor = vec4(1.0, 0.9 * u, 0.0, 1.0);\n    } \n  } else {\n    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n  }\n}\n\nvoid fx3(vec4 color, float u, float v, float x, float y) {\n  if (isBackground(color)) gl_FragColor = color;\n  else gl_FragColor = vec4(1.0 - color.r * u, 1.0 - color.g * u * v, 1.0 - color.b * v, 1.0);\n}\n\nvoid fx4(vec4 color, float u, float v, float x, float y) {\n  gl_FragColor = - color * 7.0\n    + texture2D( uniTexture, vec2(u - S, v - S) )\n    + texture2D( uniTexture, vec2(u    , v - S) )\n    + texture2D( uniTexture, vec2(u + S, v - S) )\n    + texture2D( uniTexture, vec2(u - S, v    ) )\n    + texture2D( uniTexture, vec2(u + S, v    ) )\n    + texture2D( uniTexture, vec2(u - S, v + S) )\n    + texture2D( uniTexture, vec2(u    , v + S) )\n    + texture2D( uniTexture, vec2(u + S, v + S) );\n}\n\n\nvoid main() {\n  float x = varUV.x;\n  float y = varUV.y;\n  float u = (1.0 + x) / 2.0;\n  float v = (1.0 + y) / 2.0;\n  float ang = varTime * 0.000314;\n  float r = cos(4581.15 + varTime * 0.000711);\n  float cx = cos(ang) * r;\n  float cy = sin(ang) * r;\n\n  vec4 color = texture2D( uniTexture, vec2(u, v) );\n  if (x < cx) {\n    if (y < cy) {\n      fx1(color, u, v, x, y);\n    } else {\n      fx2(color, u, v, x, y);\n    }\n  } else {\n    if (y < cy) {\n      fx3(color, u, v, x, y);\n    } else {\n      fx4(color, u, v, x, y);\n    }\n  }\n}\n"};r.exports._=n});
//# sourceMappingURL=wdg.gl8.js.map
<!DOCTYPE html><html><head><link href="https://fonts.googleapis.com/css?family=Josefin+Sans" rel="stylesheet" type="text/css"></link><title>webgl-experiments</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><script src="js/@chap3.js"></script><link rel="stylesheet" type="text/css" href="css/dom.css"><script src="js/$.js"></script><script src="js/wdg.gl3.js"></script><script src="js/tfw.data-binding.js"></script><script src="js/tfw.listeners.js"></script><script src="js/polyfill.string.js"></script><script src="js/dom.js"></script><script src="js/tfw.pointer-events.js"></script><script src="js/polyfill.classList.js"></script><script src="js/x-widget.js"></script><link rel="stylesheet" type="text/css" href="css/@chap3.css"></head><body class="theme-webgl theme-color-bg-B5"><section class="theme-color-bg-B0 theme-elevation-4"><style>
 article > * {
     display: inline-block;
     vertical-align: top;
 }
</style><h1 id="textures-proc-durales">Textures procédurales</h1>
<p>Le orange sur le bleu est très ceillant, je vous le concède, mais serait-il possible de changer de couleur, voire d&#39;avoir différentes couleurs sur un même polygône ?</p>
<p>La réponse est oui, si vous utilisez votre <em>fragment shader</em> avec astuce.</p>
<p>Il est possible de faire tout ce que votre imagination (et Open GL, soyons honnêtes) permet. Dans les exemples ci-dessous, nous déterminons la couleur en fonction des coordonnées 2D du pixel à afficher.</p>
<p>Ces coordonnées sont interpolées à partir des coordonnées des vertices. Il faut donc que le <em>vertex shader</em> déclare une variale de type <strong>varying</strong> pour que le <em>fragment shader</em> puisse l&#39;utiliser.
Cela se fait ainsi :</p>
<pre class="custom highlight js">
    varying lowp vec3 varVertexPosition;
    <span class="keyword">
    void</span> <span class="function">main</span>() {
      varVertexPosition <span class="operator">=</span> attVertexPosition;
      ...</pre><p>Voici maintenant des exemples de ce que l&#39;on peut obtenir.</p>
<article>
    <div id="wdg.gl39" style="display:none"></div>
    <div>
        <b>Le pyjama rayé</b>
<pre class="custom highlight js">
    varying lowp vec3 varVertexPosition;
    <span class="keyword">
    void</span> <span class="function">main</span>() {
     <span class="keyword"> if</span> (<span class="function">mod</span>( varVertexPosition.x, 20.0 ) <span class="operator">&gt;</span> 6.0) {
        gl_FragColor <span class="operator">=</span> <span class="function">vec4</span>(1.0, 1.0, 1.0, 1.0);
      }<span class="keyword"> else</span> {
        gl_FragColor <span class="operator">=</span> <span class="function">vec4</span>(0.0, 0.0, 0.0, 1.0);
      }
    }</pre>
    </div>
</article><article>
    <div id="wdg.gl310" style="display:none"></div>
    <div>
        <b>La vague colorée</b>
<pre class="custom highlight js">
    varying lowp vec3 varVertexPosition;
    <span class="keyword">
    void</span> <span class="function">main</span>() {
      lowp float x <span class="operator">=</span> varVertexPosition.x;
      lowp float y <span class="operator">=</span> varVertexPosition.y;
    
      highp float radius <span class="operator">=</span> <span class="function">sqrt</span>( (x<span class="operator">*</span>x) <span class="operator">+</span> (y<span class="operator">*</span>y) );
    
      highp float r <span class="operator">=</span> <span class="function">abs</span>( <span class="function">cos</span>( radius <span class="operator">/</span> 77.12 ) );
      highp float g <span class="operator">=</span> <span class="function">abs</span>( <span class="function">cos</span>( radius <span class="operator">/</span> 33.27 ) );
      highp float b <span class="operator">=</span> <span class="function">abs</span>( <span class="function">cos</span>( radius <span class="operator">/</span> 62.43 ) );
      
      gl_FragColor <span class="operator">=</span> <span class="function">vec4</span>( r, g, b, 1.0 );
    }</pre>
    </div>
</article><article>
    <div id="wdg.gl311" style="display:none"></div>
    <div>
        <b>Le tramage</b>
<pre class="custom highlight js">
    varying lowp vec3 varVertexPosition;
    <span class="keyword">
    void</span> <span class="function">main</span>() {
      <span class="comment">// Couleur de la trame.
    </span>  lowp float r1 <span class="operator">=</span> 1.0;
      lowp float g1 <span class="operator">=</span> 0.5;
      lowp float b1 <span class="operator">=</span> 0.0;
      <span class="comment">// Couleur du fond.
    </span>  lowp float r2 <span class="operator">=</span> 0.0;
      lowp float g2 <span class="operator">=</span> 0.0;
      lowp float b2 <span class="operator">=</span> 1.0;
    
      lowp float x <span class="operator">=</span> <span class="function">mod</span>( varVertexPosition.x, 16.0 ) <span class="operator">-</span> 8.0;
      lowp float y <span class="operator">=</span> <span class="function">mod</span>( varVertexPosition.y, 16.0 ) <span class="operator">-</span> 8.0;
    
      highp float radius <span class="operator">=</span> <span class="function">sqrt</span>( (x<span class="operator">*</span>x) <span class="operator">+</span> (y<span class="operator">*</span>y) );
    
      highp float dist <span class="operator">=</span> <span class="function">sqrt</span>( varVertexPosition.x <span class="operator">*</span> varVertexPosition.x 
                               <span class="operator">+</span> varVertexPosition.y <span class="operator">*</span> varVertexPosition.y );
      dist <span class="operator">=</span> dist <span class="operator">/</span> 300.0;
      
      lowp float limit <span class="operator">=</span> dist <span class="operator">*</span> 9.0;
    
     <span class="keyword"> if</span>( radius <span class="operator">&lt;</span> limit ) gl_FragColor <span class="operator">=</span> <span class="function">vec4</span>( r1, g1, b1, 1.0 );
     <span class="keyword"> else</span> {
        <span class="comment">// Ici, on fait de l'anti-aliasing.
    </span>    lowp float c2 <span class="operator">=</span> <span class="function">clamp</span>( radius <span class="operator">-</span> limit, 0.0, 1.0 );
        lowp float c1 <span class="operator">=</span> 1.0 <span class="operator">-</span> c2;
        gl_FragColor <span class="operator">=</span> <span class="function">vec4</span>( c1 <span class="operator">*</span> r1 <span class="operator">+</span> c2 <span class="operator">*</span> r2, 
                             c1 <span class="operator">*</span> g1 <span class="operator">+</span> c2 <span class="operator">*</span> g2, 
                             c1 <span class="operator">*</span> b1 <span class="operator">+</span> c2 <span class="operator">*</span> b2, 
                             1.0 );
      }
    }</pre>
    </div>
</article><p>Voici quelques fonctions spécifiques au language de shading :</p>
<ul>
<li><strong>mod( a, b )</strong> : retourne le reste de la division euclidienne de <strong>a</strong> par <strong>b</strong>.</li>
<li><strong>clamp( a, min, max )</strong> : si <strong>a</strong> &lt; <strong>min</strong>, retourne <strong>min</strong>. Si <strong>a</strong> &gt; <strong>max</strong>, retourne <strong>max</strong>. Dans tous les autres cas, retourne <strong>a</strong>.</li>
</ul>
<hr/><ul>
<li>Chapitre précédent : </li>
</ul>
<a href="chap2.html">Vivent les polygones</a><p>.</p>
<ul>
<li>Chapitre suivant : </li>
</ul>
<a href="chap4.html">Animations</a><p>.</p>
</section><nav class="theme-color-bg-B2 theme-elevation-2"><p> Sommaire :</p>
<ul>
<li><a href="index.html">Comprendre WebGL</a></li>
<li><a href="chap1.html">Changer le système de coordonnées 2D</a></li>
<li><a href="chap2.html">Vivent les polygones</a></li>
<li><a href="chap3.html">Textures procédurales</a></li>
<li><a href="chap4.html">Animations</a></li>
<li><a href=""></a></li>
</ul>

</nav></body></html>